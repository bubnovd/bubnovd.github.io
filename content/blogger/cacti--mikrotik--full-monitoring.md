+++
title = "Cacti + Mikrotik = Full Monitoring"
date = 2014-03-01T02:21:00Z
updated = 2014-03-01T03:17:15Z
tags = ["cacti", "SNMPv3", "Mikrotik", "monitoring"]
blogimport = true 
[author]
	name = "devi1"
	uri = "https://www.blogger.com/profile/05777499482649623616"
+++

<br />Захотелось мне собирать все логи с сетевого оборудования в одном месте. Решил поднять syslog-сервер. Так как с такими сервисами никогда не сталкивался, пришлось спросить у великого гугля. Он подсказал мне, что с этим неплохо справляется система мониторинга Cacti. А о ней то я уже наслышан, и в планах стояло внедрение сего чуда в сеть. Итак, теперь основная цель не сислог, а мониторинг - то, для чего и создан cacti. Настроим мониторинг, а потом примемся за сислог.<br /><br /><a name='more'></a>Система мониторинга Cacti разрабатывалась с целью визуализации данных, поэтому сравнивать её с другими будет несколько неуместно. Я для мониторинга активности устройств использую The Dude. И советую её всем, у кого сеть построена на микротиках, т.к. разработана она этой компанией, и, соответственно, умеет полностью управлять Mikrotik'ом. Но об этом в следующей статье.<br /><br />Итак, cacti можно установить на Windows и UNIX-like системы. Для работы ей нужны:<br /><ol><li>web-server (apache 2.2)</li><li>database server (mySQL 5.6)</li><li>php (php 5.4)</li><li>RRDTool (1.4.8)</li><li>net-snmp (5.7)</li></ol>В скобках указаны версии, установленные мной на FreeBSD 10.0 (запущенной под Hyper-V в Windows 2012). Процесс установки подробно расписывать не буду. Я руководствовался этими ресурсами:<br /><ol><li><a href="http://nix-sa.blogspot.ru/2011/08/cacti.html" target="_blank">Установка Cacti (краткая заметка) </a></li><li><a href="http://habrahabr.ru/post/71087/" target="_blank">Кактус у монитора или ускоренная установка cacti</a></li><li><a href="http://samag.ru/archive/article/1770" target="_blank">Cacti – простой и удобный инструмент для мониторинга и анализа сети</a>&nbsp;</li></ol>&nbsp;Я давно не работал с UNIX-like системами, поэтому возникли некоторые проблемы (будьте осторожны выбирая пакеты, которые тянет php. Он может вытянуть иксы). Для тех, кто впервые ставит LAMP, советую почитать мануалы по установке и конфигурированию сервисов. <br /><br />Ставим <a href="http://docs.cacti.net/plugin:mikrotik" target="_blank">плагин</a> для работы с Mikrotik (копируем папку в /usr/share/local/cacti/plugins и идем в веб-интерфейсе кактуса в Configuration - Plugin Management и нажимаем Install, Activate). При его установке выпадает ошибка. Лечится удалением строки 'Invalid round robin archive' из /usr/local/share/cacti/plugins/mikrotik/templates/cacti_host_template_mikrotik_device.xml.<br /><br />Настраиваем SNMP на Mikrotik. IP -&gt; SNMP -&gt; Communities. Использовать стандартный public не рекомендую, т.к. он передаёт данные в открытом виде и без авторизации. Мы будем использовать SNMP v3, поддерживающий авторизацию и шифрование. Добавляем новую community:<br /><ul><li>имя - любое (cacti) </li><li>Addresses - адрес сервера SNMP (на котором стоит cacti)</li><li>Security - authorized</li><li>Read/write - выбираем по своему усмотрению, read нужен обязательно, а write только если планируем конфигурировать роутер по SNMP протоколу</li><li>Протоколы авторизации и шифрования оставляем дефолтные</li><li>Задаём пароль авторизации и парольную фразу для шифрования (могут быть разные значения)</li></ul><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-qeSZdaw9AGc/UxGx8cC4McI/AAAAAAAAAe0/Ck3khsntuKo/s1600/mt-snmp.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-qeSZdaw9AGc/UxGx8cC4McI/AAAAAAAAAe0/Ck3khsntuKo/s1600/mt-snmp.png" height="280" width="640" /></a></div><br />В SNMP Settings пишем:<br /><ul><li>Contact Info - почта админа</li><li>Location - физическое расположение устройства</li><li>Trap Target - адрес SNMP сервера</li><li>Выбираем созданную нами Trap Community</li><li>Trap Version - 3</li><li>Trap Generation - кто будет генерировать сообщения для сервера - интерфейс или встроенный сервер</li><li>Выбираем нужные интерфейсы</li></ul><br />Добавляем в cacti наш микротик. Подробно распишу только про SNMP options:<br /><ul><li><span class="textEditTitle">SNMP Version - 3</span></li><li><span class="textEditTitle">SNMP Username (v3) -&nbsp; имя нашего Community (cacti)</span></li><li><span class="textEditTitle">SNMP Password (v3) - то, что ввели в Authentication Password в Mikrotik</span></li><li><span class="textEditTitle">SNMP Privacy Passphrase (v3) - Encryption Password в Mikrotik</span></li></ul><span class="textEditTitle">По дальнейшей работе с кактусом полно мануалов. Также есть отличная документация на оф. сайте, правда на английском. <a href="http://mum.mikrotik.com/presentations/CZ09/schaub.pdf" target="_blank">Презентация</a> о настройке SNMP на Mikrotik.</span><br /><span class="textEditTitle"><br /></span><span class="textEditTitle">Первый час работы кактуса:</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-Nmv5KEBWAUs/UxG0IYWDldI/AAAAAAAAAfA/rGKLw1ncLhA/s1600/Screenshot+from+2014-03-01+16:18:55.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-Nmv5KEBWAUs/UxG0IYWDldI/AAAAAAAAAfA/rGKLw1ncLhA/s1600/Screenshot+from+2014-03-01+16:18:55.png" height="512" width="640" /></a></div><span class="textEditTitle">За сим откланяюсь. Постараюсь сочинить что-нибудь про The Dude. Да и про кактус, когда сам в нем разберусь.</span>
