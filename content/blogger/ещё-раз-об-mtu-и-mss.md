+++
title = "Ещё раз об MTU и MSS"
date = 2016-01-19T19:39:00Z
updated = 2016-01-19T19:39:28Z
tags = ["MSS", "VPN", "MTU"]
blogimport = true 
[author]
	name = "devi1"
	uri = "https://www.blogger.com/profile/05777499482649623616"
+++

<span style="background-color: white;"><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Я уже писал о <a href="http://www.bubnovd.net/2015/09/pdu-osi.html" target="_blank">MTU</a>&nbsp;и даже приводил прекрасный <a href="http://www.bubnovd.net/2015/08/mtu.html" target="_blank">документ</a> от Cisco. А сегодня случайно наткнулся на <a href="http://forum.ixbt.com/topic.cgi?id=14:49725" target="_blank">ixbt</a>&nbsp;на ветку о MTU в разных типах туннелей. Решил скопипастить - лишним не будет.</span></span><br /><a name='more'></a><br /><span style="background-color: white;"><span style="font-family: Verdana, Arial; font-size: 13.3333px;"><br /></span></span><span style="background-color: white;"><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Чтобы систематизировать свое представление о работе различных реализаций VPN-ов и расставить для себя все точки над "i", выполнил расчет значений MTU и MSS для payload (полезного передаваемого трафика) в разных типах VPN, используемых совместно с Ethernet. Прошу проверить мои расчеты и указать мне на ошибки, если таковые имеются.</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Итак.</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><b style="font-family: Verdana, Arial; font-size: 13.3333px;">1. PPTP</b><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">PPTP это полезный_TCP -&gt; IP -&gt; PPP -&gt; GRE -&gt; IP -&gt; Ethernet</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Для Ethernet MTU=1500; заголовки IP -20 байт, заголовок GRE -4 байта, заголовок PPP -2 байта.</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Итого, MTU=1500-20-4-2=</span><b style="font-family: Verdana, Arial; font-size: 13.3333px;">1474</b><span style="font-family: Verdana, Arial; font-size: 13.3333px;">; MSS=MTU-40=1434</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><b style="font-family: Verdana, Arial; font-size: 13.3333px;">2. Незашифрованный L2TP поверх IP</b><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">L2TP это полезный_TCP -&gt; IP -&gt; PPP -&gt; L2TP -&gt; UDP -&gt; IP -&gt; Ethernet</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Для Ethernet MTU=1500; заголовки IP -20 байт, заголовки UDP -8 байт, заголовки L2TP -16 байт, заголовок PPP -2 байта.</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Итого, MTU=1500-20-8-16-2=</span><b style="font-family: Verdana, Arial; font-size: 13.3333px;">1454</b><span style="font-family: Verdana, Arial; font-size: 13.3333px;">; MSS=MTU-40=1414</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><b style="font-family: Verdana, Arial; font-size: 13.3333px;">3. L2TP поверх IPSEC</b><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">L2TP поверх IPSEC это полезный_TCP -&gt; IP -&gt; PPP -&gt; L2TP -&gt; UDP -&gt; ESP -&gt; IP -&gt; Ethernet</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Получается то же самое, что и пункт 2, за вычетом размера заголовков ESP -20 байт.</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Итого, MTU=1454-20=</span><b style="font-family: Verdana, Arial; font-size: 13.3333px;">1434</b><span style="font-family: Verdana, Arial; font-size: 13.3333px;">; MSS=MTU-40=1394</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><b style="font-family: Verdana, Arial; font-size: 13.3333px;">4. L2TP поверх IPSEC с NAT-Traversal</b><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Это полезный_TCP -&gt; IP -&gt; PPP -&gt; L2TP -&gt; UDP -&gt; ESP -&gt; IP -&gt; UDP -&gt; IP -&gt; Ethernet</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Получается то же самое, что и пункт 3, за вычетом размера заголовков UDP -8 байт и IP -20 байт.</span><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><br style="font-family: Verdana, Arial; font-size: 13.3333px;" /><span style="font-family: Verdana, Arial; font-size: 13.3333px;">Итого, MTU=1434-28=</span><b style="font-family: Verdana, Arial; font-size: 13.3333px;">1406</b><span style="font-family: Verdana, Arial; font-size: 13.3333px;">; MSS=MTU-40=1366.</span></span><br /><span style="background-color: white;"><span style="font-family: Verdana, Arial; font-size: 13.3333px;"><br /></span></span><span style="background-color: white;"><span style="font-family: Verdana, Arial; font-size: 13.3333px;"><br /></span></span>
