+++
title = "SMS оповещения из The Dude"
date = 2015-04-07T21:32:00Z
updated = 2015-04-07T21:32:13Z
tags = ["оповещения", "monitoring", "SMS", "The Dude"]
blogimport = true 
[author]
	name = "devi1"
	uri = "https://www.blogger.com/profile/05777499482649623616"
+++

Какой смысл в мониторинге ключевых устройств, если об их некорректной работе будет знать только сама система мониторинга? Именно поэтому система мониторинга должна оповещать админа о некорректной работе. Я работаю Mikrotik'ами, поэтому использую фирменную систему мониторинга The Dude. И сейчас мы научим её слать почту и смс.<br /><br /><a name='more'></a><br /><br />По умолчанию The Dude умеет отправлять email, но для этого ей нужен SMTP сервер без авторизации. Что нам поднимать конечно же не имеет смысла. В общем, разработчики поленились сделать кошерно.<br /><br />Пытливые умы же научились отправлять почту сторонним приложением.<br /><br /><br /><ol><li>Качаем SMTP-клиент <a href="https://github.com/muquit/mailsend/releases/">mailsend</a></li><li>Кладем его, допустим, сюда&nbsp;<span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">C:\Program Files (x86)\Dude\mailsend\mailsend.exe</span><span style="background-color: white;"><span style="color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">&nbsp;</span><span style="line-height: 18.2000007629395px;"><span style="font-family: inherit;">(не забудьте переименовать экзешник)</span></span></span></li><li><span style="background-color: white;"><span style="line-height: 18.2000007629395px;"><span style="font-family: inherit;">Создаём файлик mailsend.cmd следующего содержания:&nbsp;</span></span><span style="color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">&nbsp;</span></span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">:: Send email notifications from Dude via Gmail</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">::&nbsp;</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set mailsenderdir=C:\Program Files (x86)\Dude\mailsend</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set mailsender=mailsend.exe</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set smtpsender=username@gmail.com</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set smtpsenderfullname=username</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set smtpserver=smtp.gmail.com</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set smtpport=465</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set smtpuser=username@gmail.com</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set smtppwd=password</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">set mailto=username@gmail.com</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">::</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">::</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">"%mailsenderdir%\%mailsender%" -smtp %smtpserver% -port %smtpport% -ssl -auth -user %smtpuser% -pass %smtppwd% -t %mailto% -f %smtpsender% -name "%smtpsenderfullname%" +cc +bc -q -sub %1 -M %2</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">::</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">::pause</span><br style="-webkit-backface-visibility: hidden; box-sizing: border-box; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px; margin: 0px; padding: 0px;" /><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">::</span></li></ol><span style="line-height: 18.2000007629395px;">Эти параметры меняем на свои:&nbsp;</span><em style="-webkit-backface-visibility: hidden; background-color: white; border: 0px; box-sizing: border-box; color: #555555; font-family: Arial; font-size: 13px; font-stretch: inherit; line-height: 18.2000007629395px; margin: 0px; padding: 0px; vertical-align: baseline;">smtpsender - ящик, с которого будут отправляться письма</em><span style="background-color: white; color: #555555; font-family: Arial; font-size: 13px; line-height: 18.2000007629395px;">,&nbsp;</span><em style="-webkit-backface-visibility: hidden; background-color: white; border: 0px; box-sizing: border-box; color: #555555; font-family: Arial; font-size: 13px; font-stretch: inherit; line-height: 18.2000007629395px; margin: 0px; padding: 0px; vertical-align: baseline;">smtpsenderfullname - имя пользователя этого ящика</em><span style="background-color: white; color: #555555; font-family: Arial; font-size: 13px; line-height: 18.2000007629395px;">,&nbsp;</span><em style="-webkit-backface-visibility: hidden; background-color: white; border: 0px; box-sizing: border-box; color: #555555; font-family: Arial; font-size: 13px; font-stretch: inherit; line-height: 18.2000007629395px; margin: 0px; padding: 0px; vertical-align: baseline;">smtpuser - опять ящик</em><span style="background-color: white; color: #555555; font-family: Arial; font-size: 13px; line-height: 18.2000007629395px;">,&nbsp;</span><em style="-webkit-backface-visibility: hidden; background-color: white; border: 0px; box-sizing: border-box; color: #555555; font-family: Arial; font-size: 13px; font-stretch: inherit; line-height: 18.2000007629395px; margin: 0px; padding: 0px; vertical-align: baseline;">smtppwd - пароль к нему</em><span style="background-color: white; color: #555555; font-family: Arial; font-size: 13px; line-height: 18.2000007629395px;">,&nbsp;</span><em style="-webkit-backface-visibility: hidden; background-color: white; border: 0px; box-sizing: border-box; color: #555555; font-family: Arial; font-size: 13px; font-stretch: inherit; line-height: 18.2000007629395px; margin: 0px; padding: 0px; vertical-align: baseline;">mailto - ящик админа (на который будем слать алерты)</em><div><br /></div><div><span style="font-family: inherit;"><span style="background-color: white; line-height: 18.2000007629395px;">4. Создаем новое уведомление в The Dude:</span></span></div><div><span style="font-family: inherit;"><span style="background-color: white; line-height: 18.2000007629395px;">Имя: mail</span></span></div><div><span style="font-family: inherit;"><span style="background-color: white; line-height: 18.2000007629395px;">Тип: execute on server</span></span></div><div><span style="font-family: inherit;"><span style="background-color: white; line-height: 18.2000007629395px;">Команда:&nbsp;</span></span><span style="background-color: #f9f2f4; color: seagreen; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 11.6999998092651px; line-height: 18.2000007629395px;">"C:\Program Files (x86)\Dude\mailsend\mailsend.cmd" "Service [Probe.Name] on [Device.Name] is now [Service.Status]" "Service [Probe.Name] on [Device.Name] is now [Service.Status] ([Service.ProblemDescription])"</span></div><div><span style="background-color: white; line-height: 18.2000007629395px;"><span style="font-family: inherit;">После нажатия кнопки Test письмо должно упасть на почту.</span></span></div><div><span style="background-color: white; line-height: 18.2000007629395px;"><span style="font-family: inherit;"><br /></span></span></div><div><span style="background-color: white; line-height: 18.2000007629395px;"><span style="font-family: inherit;"><br /></span></span></div><div><span style="background-color: white; line-height: 18.2000007629395px;">С почтой разобрались. Теперь нужно научить Дудку отправлять СМС. Саму мониторилку мы больше мучать не будем - СМС умеет отправлять гуглопочта.</span></div><div><span style="background-color: white; line-height: 18.2000007629395px;"><br /></span></div><div><span style="font-family: inherit;"><span style="background-color: white; line-height: 22.3999996185303px;">Итак, что нужно для начала: у вас должен быть привязан телефонный номер к Google Calendar, как это сделать написано вот тут — Регистрация мобильного телефона:</span><br style="background-color: white; line-height: 22.3999996185303px;" /><a href="http://support.google.com/calendar/bin/answer.py?hl=ru&amp;hlrm=en&amp;answer=45351" style="background-color: white; border: 0px; color: #990099; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; text-decoration: none; vertical-align: baseline;">support.google.com/calendar/bin/answer.py?hl=ru&amp;hlrm=en&amp;answer=45351</a></span></div><div><ol><li><span style="line-height: 18.2000007629395px;"><span style="font-family: inherit;"><span style="background-color: white; line-height: 22.3999996185303px;">Создайте новый ярлык в Gmail с именем, например, SMSnotify (или любым другим, по вашему усмотрению). Как это сделать написано вот тут – Использование ярлыков:</span><br style="background-color: white; line-height: 22.3999996185303px;" /><a href="http://support.google.com/mail/bin/answer.py?hl=ru&amp;hlrm=ru&amp;answer=118708#0" style="background-color: white; border: 0px; color: #990099; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; text-decoration: none; vertical-align: baseline;"><span style="font-family: inherit;">support.google.com/mail/bin/answer.py?hl=ru&amp;hlrm=ru&amp;answer=118708#0</span></a></span></span></li><li><span style="line-height: 18.2000007629395px;"><span style="font-family: inherit;"><span style="background-color: white; line-height: 22.3999996185303px;">Создайте фильтр, который будет применять ярлык SMSnotify к письмам от системы мониторинга ( From:&nbsp;</span><code style="background-color: white; border: 0px; color: #222222; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">username@gmail.com</code><span style="background-color: white; line-height: 22.3999996185303px;">). Как это сделать, написано вот тут – Использование фильтров:</span><br style="background-color: white; line-height: 22.3999996185303px;" /><a href="https://support.google.com/mail/bin/answer.py?hl=ru&amp;hlrm=ru&amp;answer=6579#0" style="background-color: white; border: 0px; color: #990099; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; text-decoration: none; vertical-align: baseline;">support.google.com/mail/bin/answer.py?hl=ru&amp;hlrm=ru&amp;answer=6579#0</a></span></span></li><li><span style="font-family: inherit;"><span style="line-height: 18.2000007629395px;"><span style="background-color: white; line-height: 22.3999996185303px;"><span style="font-family: inherit;">Войдите в Google Drive и создайте новую электронную таблицу (Spreadsheet). Откройте созданную таблицу и в верхнем меню выберите Tools &gt; Script Editor.</span></span></span></span></li><li><span style="font-family: inherit;"><span style="line-height: 22.3999996185303px;"><span style="font-family: inherit;"><span style="background-color: white; line-height: 22.3999996185303px;">Нужно создать доп. календарь и настроить SMS уведомления: установить по-умолчанию для всех новых встреч вот так:</span><br style="background-color: white; line-height: 22.3999996185303px;" /><i style="background-color: white; border: 0px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Настройки-&gt;Календари-&gt;Уведомления-&gt;По умолчанию-&gt;SMS-&gt;%% мин</i><br style="background-color: white; line-height: 22.3999996185303px;" /><span style="background-color: white; line-height: 22.3999996185303px;">В этом примере имя календаря будет "</span><b style="background-color: white; border: 0px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">email</b><span style="background-color: white; line-height: 22.3999996185303px;">"</span></span></span></span></li><li><span style="font-family: inherit;"><span style="line-height: 22.3999996185303px;">Вставляем следующий код:</span></span></li></ol><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">function my_notification()  {   </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">var</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;"> calendar = CalendarApp.getOwnedCalendarsByName(</span><span class="string" style="border: 0px; color: #339900; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">'email'</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">)[</span><span class="number" style="border: 0px; color: #2f98ff; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">]; </span><span class="comment" style="border: 0px; color: grey; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">//открываем календарь с именем "email"</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">     </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">var</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;"> threads = GmailApp.getUserLabelByName(</span><span class="string" style="border: 0px; color: #339900; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">'SMSnotify'</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">).getThreads();  </span><span class="comment" style="border: 0px; color: grey; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">//переменная, в которой хранится коллекция цепочек с ярлыком SMSnotify</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">  </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">var</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;"> now = </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">new</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;"> Date();    </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">if</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">(threads == </span><span class="number" style="border: 0px; color: #2f98ff; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">0</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">) </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">return</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">; </span><span class="comment" style="border: 0px; color: grey; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">// прекращение выполнения, если новых цепочек нет</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">     </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">for</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">(i </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">in</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;"> threads) </span><span class="comment" style="border: 0px; color: grey; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">// создаем события</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">  {     calendar.createEvent(threads[i].getFirstMessageSubject(),         </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">new</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;"> Date(now.getTime()+</span><span class="number" style="border: 0px; color: #2f98ff; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">60000</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">),         </span><span class="keyword" style="border: 0px; color: #4d7386; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">new</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;"> Date(now.getTime()+</span><span class="number" style="border: 0px; color: #2f98ff; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">60000</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">));   }        GmailApp.getUserLabelByName(</span><span class="string" style="border: 0px; color: #339900; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">'SMSnotify'</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">).removeFromThreads(threads); </span><span class="comment" style="border: 0px; color: grey; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline; white-space: pre-wrap;">//снимаем метки "SMSnotify" с цепочек</span><span style="background-color: #f7f7f9; color: #222222; font-family: Menlo, Monaco, 'Courier New', monospace; font-size: 12px; line-height: 22.3999996185303px; white-space: pre-wrap;">}</span></div><div><span style="color: #555555; font-family: Arial;"><span style="font-size: 13px; line-height: 18.2000007629395px;"><i><br /></i></span></span><br />6.<span style="font-family: inherit;">&nbsp;&nbsp;<span style="background-color: white; line-height: 22.3999996185303px;">После того, как вы ввели код, нужно создать триггер по которому и будет запускаться скрипт. Для этого кликаем на меню "</span><b style="background-color: white; border: 0px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Ресурсы</b><span style="background-color: white; line-height: 22.3999996185303px;">", а в нем на "</span><b style="background-color: white; border: 0px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Триггеры текущего скрипта</b><span style="background-color: white; line-height: 22.3999996185303px;">".&nbsp;</span></span><br /><span style="font-family: inherit;"><span style="background-color: white; line-height: 22.3999996185303px;">7. &nbsp;</span><span style="background-color: white; line-height: 22.3999996185303px;">Нам нужен</span><b style="background-color: white; border-image-outset: initial; border-image-repeat: initial; border-image-slice: initial; border-image-source: initial; border-image-width: initial; border: 0px; line-height: 22.3999996185303px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">&nbsp;time-driven&nbsp;</b><span style="background-color: white; line-height: 22.3999996185303px;">триггер с частотой повторения одна минута.</span></span><br /><br /><span style="background-color: white; line-height: 22.3999996185303px;">Этот скрипт будет проверять входящие от с ярлыком&nbsp;</span><span style="background-color: white; line-height: 22.3999996185303px;">SMSnotify</span><span style="background-color: white; line-height: 22.3999996185303px;">&nbsp;(от юзера&nbsp;</span><span style="background-color: white; line-height: 22.3999996185303px;">username@gmail.com). И, в случае наличия новых писем создавать событие в календаре и снимать ярлык с уже обработанного письма. СМС будет слать сам календарь.</span><br /><br />Статья написана методом копипаста! Навеяно этим:&nbsp;<a href="http://forum.mikrotik.com/viewtopic.php?f=8&amp;t=85232">отправка email уведомлений</a>, <a href="http://habrahabr.ru/post/145447/">отправка СМС из гуглопочты</a></div>
