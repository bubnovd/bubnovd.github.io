+++
title = "Настройка LVM"
date = 2013-02-20T06:41:00Z
updated = 2013-05-29T10:50:20Z
tags = ["Linux Server", "linux", "FS", "debian", "LVM", "масштабируемость", "файловая система"]
blogimport = true 
[author]
	name = "devi1"
	uri = "https://www.blogger.com/profile/05777499482649623616"
+++

<br /><br />Наконец-то я добрался до своего уютненького бложика. Позже напишу для истории причину столь долгого перерыва, а сейчас только Linux, только хардкор.<br /><br />Итак, сегодня я наконец-то исполнил свои давнишние планы и поднял LVM на любимом Debian'e, не включавшемся последние полгода. Здесь и опишу как это было.<br /><br /><a name='more'></a>Поехали. Имеем пингвина (в моем случае Debian). У меня 4 жестких диска. fdisk -l и /etc/fstab говорят вот о чем:<br /><br /><span style="color: #0b5394; font-family: Courier New, Courier, monospace;">sda  320 GB<br /><br />       - sda1   /boot<br /><br />       - sda2   /<br /><br />       - sda3   /home<br /><br />       - sda4  /swap<br /><br /><br /> sdb  160 GB<br /><br />       - sdb1  /home/virtual/virtual2<br /><br />       - sdb2  - ntfs раздел Windows<br /><br /><br /> sdc  160 GB<br /><br />       - sdc1  /home/virtual/virtual3<br /><br />       - sdc2  - ntfs раздел Windows<br /><br /><br /> sdd   1000 GB<br /><br />       - sdd1  /home/video<br /><br />       - sdd2  - не используется<br /><br />       - sdd3  - не используется</span><br /><br /><br />Начал с простого знакомства с LVM. Решил один диск на 160 GB оставить под винду, второй на 160 - в LVM и зашифровать (тоже интересно покопаться с этой штукой), а 1000 GB и 360 GB объединить и разбить на несколько разделов. С количеством разделов пока не определился.<br /><br /><br /><br /><br />Для настройки LVM необходимо установить пакет lvm2:<br /><br /><span style="color: #990000;"><i>       sudo aptitude install lvm2</i></span><br /><br />Все дальнейшие операции проводятся из под рута (делаем su).<br /><br />Создаём физические разделы:<br /><br /><span style="color: #990000;"><i>       pvcreate /dev/sdb</i></span><br /><br />Сразу оно не завелось. Поэтому готовим хард:<br /><br /><span style="color: #990000;"><i>       dd if-/dev/zero of=/dev/sdb bs=1k count=1k<br /><br />       blockdev --rereadpt /dev/sdb<br /><br />       fdisk /dev/sdb<br /><br />             -t 0x8e<br /><br />             -w<br /><br />       pvcreate /dev/sdb</i></span><br /><br /><br />То же самое со вторым диском.<br /><br />Создаём группу томов:<br /><br /><span style="color: #990000;"><i>      vgcreate vg00 /dev/sdb /dev/sdd</i></span><br /><br />И, наконец, на созданной группе создаем логические тома (разделы):<br /><br /><span style="color: #990000;"><i>      lvcreate -L 1000G -n lv00data</i></span><br /><br />lv00data - название логического тома. Может быть любым.<br /><br /><br /><br /><br />На этом работа с LVM закончена и начинается работа с файловой системой. Форматируем в нужню ФС. Я решил отформатировать раздел /data в XFS (т.к. именно эта ФС хорошо работает с большими фалами. Да и поковыряться с новой для меня ФС интересно). Из коробки Debian не умеет работать с этой ФС. Поэтому пришлось установить пару пакетов:<br /><br /><span style="color: #990000;"><i>     aptitude install xfsprogs xfsdump</i></span><br /><br />Форматируем<br /><br /><span style="color: #990000;"><i>     mkfs.xfs /dev/vg00/lv00data</i></span><br /><br />Те же самые операции с остальными разделами.<br /><br />После перезагрузки тома из LVM не захотели монтироваться по UUID, хотя в последнем релизе Debian монтирование дисков происходит именно по UUID. Когда поправил /etc/fstab по названию тома - всё пришло в норму.<br /><br /><br />Ничего нового или оригинального в этом посте нет - просто на память. Вся инфа отсюда:<br /><br />    <a href="http://xgu.ru/wiki/LVM">xgu</a><br /><br />    <a href="http://habrahabr.ru/post/67283/">habr</a><br /><br /><br /><br />Если не уверены в своих силах - сделайте бэкап данных. Учтите, что диски, используемые в LVM форматируются и таблица разделов на них сносится. Для меня это было первым шагом в LVM, дальше хочу перенести всю систему туда и зашифровать один раздел. Работающую систему переносить страшно, поэтому нутром чую, что следующий пост будет про бэкапы =)<div><br /></div><div><span style="color: lime;">UPD 29-05-2013:</span>&nbsp;<u>XFS делайте только если оно вам действительно надо</u>. Т.е. если на 3 ТБ винте храните фильмы BD качества или большие БД. В большинстве случаев на домашней машине эта ФС не нужна. Запомните, она очень капризна и рассыпется практически без возможности восстановления при любом удобном случае. Например, моя гостья не нашла в меню выключение компьютера и просто дернула его из розетки. Хорошо хоть ничего особо ценного на разделе с XFS не было. Восстанавливать даже не пытался - времени не было.<br /><br />     </div>
