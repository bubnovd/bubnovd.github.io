+++
title = "Dude и SNMP"
date = 2015-03-03T01:19:00Z
updated = 2015-03-03T01:19:41Z
tags = ["SNMP", "bandwidth", "functions", "Mikrotik", "The Dude"]
blogimport = true 
[author]
	name = "devi1"
	uri = "https://www.blogger.com/profile/05777499482649623616"
+++

Про The Dude я уже писал. Отличная система мониторинга для сетей, построенных на базе оборудования Mikrotik. Столкнулся со следующей проблемой: хочу получить графики пропускной способности интерфейсов коммутаторов не строя при этом связи между портом коммутатора и конечным устройством на схеме (ну не надо мне перегружать карту клиентскими компами/телефонами). Что-то подобное Dude организовать может, но в ходе чтения различных материалов и обсуждений конкретного решения я не нашел и пришлось копать дальше в тему. Для нетерпеливых: ответа я пока не нашел.<br /><br /><a name='more'></a>Итак, мы можем опросить устройство по SNMP и произвести какие-либо манипуляции с полученными данными средствами самой дудки. Стандартный SNMP позволяет нам увидеть следующие параметры:<br /><table class="inline" style="background-color: white; border-collapse: collapse; border-spacing: 0px; border: 1px solid rgb(204, 204, 204); color: #333333; empty-cells: show; font-family: Arial, sans-serif; font-size: 14px; line-height: 19.6000003814697px; margin: 0px; min-width: 50%; padding: 0px;"><tbody><tr class="row5"><td class="col0 leftalign" style="border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">ifSpeed</td><td class="col1" style="border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">1.3.6.1.2.1.2.2.1.5</td><td class="col2 leftalign" style="border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">Текущая скорость интерфейса в битах за секунду.</td></tr></tbody></table><table class="inline" style="background-color: white; border-collapse: collapse; border-spacing: 0px; border: 1px solid rgb(204, 204, 204); color: #333333; empty-cells: show; font-family: Arial, sans-serif; font-size: 14px; line-height: 19.6000003814697px; margin: 0px; min-width: 50%; padding: 0px;"><tbody><tr class="row9"><td class="col0 leftalign" style="background-color: #eeeeee; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">ifInOctets</td><td class="col1 leftalign" style="background-color: #eeeeee; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">1.3.6.1.2.1.2.2.1.10</td><td class="col2 leftalign" style="background-color: #eeeeee; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">Полное число полученных байтов, включая символы заголовков</td></tr></tbody></table><table class="inline" style="background-color: white; border-collapse: collapse; border-spacing: 0px; border: 1px solid rgb(204, 204, 204); color: #333333; empty-cells: show; font-family: Arial, sans-serif; font-size: 14px; line-height: 19.6000003814697px; margin: 0px; min-width: 50%; padding: 0px;"><tbody><tr class="row15"><td class="col0 leftalign" style="background-color: #eeeeee; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">ifOutOctets</td><td class="col1 leftalign" style="background-color: #eeeeee; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">1.3.6.1.2.1.2.2.1.16</td><td class="col2 leftalign" style="background-color: #eeeeee; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0.3em 0.5em; vertical-align: top;">Полное количество отправленных октетов с интерфейса, включая символы заголовков.</td></tr></tbody></table><br /><div>Сначала я думал, что первая строчка этой таблицы спасет меня. Но нет - она показывает скорость, в которую установлен интерфейс (10/100/1000 Мб/с). Соответственно, ковырять придется второй и третий параметры. Вычислить скорость, исходя из полученных данных можно так:&nbsp;<span style="background-color: #eeeeee; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 13.6960000991821px; line-height: 17.8048000335693px; white-space: inherit;">(ifInOctets(time1) - ifInOctets(time2)) / (time2 - time1)</span></div><div>Но вот проблема: куда записать текущее значение полученных байтов, чтобы потом вычесть одно из другого. Тут должны помочь функции, встроенные в Dude. Но использование переменных я в них не нашел. Поэтому откладываю эту задачку на неопределенное время.&nbsp;</div><div>На форуме предлагают решение для The Dude 3.6, но в 4 версии оно не работает. Ссылки, которые дали информацию для размышлений: <a href="http://serverfault.com/questions/535875/how-to-monitor-per-port-bandwidth-using-snmp">1</a>, <a href="http://wiki.mikrotik.com/wiki/Getting_started_with_Functions_and_probes">2</a>, <a href="http://forum.nag.ru/forum/index.php?showtopic=81697">3</a>, <a href="https://www.zabbix.com/documentation/1.8/ru/manual/advanced_snmp">4</a>, <a href="http://forum.mikrotik.com/viewtopic.php?f=8&amp;t=43396">5</a>.&nbsp;</div>
