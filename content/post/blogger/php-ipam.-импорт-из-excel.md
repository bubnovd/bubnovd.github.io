+++
title = "PHP IPAM. Импорт из Excel"
date = 2016-11-16T03:47:00Z
updated = 2016-11-16T03:56:44Z
tags = ["csv", "routeros", "Управление IP адресами", "Mikrotik", "Excel", "PHPIPAM", "Автоматизация", "IPAM", "The Dude"]
blogimport = true 
[author]
	name = "devi1"
	uri = "https://www.blogger.com/profile/05777499482649623616"
+++

IP Address Management (сокращенно IPAM) – средство планирования, отслеживания и управления IP адресами в сети (<a href="https://en.wikipedia.org/wiki/IP_address_management">via</a>).<br /><br />&nbsp;В больших сетях отследить все используемые адреса и приготовиться к их изменению или внедрению новых – большая, трудновыполнимая задача. База данных IP адресов у многих ведется в различных табличка (Google Docs, Excel), у остальных не ведется совсем.<br />При изменениях в сети оперировать информацией из этих мест становится все сложнее и документы быстро теряют свою актуальность.<br /><div><br /></div><div>Именно поэтому было решено развернуть сервер управления IP адресами в нашей сети. После мук выбора я остановился на PHP IPAM - он показался мне наиболее дружелюбным и функциональным, к тому же имеет API для взаимодействия с внешними системами.</div><div>Посмотреть на демо это системы можно <a href="http://demo.phpipam.net/login/">тут</a></div><div><a name='more'></a><br /></div><div>Как происходит установка этой замечательной системы я рассказывать не буду - всё и так хорошо описано в Интернете. Если будут вопросы - спрашивайте в комментариях</div><div><br /></div><div>А так как сеть у меня уже большая и информация о ней мало где отражена, то актуальнейшая информация находится в таблицах маршрутизации роутеров. Эту информацию нужно внести в базу данных сервера IPAM. А как это сделать, я сейчас расскажу.</div><div><br /></div><div>С помощью системы мониторинга The Dude выгружаем таблицу маршрутизации в csv</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-EpFLVuMzjXU/WCwxkvGnX5I/AAAAAAAAA18/c3Sw7Npbb9gRhAGGQsiwJ14_iPrL4gKnQCLcB/s1600/1.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="181" src="https://1.bp.blogspot.com/-EpFLVuMzjXU/WCwxkvGnX5I/AAAAAAAAA18/c3Sw7Npbb9gRhAGGQsiwJ14_iPrL4gKnQCLcB/s400/1.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Экспорт из Dude в csv</td></tr></tbody></table><div>Открываем Excel и загружаем данные. Данные - из текста<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-9_UeK9szelQ/WCwyGFKR2aI/AAAAAAAAA2A/m2-iwI3kd60wBgOspYPwuk9vG9ddXP-EgCLcB/s1600/2.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="170" src="https://1.bp.blogspot.com/-9_UeK9szelQ/WCwyGFKR2aI/AAAAAAAAA2A/m2-iwI3kd60wBgOspYPwuk9vG9ddXP-EgCLcB/s400/2.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Импорт csv в Excel</td></tr></tbody></table>Выбираем наш файл. В открывшемся окне указываем формат - с разделителям и жмем далее<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-OM4v3S3K7Bc/WCxJJ0F5u5I/AAAAAAAAA4k/vYs0jNVBpSEIw5qtLSmmmD7ATcAq26WuwCLcB/s1600/3n.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="276" src="https://2.bp.blogspot.com/-OM4v3S3K7Bc/WCxJJ0F5u5I/AAAAAAAAA4k/vYs0jNVBpSEIw5qtLSmmmD7ATcAq26WuwCLcB/s400/3n.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">С разделителями</td></tr></tbody></table><br />The Dude экспортирует в файл с раделителями - запятыми, поэтому выбираем "запятые" и жмем далее<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-Ir4Akyd9wto/WCxJTGqwfrI/AAAAAAAAA4o/x55VwiOd2usAz9z_jIQyEo6vHkXpsvZMQCLcB/s1600/4n.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="271" src="https://1.bp.blogspot.com/-Ir4Akyd9wto/WCxJTGqwfrI/AAAAAAAAA4o/x55VwiOd2usAz9z_jIQyEo6vHkXpsvZMQCLcB/s400/4n.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Разделители - запятые</td></tr></tbody></table>На следующем шаге жмем кнопку "Готово"<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-hy12evJplaQ/WCxJYzXiKNI/AAAAAAAAA4s/D-NMWdUZKyEzHBxZfthrWb6Nxe_shq2wgCEw/s1600/5n.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="281" src="https://2.bp.blogspot.com/-hy12evJplaQ/WCxJYzXiKNI/AAAAAAAAA4s/D-NMWdUZKyEzHBxZfthrWb6Nxe_shq2wgCEw/s400/5n.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Готово!</td></tr></tbody></table><br />Выбираем ячейку, начиная с которой нужно вставить данные - обычно это А1. И наслаждаемся результатом. Теперь можно подкорректировать табличку.</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-0g3lc5NKx-8/WCwzc3omYOI/AAAAAAAAA2Y/Q-4uoohyALgl7glR47wWtM6gmwj1bT_5gCLcB/s1600/7.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="90" src="https://3.bp.blogspot.com/-0g3lc5NKx-8/WCwzc3omYOI/AAAAAAAAA2Y/Q-4uoohyALgl7glR47wWtM6gmwj1bT_5gCLcB/s400/7.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Excel</td></tr></tbody></table><br /><div>Теперь нам нужно сформировать csv, который принял бы наш IPAM сервер. А у него следующий формат файла для импорта:<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-ZFjL0gbu5sM/WCwzy5eHnpI/AAAAAAAAA2k/gdCdrROAGtEv37mhUZNyCqh5H4sbOLorwCLcB/s1600/8.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="32" src="https://3.bp.blogspot.com/-ZFjL0gbu5sM/WCwzy5eHnpI/AAAAAAAAA2k/gdCdrROAGtEv37mhUZNyCqh5H4sbOLorwCLcB/s400/8.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Формат csv для импорта в IPAM</td></tr></tbody></table><div>section name*(varchar(128)), &nbsp; &nbsp;subnet*(varchar(255)), &nbsp; mask(varchar(3)),&nbsp; description(text), &nbsp; vlan name(varchar(255)), &nbsp; domain name(varchar(64)), &nbsp; vrf name(varchar(32)). Обязательны только первые два параметра - имя секции и подсеть.</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div>Оставим только нужную нам информацию<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-ncLbzax6S3k/WCw1DF7siaI/AAAAAAAAA2w/Rm1sttGapwUYzeEhMOlAdwFHP5VxLDk_wCLcB/s1600/10.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="133" src="https://4.bp.blogspot.com/-ncLbzax6S3k/WCw1DF7siaI/AAAAAAAAA2w/Rm1sttGapwUYzeEhMOlAdwFHP5VxLDk_wCLcB/s400/10.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Убрали ненужное</td></tr></tbody></table>Как видим, остались только данные о подсети и связанного с ней филиала. Но имя интерфейса нам ни к чему, поэтому из строки вида &lt;sstp-pub-740102&gt; надо сделать RB740102. В этом нам поможет Excel<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-MLRHdRLi0ls/WCw1nubCnHI/AAAAAAAAA24/EWAAMSpnHaAfw5MS3EfvsRI6_3I7Fa2ugCLcB/s1600/11.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="116" src="https://3.bp.blogspot.com/-MLRHdRLi0ls/WCw1nubCnHI/AAAAAAAAA24/EWAAMSpnHaAfw5MS3EfvsRI6_3I7Fa2ugCLcB/s400/11.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Найти и заменить</td></tr></tbody></table>Теперь нам нужно избавиться от закрывающего спецсимвола "&gt;"<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-Ra4YBsDwX4s/WCw1_jIdLQI/AAAAAAAAA28/2-RtUd23zds1nPLNtqXGXGJj7ww__vOtgCLcB/s1600/12.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="https://3.bp.blogspot.com/-Ra4YBsDwX4s/WCw1_jIdLQI/AAAAAAAAA28/2-RtUd23zds1nPLNtqXGXGJj7ww__vOtgCLcB/s1600/12.PNG" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">&gt;</td></tr></tbody></table><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="https://1.bp.blogspot.com/-Fms-KrkujaI/WCw2WggckPI/AAAAAAAAA3E/IKcQgD0hcVs2V43xzvo-KUjVK-15i0YcACLcB/s1600/13.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="110" src="https://1.bp.blogspot.com/-Fms-KrkujaI/WCw2WggckPI/AAAAAAAAA3E/IKcQgD0hcVs2V43xzvo-KUjVK-15i0YcACLcB/s400/13.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8px;">Финиш близко<br /><br /></td></tr></tbody></table><br /></div><div><br /></div><div>Приведем нашу табличку к такому виду<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-yKWmXTtTAOk/WCw0lIGvDHI/AAAAAAAAA2s/eWg8ho7FmDoOym9zhCz1PrViaVV61p8NgCLcB/s1600/9.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="111" src="https://2.bp.blogspot.com/-yKWmXTtTAOk/WCw0lIGvDHI/AAAAAAAAA2s/eWg8ho7FmDoOym9zhCz1PrViaVV61p8NgCLcB/s400/9.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Готовый Excel</td></tr></tbody></table>И сохраним как csv. Excel ругнется на то, что мы потеряем данные, но мы готовы на такой риск =)</div><div>В итоге должны получить файл следующего вида<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-BcwXw3S1b8k/WCw29KMFCBI/AAAAAAAAA3I/DXWW75iBTiEksp2mWN8Q_tzV6C6l0VtuwCLcB/s1600/14.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="302" src="https://4.bp.blogspot.com/-BcwXw3S1b8k/WCw29KMFCBI/AAAAAAAAA3I/DXWW75iBTiEksp2mWN8Q_tzV6C6l0VtuwCLcB/s320/14.PNG" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">CSV</td></tr></tbody></table>Его уже можно импортировать в PHP IPAM. Заходим в Administration - Import/Export</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-MCgk4_rZhFA/WCw3VwTpzdI/AAAAAAAAA3U/Bzp6LxmhU3chKB6zSfeyg1eIjG_su-ilgCLcB/s1600/15.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="400" src="https://1.bp.blogspot.com/-MCgk4_rZhFA/WCw3VwTpzdI/AAAAAAAAA3U/Bzp6LxmhU3chKB6zSfeyg1eIjG_su-ilgCLcB/s400/15.PNG" width="172" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Import</td></tr></tbody></table><br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div>В PHP IPAM на данный момент в версии 1.2 rev1 доступен импорт только subnets. Поэтому выбираем subnets и жмем Import<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-puSg-b4-w-k/WCw5fRpUtpI/AAAAAAAAA3k/jIaVebXnswMzoj0nvCW48jRcVEnj0B8xACLcB/s1600/16.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="181" src="https://1.bp.blogspot.com/-puSg-b4-w-k/WCw5fRpUtpI/AAAAAAAAA3k/jIaVebXnswMzoj0nvCW48jRcVEnj0B8xACLcB/s400/16.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Import subnets</td></tr></tbody></table>Жмем Browse<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td><a href="https://3.bp.blogspot.com/-b-7hYTzV9Jc/WCw7p3brGaI/AAAAAAAAA30/oGal0bBSUe8WdIT0-NGLgvEnyxC3ng58QCLcB/s1600/18.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="189" src="https://3.bp.blogspot.com/-b-7hYTzV9Jc/WCw7p3brGaI/AAAAAAAAA30/oGal0bBSUe8WdIT0-NGLgvEnyxC3ng58QCLcB/s320/18.PNG" width="320" /></a></td></tr><tr><td class="tr-caption" style="font-size: 12.8px;">Browse</td></tr></tbody></table>Выбираем наш csv и жмем открыть.<br /><br />На этом этапе мы должны получить ошибку:&nbsp;<span style="background-color: white; color: #333333; font-family: , &quot;blinkmacsystemfont&quot; , &quot;segoe ui&quot; , &quot;helvetica&quot; , &quot;arial&quot; , sans-serif , &quot;apple color emoji&quot; , &quot;segoe ui emoji&quot; , &quot;segoe ui symbol&quot;; font-size: 14px;">Error: Upload directory is not writable, or does not exist.</span></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-KWvOKKWOem0/WCw5yddHiuI/AAAAAAAAA3o/ddKKtzAAYCEL37fiWcHlvf3ftokcnoFmwCLcB/s1600/17.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="328" src="https://2.bp.blogspot.com/-KWvOKKWOem0/WCw5yddHiuI/AAAAAAAAA3o/ddKKtzAAYCEL37fiWcHlvf3ftokcnoFmwCLcB/s400/17.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Error: Upload directory is not writable, or does not exist.</td></tr></tbody></table>Это значит, что у веб-сервера нет прав на запись в папку upload. Добавим эти права. Выполним в консоли &nbsp;sudo chmod -R g+w o+w /var/www/html/phpipam/app/admin/import-export/upload/ <span style="color: #e06666;">Тут должен быть путь до вашего сервера IPAM!</span>&nbsp;</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-f4WQ2KdQTRQ/WCw9TOnBnQI/AAAAAAAAA4I/oshC0XsTv5wNw7XC6XjUuKRT1na_xRudQCLcB/s1600/19.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="111" src="https://4.bp.blogspot.com/-f4WQ2KdQTRQ/WCw9TOnBnQI/AAAAAAAAA4I/oshC0XsTv5wNw7XC6XjUuKRT1na_xRudQCLcB/s400/19.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Import</td></tr></tbody></table><div>Повторяем пункты импорта. Система выдаст предупреждение о том, что не все пункты сопоставлены. Точно - в первом столбце пусто. Выбираем там section name и жмем Preview. Если все хорошо, то система покажет список импортируемых подсетей и их имена<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-CCtngKurA5s/WCw9wG6hMII/AAAAAAAAA4M/iMnjG37HmhwBIwOAZax-vGmkxyDXcl1PgCLcB/s1600/20.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="56" src="https://2.bp.blogspot.com/-CCtngKurA5s/WCw9wG6hMII/AAAAAAAAA4M/iMnjG37HmhwBIwOAZax-vGmkxyDXcl1PgCLcB/s400/20.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Uploaded data</td></tr></tbody></table>Жмем Import и проверяем указанную в поле section csv-файла секцию. Наши записи успешно импортированы!<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-llscFJZPCWQ/WCw-JL1_wpI/AAAAAAAAA4U/UGo7LZOaPx43Ft5DUWNbFNjW9T0ncHe7gCLcB/s1600/21.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="148" src="https://1.bp.blogspot.com/-llscFJZPCWQ/WCw-JL1_wpI/AAAAAAAAA4U/UGo7LZOaPx43Ft5DUWNbFNjW9T0ncHe7gCLcB/s400/21.PNG" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Готово!</td></tr></tbody></table><div><span style="color: #333333; font-family: , &quot;blinkmacsystemfont&quot; , &quot;segoe ui&quot; , &quot;helvetica&quot; , &quot;arial&quot; , sans-serif , &quot;apple color emoji&quot; , &quot;segoe ui emoji&quot; , &quot;segoe ui symbol&quot;;"><span style="font-size: 14px;"><br />&nbsp;</span></span><br /><div><br /></div></div></div>
