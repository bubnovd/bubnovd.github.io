<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Option 82 on Админская фамилия</title><link>https://bubnovd.net/tags/option-82/</link><description>Recent content in Option 82 on Админская фамилия</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 09 Nov 2015 03:38:00 +0000</lastBuildDate><atom:link href="https://bubnovd.net/tags/option-82/index.xml" rel="self" type="application/rss+xml"/><item><title>DHCP, Option 82</title><link>https://bubnovd.net/blogger/dhcp-option-82/</link><pubDate>Mon, 09 Nov 2015 03:38:00 +0000</pubDate><guid>https://bubnovd.net/blogger/dhcp-option-82/</guid><description>Встала задача: определять на каком порту какого свитча находится конкретный IP-адрес. На самом деле задача глобальнее, но сейчас имеет смысл именно это. В ходе гугления вышел на DHCP Option 82. Инфы много, но кроме теории важно это.
Суть в том, что коммутатор в запрос DHCP добавляет два поля: Agent Remote ID (идентификатор коммутатора) и Agent Circuit ID (идентификатор порта). Казалось бы, всё просто. Но я столкнулся с некоторыми трудностями.
Дело в том, что сеть поделена на сегменты для улучшения безопасности, выделения потоков трафика и уменьшения широковещательного трафика.</description><content>&lt;p>Встала задача: определять на каком порту какого свитча находится конкретный IP-адрес. На самом деле задача глобальнее, но сейчас имеет смысл именно это. В ходе гугления вышел на DHCP Option 82. Инфы много, но кроме &lt;a href="http://habrahabr.ru/post/252929/">теории&lt;/a> &lt;a href="http://habrahabr.ru/post/108453/">важно&lt;/a> &lt;a href="http://habrahabr.ru/post/143846/">это&lt;/a>.&lt;br>
Суть в том, что коммутатор в запрос DHCP добавляет два поля: Agent Remote ID (идентификатор коммутатора) и Agent Circuit ID (идентификатор порта). Казалось бы, всё просто. Но я столкнулся с некоторыми трудностями.&lt;/p>
&lt;p>Дело в том, что сеть поделена на сегменты для улучшения безопасности, выделения потоков трафика и уменьшения широковещательного трафика. Каждый сегмент имеет свою адресацию и, соответственно, свой DHCP-сервер.&lt;br>
Чтобы настроить работу Option 82, коммутатор необходимо настроить как DHCP-relay. Это значит, что при получении DHCP request&amp;rsquo;a коммутатор просто отправит этот запрос DHCP серверу, указанному в настройках релея. Таким образом можно уменьшить количество широковещательного трафика в пределах сегмента и иметь один DHCP сервер на несколько подсетей. Но, DHCP-relay может работать только с одним DHCP-сервером (указанным в настройках релея), соответственно, все наши сегменты получат адреса из одной подсети, что&lt;br>
нас совсем не устраивает.&lt;/p>
&lt;p>Умные инженеры придумали для этого т.н. DHCP Snooping или DHCP Local Relay в терминологии D-Link&amp;rsquo;a. Просто указываем VLAN&amp;rsquo;ы в которых будет работать Relay и правим параметры Option 82 если требуется.&lt;/p>
&lt;p>На DHCP-сервере (в моем случае Mikrotik RouterOS) в полях Agent Remote/Circuit ID получаем коммутатор и порт, на котором висит наш адрес. В более продвинутых DHCP серверах на основе этой информации можно очень тонко сконфигурировать работу DHCP.&lt;br>
Так это выглядит в DHCP Leases Mikrotik. В поле Agent Circuit ID последние 2 символа - шестнадцатеричный номер порта.&lt;/p>
&lt;p>&lt;a href="http://4.bp.blogspot.com/-2ofIaFKuc60/VkCFZlU0gpI/AAAAAAAAApI/z2dtRg8XJcA/s1600/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA.PNG">&lt;img src="http://4.bp.blogspot.com/-2ofIaFKuc60/VkCFZlU0gpI/AAAAAAAAApI/z2dtRg8XJcA/s640/%25D0%25A1%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BE%25D0%25BA.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>Спасибо Никита Писарев aka mastakid  и blackc за разжевывание&lt;/p></content></item></channel></rss>