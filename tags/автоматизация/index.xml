<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Автоматизация on Админская фамилия</title><link>https://bubnovd.net/tags/%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/</link><description>Recent content in Автоматизация on Админская фамилия</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 16 Nov 2016 03:47:00 +0000</lastBuildDate><atom:link href="https://bubnovd.net/tags/%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/index.xml" rel="self" type="application/rss+xml"/><item><title>PHP IPAM. Импорт из Excel</title><link>https://bubnovd.net/blogger/php-ipam.-%D0%B8%D0%BC%D0%BF%D0%BE%D1%80%D1%82-%D0%B8%D0%B7-excel/</link><pubDate>Wed, 16 Nov 2016 03:47:00 +0000</pubDate><guid>https://bubnovd.net/blogger/php-ipam.-%D0%B8%D0%BC%D0%BF%D0%BE%D1%80%D1%82-%D0%B8%D0%B7-excel/</guid><description>IP Address Management (сокращенно IPAM) – средство планирования, отслеживания и управления IP адресами в сети (via). В больших сетях отследить все используемые адреса и приготовиться к их изменению или внедрению новых – большая, трудновыполнимая задача. База данных IP адресов у многих ведется в различных табличка (Google Docs, Excel), у остальных не ведется совсем.При изменениях в сети оперировать информацией из этих мест становится все сложнее и документы быстро теряют свою актуальность.Именно поэтому было решено развернуть сервер управления IP адресами в нашей сети.</description><content>&lt;p>IP Address Management (сокращенно IPAM) – средство планирования, отслеживания и управления IP адресами в сети (&lt;!-- raw HTML omitted -->via&lt;!-- raw HTML omitted -->).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> В больших сетях отследить все используемые адреса и приготовиться к их изменению или внедрению новых – большая, трудновыполнимая задача. База данных IP адресов у многих ведется в различных табличка (Google Docs, Excel), у остальных не ведется совсем.&lt;!-- raw HTML omitted -->При изменениях в сети оперировать информацией из этих мест становится все сложнее и документы быстро теряют свою актуальность.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Именно поэтому было решено развернуть сервер управления IP адресами в нашей сети. После мук выбора я остановился на PHP IPAM - он показался мне наиболее дружелюбным и функциональным, к тому же имеет API для взаимодействия с внешними системами.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Посмотреть на демо это системы можно &lt;!-- raw HTML omitted -->тут&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как происходит установка этой замечательной системы я рассказывать не буду - всё и так хорошо описано в Интернете. Если будут вопросы - спрашивайте в комментариях&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->А так как сеть у меня уже большая и информация о ней мало где отражена, то актуальнейшая информация находится в таблицах маршрутизации роутеров. Эту информацию нужно внести в базу данных сервера IPAM. А как это сделать, я сейчас расскажу.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->С помощью системы мониторинга The Dude выгружаем таблицу маршрутизации в csv&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Экспорт из Dude в csv&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Открываем Excel и загружаем данные. Данные - из текста&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Импорт csv в Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Выбираем наш файл. В открывшемся окне указываем формат - с разделителям и жмем далее&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->С разделителями&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->The Dude экспортирует в файл с раделителями - запятыми, поэтому выбираем &amp;ldquo;запятые&amp;rdquo; и жмем далее&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Разделители - запятые&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->На следующем шаге жмем кнопку &amp;ldquo;Готово&amp;rdquo;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Готово!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Выбираем ячейку, начиная с которой нужно вставить данные - обычно это А1. И наслаждаемся результатом. Теперь можно подкорректировать табличку.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Теперь нам нужно сформировать csv, который принял бы наш IPAM сервер. А у него следующий формат файла для импорта:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Формат csv для импорта в IPAM&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->section name*(varchar(128)),    subnet*(varchar(255)),   mask(varchar(3)),  description(text),   vlan name(varchar(255)),   domain name(varchar(64)),   vrf name(varchar(32)). Обязательны только первые два параметра - имя секции и подсеть.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Оставим только нужную нам информацию&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Убрали ненужное&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как видим, остались только данные о подсети и связанного с ней филиала. Но имя интерфейса нам ни к чему, поэтому из строки вида &amp;lt;sstp-pub-740102&amp;gt; надо сделать RB740102. В этом нам поможет Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Найти и заменить&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Теперь нам нужно избавиться от закрывающего спецсимвола &amp;ldquo;&amp;gt;&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Финиш близко&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Приведем нашу табличку к такому виду&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Готовый Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->И сохраним как csv. Excel ругнется на то, что мы потеряем данные, но мы готовы на такой риск =)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В итоге должны получить файл следующего вида&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->CSV&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Его уже можно импортировать в PHP IPAM. Заходим в Administration - Import/Export&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Import&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В PHP IPAM на данный момент в версии 1.2 rev1 доступен импорт только subnets. Поэтому выбираем subnets и жмем Import&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Import subnets&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Жмем Browse&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Browse&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Выбираем наш csv и жмем открыть.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->На этом этапе мы должны получить ошибку: &lt;!-- raw HTML omitted -->Error: Upload directory is not writable, or does not exist.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Error: Upload directory is not writable, or does not exist.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Это значит, что у веб-сервера нет прав на запись в папку upload. Добавим эти права. Выполним в консоли  sudo chmod -R g+w o+w /var/www/html/phpipam/app/admin/import-export/upload/ &lt;!-- raw HTML omitted -->Тут должен быть путь до вашего сервера IPAM!&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Import&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Повторяем пункты импорта. Система выдаст предупреждение о том, что не все пункты сопоставлены. Точно - в первом столбце пусто. Выбираем там section name и жмем Preview. Если все хорошо, то система покажет список импортируемых подсетей и их имена&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Uploaded data&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Жмем Import и проверяем указанную в поле section csv-файла секцию. Наши записи успешно импортированы!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Готово!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Скрипт для проверки наличия USB-модема на RouterOS</title><link>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B8-%D0%BD%D0%B0%D0%BB%D0%B8%D1%87%D0%B8%D1%8F-usb-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BC%D0%B0-%D0%BD%D0%B0-routeros/</link><pubDate>Sun, 01 Mar 2015 20:42:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B8-%D0%BD%D0%B0%D0%BB%D0%B8%D1%87%D0%B8%D1%8F-usb-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BC%D0%B0-%D0%BD%D0%B0-routeros/</guid><description>Понадобился скрипт, определяющий наличие USB-модема, подключенного к Mikrotik. Присылает на почту название модема и его серийник. Хорошо бы допилить скрипт до отправки уровня сигнала и количества денег на счете, но мои модемы не дают доступа к своему меню - надо шить.:log info &amp;ldquo;Starting Modem Info Script&amp;hellip;&amp;rdquo;;:local sysname [/system identity get name];:local sysver [/system package get system version];:local mname [/system resource usb get 1 value-name=name];:local mnumber [/system resource usb get 1 value-name=serial-number];:local smtpserv [:resolve &amp;ldquo;smtp.</description><content>&lt;p>Понадобился скрипт, определяющий наличие USB-модема, подключенного к Mikrotik. Присылает на почту название модема и его серийник. Хорошо бы допилить скрипт до отправки уровня сигнала и количества денег на счете, но мои модемы не дают доступа к своему меню - надо шить.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Starting Modem Info Script&amp;hellip;&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local sysname [/system identity get name];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local sysver [/system package get system version];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local mname [/system resource usb get 1 value-name=name];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local mnumber [/system resource usb get 1 value-name=serial-number];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local smtpserv [:resolve &amp;ldquo;smtp.mail.ru&amp;rdquo;];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local Eaccount &amp;ldquo;&lt;a href="mailto:mail@mail.ru">mail@mail.ru&lt;/a>&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local pass &amp;ldquo;your_password&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Collecting Information&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:delay 5;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Sending Information via E-mail&amp;hellip;&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/tool e-mail send from=&amp;quot;&amp;lt;$Eaccount&amp;gt;&amp;quot; to=$Eaccount server=$smtpserv &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->port=587 user=$Eaccount password=$pass start-tls=yes &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->subject=(&amp;quot;$sysname Modem Information (&amp;quot; . [/system clock get date] . &amp;ldquo;)&amp;rdquo;) &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->body=(&amp;quot;$sysname Modem.\nTime and Date stamp: &amp;quot; . [/system clock get time] . &amp;quot; &amp;quot; . &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->[/system clock get date] . &amp;ldquo;\nModem $mname, SN: $mnumber&amp;rdquo;);&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Modem Info Complete!&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Скрипт для выявления порта свитча по маку. Опрос по SNMP</title><link>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B2%D1%8B%D1%8F%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE%D1%80%D1%82%D0%B0-%D1%81%D0%B2%D0%B8%D1%82%D1%87%D0%B0-%D0%BF%D0%BE-%D0%BC%D0%B0%D0%BA%D1%83.-%D0%BE%D0%BF%D1%80%D0%BE%D1%81-%D0%BF%D0%BE-snmp/</link><pubDate>Fri, 27 Feb 2015 00:32:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B2%D1%8B%D1%8F%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE%D1%80%D1%82%D0%B0-%D1%81%D0%B2%D0%B8%D1%82%D1%87%D0%B0-%D0%BF%D0%BE-%D0%BC%D0%B0%D0%BA%D1%83.-%D0%BE%D0%BF%D1%80%D0%BE%D1%81-%D0%BF%D0%BE-snmp/</guid><description>Допилил предыдущий скрипт . Необходимо знать аплинки каждого из свитчей. В моем случае, все они подключены к одному корневому (RootSwitch). Скрипт вытягивает по SNMP FDB таблицу корневого свитча, ищет в ней заданный MAC, сверяет его по заранее заданной таблице аплинков до свитчей доступа, переходит на следующий свитч и с него так же забирает FDB таблицу, а в ней уже ищет необходимый MAC. Информация выводится следующим образом &amp;ldquo;MAC, vlan, port корневого свитча; MAC, vlan, port конечного свитча&amp;rdquo;.</description><content>&lt;p>Допилил &lt;!-- raw HTML omitted -->предыдущий скрипт &lt;!-- raw HTML omitted -->. Необходимо знать аплинки каждого из свитчей. В моем случае, все они подключены к одному корневому (RootSwitch). Скрипт вытягивает по SNMP FDB таблицу корневого свитча, ищет в ней заданный MAC, сверяет его по заранее заданной таблице аплинков до свитчей доступа, переходит на следующий свитч и с него так же забирает FDB таблицу, а в ней уже ищет необходимый MAC. Информация выводится следующим образом &amp;ldquo;MAC, vlan, port корневого свитча; MAC, vlan, port конечного свитча&amp;rdquo;.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Для работы с SNMP необходимо подключить модуль &lt;!-- raw HTML omitted -->SharpSNMP&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->Из неожиданностей&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> в OID  MAC адреса хранятся в десятичном формате, пришлось их переводить в шестнадцатеричный. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Простым способом вернуть несколько значений из функции невозможно. Пришлось городить хэш-таблицу, в которой хранились бы три массива (MAC, vlan, port)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В OID информация хранится следующим образом:&lt;!-- raw HTML omitted -->OID                                                                                   Data&lt;!-- raw HTML omitted -->&amp;mdash;                                                                                       &amp;mdash;-&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.1.1.2.1                                               223&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.1.1.2.41                                              63&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.1.1.2.4026                                         222&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.2.1.2.&lt;!-- raw HTML omitted -->1&lt;!-- raw HTML omitted -->.144.2.166.50.206.43                3&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.2.1.2.&lt;!-- raw HTML omitted -->1&lt;!-- raw HTML omitted -->.144.2.166.50.206.63                6&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.2.1.2.&lt;!-- raw HTML omitted -->1&lt;!-- raw HTML omitted -->.144.2.166.50.206.126              4&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.2.1.2.&lt;!-- raw HTML omitted -->41&lt;!-- raw HTML omitted -->.0.21.100.59.187.78                26&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.2.1.2.&lt;!-- raw HTML omitted -->4026&lt;!-- raw HTML omitted -->.0.9.136.173.129.150          26&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.2.1.&lt;!-- raw HTML omitted -->3&lt;!-- raw HTML omitted -->.4026.232.64.241.24.239.215      3&lt;!-- raw HTML omitted -->.1.3.6.1.2.1.17.7.1.2.2.1.&lt;!-- raw HTML omitted -->3&lt;!-- raw HTML omitted -->.4026.232.64.241.24.242.213      3&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Первые три строки (может быть больше или меньше, в зависиомсти от количества vlan&amp;rsquo;ов): последняя цифра - номер vlan&amp;rsquo;а, data - количество MAC-адресов в этом влане в FDB-таблице.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Далее следуют строки с перечислением MAC-адресов, сгруппированные по vlan&amp;rsquo;ам: после символов .1.3.6.1.2.1.17.7.1.2.2.1.2. идет номер vlan (1, 41, 4026 в нашем случае), а за ним MAC адрес в десятичном формате. В поле Data - порт с найденным MAC-ом.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Далее следуют строки, начинающиеся на .1.3.6.1.2.1.17.7.1.2.2.1.3. Они содержат информацию, о способе получения MAC-адреса. Если параметр 3 - MAC получен методом learning (опрос порта), 4 - MAC коммутатора, с которого взяли FDB.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Мы будем обрабатывать строки из второго блока. Сначала отсекаем ненужную нам часть OID, затем разбиваем на подстроки и запоминаем данные. Полученные данные выводим по порядку в 3 массива - MAC, port, vlan.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Собственно скрипт:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->function findonswitch ([string]$ip) {&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$oid=&amp;quot;.1.3.6.1.2.1.17.7.1.2.2.1.2.&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$mas = Invoke-SnmpWalk $ip &amp;ldquo;.1.3.6.1.2.1.17.7.1.2&amp;rdquo; #vlans&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$i=0&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$vlan=@()&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$mac=@()&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$port=@()&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->foreach ($pt in $mas)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->if ($pt.OID -like &amp;ldquo;&lt;em>$oid&lt;/em>&amp;rdquo;)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$pt.OID = $pt.OID.remove(0,28)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$vlan += $pt.OID.Substring(0, $pt.OID.IndexOf(&amp;quot;.&amp;quot;))&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$temp = $pt.OID.Substring($pt.OID.IndexOf(&amp;quot;.&amp;quot;) + 1, $pt.OID.Length - $pt.OID.IndexOf(&amp;quot;.&amp;quot;)-1)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->###перевод из Dec в Hex&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$mas=$temp.split(&amp;quot;.&amp;quot;)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$nmac=@()&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->foreach ($sdec in $mas)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$dec = [int]$sdec&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$nmac += &amp;lsquo;{0:X2}&amp;rsquo; -f $dec&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$str=$nmac -join &amp;ldquo;-&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->###&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$mac += $str&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$port += $pt.Data&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$return= @{}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$return.vlan=$vlan&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$return.mac=$mac&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$return.port=$port&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->return $return&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->####################################################################&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$rootIP = &amp;ldquo;192.168.0.21&amp;rdquo;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$sport = (&amp;ldquo;1&amp;rdquo;, &amp;ldquo;2&amp;rdquo;, &amp;ldquo;5&amp;rdquo;, &amp;ldquo;12&amp;rdquo;, &amp;ldquo;13&amp;rdquo;, &amp;ldquo;14&amp;rdquo;, &amp;ldquo;43&amp;rdquo;, &amp;ldquo;44&amp;rdquo;, &amp;ldquo;65&amp;rdquo;, &amp;ldquo;66&amp;rdquo;, &amp;ldquo;74&amp;rdquo;, &amp;ldquo;107&amp;rdquo;)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$swDB = (&amp;ldquo;192.168.0.42&amp;rdquo;, &amp;ldquo;192.168.0.44&amp;rdquo;, &amp;ldquo;192.168.0.61&amp;rdquo;, &amp;ldquo;192.168.0.52&amp;rdquo;, &amp;ldquo;192.168.0.51&amp;rdquo;, &amp;ldquo;192.168.0.12&amp;rdquo;, &amp;ldquo;192.168.0.33&amp;rdquo;, &amp;ldquo;192.168.0.32&amp;rdquo;, &amp;ldquo;192.168.0.41&amp;rdquo;, &amp;ldquo;192.168.0.43&amp;rdquo;, &amp;ldquo;192.168.0.11&amp;rdquo;, &amp;ldquo;192.168.0.34&amp;rdquo;)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->function findinarr ($array, $value) {&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->    for ($i=0; $i -lt $array.count;$i++) { &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        if($array[$i] -eq $value){$i}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->    }&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$res=findonswitch $rootIP&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$dataMACRoot = $res.mac&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$dataPortRoot = $res.port&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$dataVlanRoot = $res.vlan&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$mac = Read-Host &amp;ldquo;Enter MAC&amp;rdquo;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->if ($mac.indexof(&amp;rdquo;:&amp;quot;) -ne 0)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$mac=$mac.replace(&amp;quot;:&amp;quot;, &amp;ldquo;-&amp;rdquo;)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$i=0&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$flag=0&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->foreach ($S in $dataMACRoot)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->if ($mac -eq $s)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$portRoot = $dataPortRoot[$i]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$vlanRoot = $dataVlanRoot[$i]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->Write-Host $mac on $portRoot &amp;lsquo;in vlan&amp;rsquo; $vlanRoot on RootSwitch&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->if ($flag -eq 0)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$portRoot1 = $dataPortRoot[$i]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$flag++&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$i++&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$A = findinarr $sport $portRoot1&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$res=findonswitch $swDB[$A]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$dataMAC = $res.mac&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$dataPort = $res.port&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$dataVlan = $res.vlan&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$i=0&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->foreach ($S in $dataMAC)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->if ($mac -eq $s)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$port = $dataPort[$i]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$vlan = $dataVlan[$i]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->Write-Host $mac on $port &amp;lsquo;in vlan&amp;rsquo; $vlan on &amp;lsquo;switch&amp;rsquo; $swDB[$A]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->$i++&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Работа второй части скрипта (после ###########) описана в предыдущем &lt;!-- raw HTML omitted -->посте&lt;!-- raw HTML omitted -->. Тут она претерпела некоторые изменения, в связи с входящей информацией из массива, а не из csv-файла, но логика не изменилась.&lt;/p></content></item><item><title>PowerShell. Заметки.</title><link>https://bubnovd.net/blogger/powershell.-%D0%B7%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8./</link><pubDate>Tue, 11 Jun 2013 20:32:00 +0000</pubDate><guid>https://bubnovd.net/blogger/powershell.-%D0%B7%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8./</guid><description>Начал использовать PowerShell. Инструмент очень мощный. По мощности сравним с шеллом никсов. Не буду утверждать что круче - не разбираюсь ни в том, ни в другом. Решил сделать в качестве памятки несколько заметок по использованию этого инструмента.1. Заметка номер раз. Простейшие регулярные выражения в PS.^ - начало строки$ - конец строки. - один любой символУдалить подстроку или заменить её - -replace . Простейший способ редактирования строк без вникания в код и написания &amp;ldquo;нормальных&amp;rdquo; регэкспов - тупо удалить нужное кол-во символов.</description><content>&lt;p>Начал использовать PowerShell. Инструмент очень мощный. По мощности сравним с шеллом никсов. Не буду утверждать что круче - не разбираюсь ни в том, ни в другом. Решил сделать в качестве памятки несколько заметок по использованию этого инструмента.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1.&lt;!-- raw HTML omitted --> Заметка номер раз. Простейшие регулярные выражения в PS.&lt;!-- raw HTML omitted -->^ - начало строки&lt;!-- raw HTML omitted -->$ - конец строки&lt;!-- raw HTML omitted -->. - один любой символ&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Удалить подстроку или заменить её - -replace . Простейший способ редактирования строк без вникания в код и написания &amp;ldquo;нормальных&amp;rdquo; регэкспов - тупо удалить нужное кол-во символов.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> (Get-Content .\list.txt)  -replace &amp;ldquo;^&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;rdquo; | Set-Content list1.txt&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Получили содержание файла, прошли по строкам, в каждой строке удалили какое-то количество первых символов, записали в файл.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->2. Получить список файлов, открывавшихся определенным пользователем в определенную дату.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Get-EventLog security -after (Get-Date -hour 0 -minute 0 -second 0) | ?{$&lt;em>.eventid -eq 560} | ?{$&lt;/em>.username -eq &amp;ldquo;username&amp;rdquo;}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Здесь мы получаем события журнала безопасности за текущую дату с 0 часов, 0 минут, 0 секунд с eventid равным 560 (аудит успеха. открытие объекта. Эта информация здесь: &lt;!-- raw HTML omitted -->Описание событий системы безопасности&lt;!-- raw HTML omitted -->) и именем пользователя username.&lt;!-- raw HTML omitted -->Но для того, чтобы эта команда сработала, необходимо чтобы велся аудит доступа к файловой системе. Об этом можно почитать &lt;!-- raw HTML omitted -->тут&lt;!-- raw HTML omitted -->. Позже сам напишу подобный мануал.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Дальше больше&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->3. Теперь скрипт по мотивам предыдущей заметки. Назначение: получить список пользователей, пытавшихся открыть файлы на ФС. Получаем время доступа, имя файла и имя пользователя.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$Events = Get-EventLog security | ?{$&lt;em>.eventid -eq 560}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$Data = New-Object System.Management.Automation.PSObject&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$Data | Add-Member NoteProperty Time ($null)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$Data | Add-Member NoteProperty UserName ($null)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$Data | Add-Member NoteProperty File ($null)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$Events | %{&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$Data.time = $&lt;/em>.TimeGenerated&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->$message = $&lt;em>.message.split(&amp;quot;&lt;code>n&amp;quot;) | %{$_.trimstart()} | %{$_.trimend()}&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;$Data.UserName = ($message | ?{$_ -like &amp;quot;Пользователь-клиент:*&amp;quot;} | %{$_ -replace &amp;quot;^.+:.&amp;quot;} )&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;$Data.File = ($message | ?{$_ -like &amp;quot;Имя объекта:*&amp;quot;} | %{$_ -replace &amp;quot;^.+:.&amp;quot;})&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;$data | Out-File F:\Docs\fs1.txt -Append&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;}&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;br /&amp;gt;Разберем по строкам.&amp;lt;br /&amp;gt;&amp;lt;br /&amp;gt;Первая строка получает события типа &amp;quot;безопасность&amp;quot; с кодом 560 (Get-Eventlog - получить данные журнала событий, security - данные журнала &amp;quot;безопасность&amp;quot;, где свойство eventid каждого (|) события ($_) эквивалентно (-eq) 560).&amp;lt;br /&amp;gt;&amp;lt;br /&amp;gt;Вторая строка создает объект PSObject. 3-5 строки добавляют в объект поля Time, UserName и File.&amp;lt;br /&amp;gt;&amp;lt;br /&amp;gt;Затем пробегаемся по событиям следующим способом.&amp;lt;br /&amp;gt;В поле time объекта Data записываем время создания строки с сообщением (время доступа к файлу).&amp;lt;br /&amp;gt;&amp;lt;br /&amp;gt;&amp;amp;nbsp;Строкой&amp;amp;nbsp;&amp;lt;i&amp;gt;&amp;lt;span style=&amp;quot;color: #990000;&amp;quot;&amp;gt;$message = $_.message.split(&amp;quot;&lt;/code>n&amp;quot;) | %{$&lt;/em>.trimstart()} | %{$_.trimend()} &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->— в переменную message заносим массив строк, которые разделяются символом переноса строки (&amp;rsquo;n), функции trimstart(), trimend() убирают все лишние символы в конце и в начале строки, функция split разделяет строку.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Далее во вновь образовавшемся массиве мы ищем совпадения по строке «Пользователь-клиент:» и «Имя объекта:», а -replace в дальнейшем удаляет эти регулярные выражения, оставляя саму информацию.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> И последней строкой записываем то, что получилось в итоге в файл.&lt;!-- raw HTML omitted --> Получается что-то типа этого:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Time                                    UserName                                File                                   &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&amp;mdash;-                                    &amp;mdash;&amp;mdash;&amp;ndash;                                &amp;mdash;-                                   &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->13.06.2013 16:52:22                     Seti                                    Docs\Сети\Общая папка\Реестры счет&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Time                                    UserName                                File                                   &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&amp;mdash;-                                    &amp;mdash;&amp;mdash;&amp;ndash;                                &amp;mdash;-                                   &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->13.06.2013 16:52:22                     Seti                                    Docs\Сети\Общая папка\Реестры счет&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Скрипт создан при помощи этих постов: &lt;!-- raw HTML omitted -->хабр&lt;!-- raw HTML omitted -->, &lt;!-- raw HTML omitted -->Поданс&lt;!-- raw HTML omitted -->.&lt;/p></content></item><item><title>Перенос учетных записей в домен</title><link>https://bubnovd.net/blogger/%D0%BF%D0%B5%D1%80%D0%B5%D0%BD%D0%BE%D1%81-%D1%83%D1%87%D0%B5%D1%82%D0%BD%D1%8B%D1%85-%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B5%D0%B9-%D0%B2-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD/</link><pubDate>Mon, 02 Jul 2012 21:00:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BF%D0%B5%D1%80%D0%B5%D0%BD%D0%BE%D1%81-%D1%83%D1%87%D0%B5%D1%82%D0%BD%D1%8B%D1%85-%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B5%D0%B9-%D0%B2-%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD/</guid><description>Надоело переносить учетки пользователей из локальных в доменные при внедрении Active Directory. Решил найти автоматизированное решение. Оказывается не я первый озадачился этой проблемой =) Есть как минимум 5 вариантов автоматизации. Рассмотрим их по порядку.User State Migration Tool. Бесплатная утилита от Microsoft. Поставляется в комплекте Windows Automated Installation Kit. Используется из консоли. Мануал. У меня не получилось выполнить сохранение профиля - scanstate встал на последнем этапе на 1% и никак не реагировал.</description><content>&lt;p>Надоело переносить учетки пользователей из локальных в доменные при внедрении Active Directory. Решил найти автоматизированное решение. Оказывается не я первый озадачился этой проблемой =) Есть как минимум 5 вариантов автоматизации. Рассмотрим их по порядку.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->User State Migration Tool. Бесплатная утилита от Microsoft. Поставляется в комплекте Windows Automated Installation Kit. Используется из консоли. &lt;!-- raw HTML omitted -->Мануал&lt;!-- raw HTML omitted -->. У меня не получилось выполнить сохранение профиля - scanstate встал на последнем этапе на 1% и никак не реагировал.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Active Directory Migration Tool. Продукт от той же всем известной компании. Предназначен для миграции из домена в домен. Сейчас нас не интересует. &lt;!-- raw HTML omitted -->Мануал&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В Windows 7 можно воспользоваться стандартным средством переноса данных.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Moveuser &lt;!-- raw HTML omitted -->- тоже от MS. Работает на XP. &lt;!-- raw HTML omitted -->Версия для 7.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->User Profile Wizard&lt;!-- raw HTML omitted -->. Бесплатная утилита от ForensIT. Смогла перенести все данные и настройки. Проблем пока не замечено. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Ещё можно написать скрипт на WMI/batch/PowerShell/brainfuck/что-то_ещё - но это уже другая история.&lt;!-- raw HTML omitted -->После переноса профиля обязательно проверяйте всё - скорее всего что-то обработалось неправильно и придется доделывать руками.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Тема &lt;!-- raw HTML omitted -->на форуме, где я поднимал этот вопрос.&lt;/p></content></item><item><title>Скрипт. Заливка файлов на FTP</title><link>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82.-%D0%B7%D0%B0%D0%BB%D0%B8%D0%B2%D0%BA%D0%B0-%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2-%D0%BD%D0%B0-ftp/</link><pubDate>Mon, 15 Aug 2011 20:41:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82.-%D0%B7%D0%B0%D0%BB%D0%B8%D0%B2%D0%BA%D0%B0-%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2-%D0%BD%D0%B0-ftp/</guid><description>Этот скрипт был написан для предотвращения нежелательных последствий от BSOD. Скрипт просматривает папку с дампами BSOD. Если дампы есть (синий экран был), то создаёт на FTP-сервере папку с датой создания дампа в качестве имени, а внутри неё папку с именем сбойной машины. И уже в эту папку копирует дампы. Затем переименовывает дампы в *.dmp.old, чтобы на следующий день их не копировать. Если скрипт запущен впервые, он копирует дампы как положено (каждый на свою дату).</description><content>&lt;p>Этот скрипт был написан для предотвращения нежелательных последствий от BSOD. Скрипт просматривает папку с дампами BSOD. Если дампы есть (синий экран был), то создаёт на FTP-сервере папку с датой создания дампа в качестве имени, а внутри неё папку с именем сбойной машины. И уже в эту папку копирует дампы. Затем переименовывает дампы в *.dmp.old, чтобы на следующий день их не копировать. Если скрипт запущен впервые, он копирует дампы как положено (каждый на свою дату).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Краткое описание скрипта:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция check. Проверяет, есть ли уже дампы. Если нет, скрипт заканчивает свою работу. Если да - переходит на следующую секцию.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция makeftpcommand. Создаёт файл с именем script, в который пишет команды для работы с FTP.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция makedirectory. Анализирует папку с дампами и записывает в script команду для создания папки на FTP-сервере с именем вида дата/имя_машины.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция copyfiles. Заливает дамп в нужную папку.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция rename. Переименовывает дамп в &lt;em>.dmp.old, чтобы при следующем запуске не копировать уже скопированные файлы.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Оставшиеся строки закрывают файл script, выполняют его и удаляют.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo on&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo =======================================&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Copying memory dumps on FTP-server&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo =======================================&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Script started&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->set $SRC=&amp;quot;%systemroot%\minidump&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:check&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Checking files&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@if exist $SRC*.dmp goto makeftpcommand&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:makeftpcommand&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->set addr=script&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.open 127.0.0.1&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.anonymous&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.binary&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:makedirectory&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Making directories&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->for %%a in (%$SRC%) do (for /f &amp;ldquo;tokens=1&amp;rdquo; %%b in (&amp;quot;%%~ta&amp;quot;) do (echo.mkdir %%~b%computername%&amp;gt;&amp;gt;%ADDR%))&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:copyfiles&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Copying files&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->for %%a in (%$SRC%) do (for /f &amp;ldquo;tokens=1&amp;rdquo; %%b in (&amp;quot;%%~ta&amp;quot;) do (echo.cd %%~b%computername%&amp;gt;&amp;gt;%ADDR% &amp;amp;&amp;amp; echo.send %%a &amp;gt;&amp;gt;%ADDR% &amp;amp;&amp;amp; echo.cd ../..&amp;gt;&amp;gt;%ADDR%))&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:rename&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->for /f &amp;ldquo;tokens=1&amp;rdquo; %%a in (&amp;lsquo;dir /b %$SRC%*.&lt;/em>&amp;rsquo;) do ren %$SRC%%%a %%a.old&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.bye&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->ftp.exe -s:%ADDR% &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->del /F /Q script&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Скрипт для поднятия pptp в Ubuntu</title><link>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BE%D0%B4%D0%BD%D1%8F%D1%82%D0%B8%D1%8F-pptp-%D0%B2-ubuntu/</link><pubDate>Mon, 06 Dec 2010 11:05:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BE%D0%B4%D0%BD%D1%8F%D1%82%D0%B8%D1%8F-pptp-%D0%B2-ubuntu/</guid><description>Каждый раз при включении компа прописыать роутинг и поднимать впн неудобно. Проще написать скрипт, который сделает всё это сам и кинуть его в автозагрузку.Вот скрипт:#!/bin/bash #указываем кто будет выполнять скрипт (bash)route del default #убираем дефолтный маршрутLOG=&amp;quot;/var/log/pptp-run.log&amp;quot; #логи будут писаться в /var/log/pptp-run.logwhile true;do echo -e &amp;ldquo;\n==============================================\n date&amp;rdquo; &amp;gt;&amp;gt; $LOG /usr/sbin/pptp vpn.server.ru &amp;gt;&amp;gt; $LOG #вывод сообщений из pptp в pptp-run.log sleep 10;doneСохраняем его в /usr/local/bin/pptp-run-sh. Не забываем сделать его исполняемым: chmod +x pptp-run.</description><content>&lt;p>Каждый раз при включении компа прописыать роутинг и поднимать впн неудобно. Проще написать скрипт, который сделает всё это сам и кинуть его в автозагрузку.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Вот скрипт:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#!/bin/bash           #указываем кто будет выполнять скрипт (bash)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->route del default     #убираем дефолтный маршрут&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->LOG=&amp;quot;/var/log/pptp-run.log&amp;quot;     #логи будут писаться в /var/log/pptp-run.log&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->while true;do&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> echo -e &amp;ldquo;\n==============================================\n &lt;code>date&lt;/code>&amp;rdquo; &amp;gt;&amp;gt; $LOG&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> /usr/sbin/pptp vpn.server.ru &amp;gt;&amp;gt; $LOG     #вывод сообщений из pptp в pptp-run.log&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> sleep 10;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->done&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Сохраняем его в /usr/local/bin/pptp-run-sh. Не забываем сделать его исполняемым: &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->chmod +x pptp-run.sh&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->И прописываем в автозагрузку:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->sudo nano /etc/rc.local&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->последней строчкой указываем: &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> /usr/local/bin/pptp-run.sh&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Всё! Скрипт будет выполняться при запуске системы с правами системы (а может и нет=)), а так же при очередном &amp;ldquo;отваливании&amp;rdquo; впн-соединения. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Автоматизация</title><link>https://bubnovd.net/blogger/%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/</link><pubDate>Tue, 26 Oct 2010 02:15:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/</guid><description>Недавно по работе понадобилась сделать так, чтобы при появлении окошка от программы, в нем автоматически нажимались определенные кнопки и окошко закрывалось(чтобы не грузить пользователей лишней работой). Первые мысли - батник или VBScript. VBScript я совсем не знаю, хотя ради такого можно было разобраться. А вот насчет батника гугл сказал, что не прокатит. В итоге остановился на прекрасной программке - AutoIT. Это программка со скриптовым языком, позволяющая автоматизировать работу.Всё предельно просто. Мой скрипт ждал появление окошка, затем жал на кнопочку, потом во втором окошке - ещё одну, снова ждём около минуты и нажимаем ОК.</description><content>&lt;p>Недавно по работе понадобилась сделать так, чтобы при появлении окошка от программы, в нем автоматически нажимались определенные кнопки и окошко закрывалось(чтобы не грузить пользователей лишней работой). Первые мысли - батник или VBScript. VBScript я совсем не знаю, хотя ради такого можно было разобраться. А вот насчет батника гугл сказал, что не прокатит. В итоге остановился на прекрасной программке - &lt;!-- raw HTML omitted -->AutoIT&lt;!-- raw HTML omitted -->. Это программка со скриптовым языком, позволяющая автоматизировать работу.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Всё предельно просто. Мой скрипт ждал появление окошка, затем жал на кнопочку, потом во втором окошке - ещё одну, снова ждём около минуты и нажимаем ОК. На всё про всё включая чтения FAQ, гугление и написание скрипта у меня ушло минут 15. Так что рекомендую!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->FAQ на OSZone&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Вот мой скрипт:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->If WinExists(@ScriptName) Then Exit                          ; Проверяем не запущена ли&lt;!-- raw HTML omitted -->AutoItWinSetTitle(@ScriptName)                                 ; уже копия скрипта&lt;!-- raw HTML omitted -->Run(&amp;quot;\192.168.0.254\SoftwareInfentory\tniaudit.exe&amp;quot;)    ; Запускаем софтину&lt;!-- raw HTML omitted -->WinWaitActive(&amp;ldquo;Confirm&amp;rdquo;)                                            ; Ждём окно&lt;!-- raw HTML omitted -->Send(&amp;quot;!y&amp;quot;)                                                                  ; Жмем Yes&lt;!-- raw HTML omitted -->WinWaitActive(&amp;ldquo;Information&amp;rdquo;)                                       ; Ждём окно&lt;!-- raw HTML omitted -->Send(&amp;rsquo;{ENTER}&amp;rsquo;)                                                         ; Жмём кнопку, выбранную&lt;!-- raw HTML omitted -->                                                                                ; по умолчанию&lt;!-- raw HTML omitted -->WinWaitActive(&amp;ldquo;Information&amp;rdquo;)                                       ; Ждём окно &lt;!-- raw HTML omitted -->Send(&amp;rsquo;{ENTER}&amp;rsquo;)                                                         ; Жмём кнопку, выбранную&lt;!-- raw HTML omitted -->                                                                                ; по умолчанию&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->UPD 29.10.10.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->А сегодня появился пост на &lt;!-- raw HTML omitted -->хабре&lt;!-- raw HTML omitted --> на эту тему =)&lt;!-- raw HTML omitted -->Ещё по AutoIt была серия статей в журнале Системный администратор (2005.4 - 2005.7)&lt;/p></content></item></channel></rss>