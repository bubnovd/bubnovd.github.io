<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Iac on Админская фамилия</title><link>https://bubnovd.net/tags/iac/</link><description>Recent content in Iac on Админская фамилия</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Wed, 22 Nov 2023 04:02:52 +0000</lastBuildDate><atom:link href="https://bubnovd.net/tags/iac/index.xml" rel="self" type="application/rss+xml"/><item><title>Keycloak. Configuration as Code</title><link>https://bubnovd.net/post/keycloak-iac/</link><pubDate>Wed, 22 Nov 2023 04:02:52 +0000</pubDate><guid>https://bubnovd.net/post/keycloak-iac/</guid><description>Представленная конфигурация keycloak создает федерацию LDAP для подключения к Active Directory и клиента k8s-client для взаимодействия с kubernetes по OIDC. В федерацию добавлен маппинг групп AD.
Конфигурацию производит job keycloak-config-cli после деплоя хелм чарта (post-install hook). Детальное описание, примеры конфигурации
В kube-apiserver нужно добавить аргументы:
--oidc-client-id=k8s-client --oidc-issuer-url=https://your.keycloak.url/realms/realmWithLdap --oidc-groups-claim=groups --oidc-username-claim=name следующие аргументы необязательны --oidc-username-prefix=&amp;quot;keycloak:&amp;quot; --oidc-groups-prefix=&amp;quot;keycloak:&amp;quot; Конфигурация работает с чартом https://github.com/bitnami/charts/tree/main/bitnami/keycloak версии 17.1.0
Secret keycloak-config-cli must contain CLIENT_SECRET and LDAP_BIND_CREDS IMPORT_VARSUBSTITUTION_ENABLED needs for substitute data from secret like &amp;quot;$(env:LDAP_BIND_CREDS)&amp;quot; keycloakConfigCli: enabled: true image: registry: docker.</description></item></channel></rss>