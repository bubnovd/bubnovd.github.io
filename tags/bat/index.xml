<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>bat on Bubnovd</title><link>https://bubnovd.github.io/tags/bat/</link><description>Recent content in bat on Bubnovd</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 15 Aug 2011 20:41:00 +0000</lastBuildDate><atom:link href="https://bubnovd.github.io/tags/bat/index.xml" rel="self" type="application/rss+xml"/><item><title>Скрипт. Заливка файлов на FTP</title><link>https://bubnovd.github.io/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82.-%D0%B7%D0%B0%D0%BB%D0%B8%D0%B2%D0%BA%D0%B0-%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2-%D0%BD%D0%B0-ftp/</link><pubDate>Mon, 15 Aug 2011 20:41:00 +0000</pubDate><guid>https://bubnovd.github.io/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82.-%D0%B7%D0%B0%D0%BB%D0%B8%D0%B2%D0%BA%D0%B0-%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2-%D0%BD%D0%B0-ftp/</guid><description>Этот скрипт был написан для предотвращения нежелательных последствий от BSOD. Скрипт просматривает папку с дампами BSOD. Если дампы есть (синий экран был), то создаёт на FTP-сервере папку с датой создания дампа в качестве имени, а внутри неё папку с именем сбойной машины. И уже в эту папку копирует дампы. Затем переименовывает дампы в *.dmp.old, чтобы на следующий день их не копировать. Если скрипт запущен впервые, он копирует дампы как положено (каждый на свою дату).</description><content>&lt;p>Этот скрипт был написан для предотвращения нежелательных последствий от BSOD. Скрипт просматривает папку с дампами BSOD. Если дампы есть (синий экран был), то создаёт на FTP-сервере папку с датой создания дампа в качестве имени, а внутри неё папку с именем сбойной машины. И уже в эту папку копирует дампы. Затем переименовывает дампы в *.dmp.old, чтобы на следующий день их не копировать. Если скрипт запущен впервые, он копирует дампы как положено (каждый на свою дату).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Краткое описание скрипта:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция check. Проверяет, есть ли уже дампы. Если нет, скрипт заканчивает свою работу. Если да - переходит на следующую секцию.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция makeftpcommand. Создаёт файл с именем script, в который пишет команды для работы с FTP.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция makedirectory. Анализирует папку с дампами и записывает в script команду для создания папки на FTP-сервере с именем вида дата/имя_машины.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция copyfiles. Заливает дамп в нужную папку.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Секция rename. Переименовывает дамп в &lt;em>.dmp.old, чтобы при следующем запуске не копировать уже скопированные файлы.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Оставшиеся строки закрывают файл script, выполняют его и удаляют.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo on&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo =======================================&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Copying memory dumps on FTP-server&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo =======================================&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Script started&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->set $SRC=&amp;quot;%systemroot%\minidump&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:check&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Checking files&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@if exist $SRC*.dmp goto makeftpcommand&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:makeftpcommand&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->set addr=script&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.open 127.0.0.1&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.anonymous&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.binary&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:makedirectory&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Making directories&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->for %%a in (%$SRC%) do (for /f &amp;ldquo;tokens=1&amp;rdquo; %%b in (&amp;quot;%%~ta&amp;quot;) do (echo.mkdir %%~b%computername%&amp;gt;&amp;gt;%ADDR%))&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:copyfiles&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->@echo Copying files&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->for %%a in (%$SRC%) do (for /f &amp;ldquo;tokens=1&amp;rdquo; %%b in (&amp;quot;%%~ta&amp;quot;) do (echo.cd %%~b%computername%&amp;gt;&amp;gt;%ADDR% &amp;amp;&amp;amp; echo.send %%a &amp;gt;&amp;gt;%ADDR% &amp;amp;&amp;amp; echo.cd ../..&amp;gt;&amp;gt;%ADDR%))&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:rename&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->for /f &amp;ldquo;tokens=1&amp;rdquo; %%a in (&amp;lsquo;dir /b %$SRC%*.&lt;/em>&amp;rsquo;) do ren %$SRC%%%a %%a.old&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->echo.bye&amp;gt;&amp;gt; %ADDR%&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->ftp.exe -s:%ADDR% &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->del /F /Q script&lt;!-- raw HTML omitted -->&lt;/p></content></item></channel></rss>