<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Mikrotik on Админская фамилия</title><link>https://bubnovd.net/tags/mikrotik/</link><description>Recent content in Mikrotik on Админская фамилия</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 18 Aug 2019 00:26:00 +0000</lastBuildDate><atom:link href="https://bubnovd.net/tags/mikrotik/index.xml" rel="self" type="application/rss+xml"/><item><title>Топология лаб для EVE-NG</title><link>https://bubnovd.net/blogger/%D1%82%D0%BE%D0%BF%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F-%D0%BB%D0%B0%D0%B1-%D0%B4%D0%BB%D1%8F-eve-ng/</link><pubDate>Sun, 18 Aug 2019 00:26:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%82%D0%BE%D0%BF%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F-%D0%BB%D0%B0%D0%B1-%D0%B4%D0%BB%D1%8F-eve-ng/</guid><description>В ходе подготовки к CCNA нужно было обжиться в консоли Cisco. Для этого я поднял EVE-NG в облаке гугла и развернул там тополгию для опытов с OSPF.А чтобы моё время не прошло зря, решил описать эти лабы и выложить топологию сетей. Заодно переделал эти лабы под Mikrotik RouterOS.Лабы по ссылке. Пользуйтесь!</description><content>&lt;p>В ходе подготовки к CCNA нужно было обжиться в консоли Cisco. Для этого я поднял EVE-NG в облаке гугла и развернул там тополгию для опытов с OSPF.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->А чтобы моё время не прошло зря, решил описать эти лабы и выложить топологию сетей. Заодно переделал эти лабы под Mikrotik RouterOS.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Лабы по &lt;!-- raw HTML omitted -->ссылке&lt;!-- raw HTML omitted -->. Пользуйтесь!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>MTCNA VS CCNA. Mikrotik VS Cisco</title><link>https://bubnovd.net/blogger/mtcna-vs-ccna.-mikrotik-vs-cisco/</link><pubDate>Thu, 17 May 2018 21:37:00 +0000</pubDate><guid>https://bubnovd.net/blogger/mtcna-vs-ccna.-mikrotik-vs-cisco/</guid><description>Недавно в одной соцсети меня спросили о том, сертификаты какого вендора получить выгоднее и на что сделать упор при изучении. Мой ответ мне самому уж больно понравился и я решил оформить его в виде поста. Тем более такие вопросы поступают с завидной периодичностью и теперь я могу давать просто ссылку на этот пост. Спасибо за диалог, Павел!
У меня тоже стояла дилемма выбора направления для дальнейшего развития несколько лет назад. Поэтому расскажу о своём опыте.</description><content>&lt;p>Недавно в одной &lt;a href="https://vk.com/mikrotikninja">соцсети&lt;/a> меня спросили о том, сертификаты какого вендора получить выгоднее и на что сделать упор при изучении. Мой ответ мне самому уж больно понравился и я решил оформить его в виде поста. Тем более такие вопросы поступают с завидной периодичностью и теперь я могу давать просто ссылку на этот пост. Спасибо за диалог, Павел!&lt;/p>
&lt;p>У меня тоже стояла дилемма выбора направления для дальнейшего развития несколько лет назад. Поэтому расскажу о своём опыте.&lt;/p>
&lt;p>Cisco это локомотив сетевых технологий и практически стандарт в сетях по всему миру. Но её возможности для многих просто избыточны. Ну ни к чему в офис из пяти компьютеров ставить маршрутизатор за сотню тысяч рублей.&lt;/p>
&lt;p>С микротиком ситуация обратная. Ничего _принципиально_ нового микротик не придумал. Но у них очень хорошая бизнес модель. Микротик сейчас уже почти стандарт во многих странах. В Индии нереально устроиться на работу айтишником, не имея сертификата микротика. Латинская Америка, Африка, Азия, Восточная Европа, Россия. Все эти регионы массово поглощают оборудование Mikrotik. Показателем этого могут служить многотысячные Mikrotik User Meeting в этих местах. Даже богатые Европа и Америка уже активно пользуется микротиками. В России Mikrotik уже захватил весь сектор SMB&lt;/p>
&lt;p>А это значит, что микротик и дальше продолжит свою экспансию на мир. Да, в высоконагруженных проектах и больших датацентарх останутся Cisco с Juniper. Но ведь бОльшая часть бизнеса в мире - вовсе не датацентры и им не нужна такая производительность как у Cisco. А значит, они будут ставить D-Link, TP-Link, а когда узнают о возможностях Mikrotik, поставят его.&lt;/p>
&lt;p>Это значит, что работы для специалиста по Mikrotik хватит на десятки лет. Её будет много, она будет неплохо оплачиваться, она будет интересной. Но, как я сказал выше: Cisco - локомотив технологий. Они изобретают новое и с ними нужно считаться. Поэтому лично я пошел таким путем: сертифицировался по Mikrotik, а для развития читаю книги Cisco Press и строю лабы в EVE-NG.&lt;/p>
&lt;p>Таким образом, у меня всегда есть заказчики, которые приносят деьги за настройку Mikrotik и есть знания о современных нагруженных сетях и в случае необходимости настроить ту же Cisco, я сделаю это. Просто на настройку Cisco у меня уйдет больше времени, чем на родной Mikrotik.&lt;/p>
&lt;p>Так что я рекомендую начать с изучения Mikrotik. А через несколько лет работы с сетями придет понимание в какую сторону двигаться дальше. Если выбор упадет на работу с корпоративными сетями малых и средних масштабов, то однозначно Mikrotik. Если датацентры или банки или что-то большое, то уже смотреть на других вендоров. С сертификатами Cisco есть шансы получать больше денег, но далеко не всем, пишущим в вакансии о сертификатах Cisco действительно нужны спецы с сертификатами.&lt;/p>
&lt;p>Вопросы по Mikrotik RouterOS  можно задать мне прямо тут или в соцсетях. Контакты есть в &lt;a href="http://www.bubnovd.net/2017/10/aboutauthor.html">этом посте&lt;/a>. Наши официальные курсы Mikrotik &lt;a href="http://mikrotik-ninja.ru/">на сайте Mikrotik Ninja&lt;/a>.&lt;/p></content></item><item><title>Разрушаю панику вокруг безопасности Mikrotik RouterOS</title><link>https://bubnovd.net/blogger/%D1%80%D0%B0%D0%B7%D1%80%D1%83%D1%88%D0%B0%D1%8E-%D0%BF%D0%B0%D0%BD%D0%B8%D0%BA%D1%83-%D0%B2%D0%BE%D0%BA%D1%80%D1%83%D0%B3-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8-mikrotik-routeros/</link><pubDate>Thu, 29 Mar 2018 02:48:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%80%D0%B0%D0%B7%D1%80%D1%83%D1%88%D0%B0%D1%8E-%D0%BF%D0%B0%D0%BD%D0%B8%D0%BA%D1%83-%D0%B2%D0%BE%D0%BA%D1%80%D1%83%D0%B3-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8-mikrotik-routeros/</guid><description>В последнее время мы часто слышим о ботнетах, использующих RouterOS. И это даже хорошо, ведь говорит о том, что платформа настолько развилась, что представляет интерес для широкой аудитории, а соответственно и хакерам. А значит, что специалисты по Mikrotik будут в цене!Но хватит лирики. Спешу развеять ваши опасения об опасности использования RouterOS. Ботнет Hajime заражает RouterOS. Отсюда и паника, поднятая в Интернете. Но, если прочитать чуть внимательнее, то заражает он версии RouterOS ниже 6.</description><content>&lt;p>В последнее время мы часто слышим о ботнетах, использующих RouterOS. И это даже хорошо, ведь говорит о том, что платформа настолько развилась, что представляет интерес для широкой аудитории, а соответственно и хакерам. А значит, что специалисты по Mikrotik будут в цене!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Но хватит лирики. Спешу развеять ваши опасения об опасности использования RouterOS. Ботнет Hajime заражает RouterOS. Отсюда и паника, поднятая в Интернете. Но, если прочитать чуть внимательнее, то заражает он версии RouterOS ниже 6.38.5 (или 6.37.5 в bugfix ветке). А значит, что если вы обновляли свою RouterOS хотя бы раз в течение последних 12 месяцев, то вы в безопасности!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как работает Hajime:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1. Сканированием портов обнаруживаем RouterOS по открытому tcp 8291&lt;!-- raw HTML omitted -->2. Уязвимость в web сервере webfig&amp;rsquo;a, значит через tcp 80 заражаем его&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Отсюда выводы:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->ВЫ В БЕЗОПАСНОСТИ,&lt;!-- raw HTML omitted --> если выполнили хотя бы одно действие из списка:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1. Обновлялись в последние 12 месяцев и версия RouterOS у вас 6.38.5 (6.37.5 для bugfix) или выше. Сейчас актуальная 6.41.3 (6.40.6 bugfix)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->2. У вас отключен web сервер: ip - service - www&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->3. Настроен фаервол. А именно доступ к tcp 80 из недоверенных сетей&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->4. Отключен webfig. То есть на 80 порту работает веб-фронтенд для прокси, User Manager&amp;rsquo;a или хотспота&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->5. У вас переназначен порт WinBox&amp;rsquo;a на нестандартный (не 8291). В этом случае вы защищены только от сканирования, на www сервис все равно под ударом&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->6. У вас отключен сервис WinBox. В этом случае вы защищены только от сканирования, на www сервис все равно под ударом&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->7. В ip - service указаны IP адреса,  с которых можно подключаться к этим сервисам&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Не забывайте, что заразиться можно не только из Интернета, но и из доверенной сети LAN, если кто-то внутри уже подхватил заразу.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как видите, все беды опять идут от раздолбайства. Своевременно обновляйте ПО, настраивайте фаерволы, устанавливайте доверенные сети и не будете знать проблем. Оригинал материала на &lt;!-- raw HTML omitted -->форуме&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как обезопасить свой Mikrotik мы подробно рассматриваем на &lt;!-- raw HTML omitted -->курсе MTCNA&lt;!-- raw HTML omitted -->. Приходите и узнайте как не попасться на удочку хакеров.&lt;/p></content></item><item><title>Проверка пропускной способности канала на Mikrotik</title><link>https://bubnovd.net/blogger/%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0-%D0%BF%D1%80%D0%BE%D0%BF%D1%83%D1%81%D0%BA%D0%BD%D0%BE%D0%B9-%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB%D0%B0-%D0%BD%D0%B0-mikrotik/</link><pubDate>Thu, 21 Dec 2017 08:52:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0-%D0%BF%D1%80%D0%BE%D0%BF%D1%83%D1%81%D0%BA%D0%BD%D0%BE%D0%B9-%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB%D0%B0-%D0%BD%D0%B0-mikrotik/</guid><description>Скрипт для Mikrotik RouterOS, тестирующий пропускную способность канала и записывающий результат в файл. Перед запуском создать файл isp-quality.txt и указать IP своего btest сервера в ipbandswtestserverhttps://github.com/devi1/RouterOS-scripts/tree/master/bandwidth%20test:local txAvg 0:local rxAvg 0:local ipbandswtestserver your.btest.server.ip:local btuser btest:local btpwd btest:local ts [/system clock get time]:local ContentsFile [/file get isp-quality.txt contents]:local ds [/system clock get date]:set ts ([:pick $ts 0 2].[:pick $ts 3 5].[:pick $ts 6 8]):set ds ([:pick $ds 7 11].[:pick $ds 0 3].[:pick $ds 4 6])tool bandwidth-test protocol=tcp direction=transmit address=$ipbandswtestserver duration=5s do={:set txAvg ($&amp;ldquo;tx-total-average&amp;rdquo; / 1048576 );}tool bandwidth-test protocol=tcp direction=receive address=$ipbandswtestserver duration=5s do={:set rxAvg ($&amp;ldquo;rx-total-average&amp;rdquo; / 1048576 );}/file set isp-quality.</description><content>&lt;p>Скрипт для Mikrotik RouterOS, тестирующий пропускную способность канала и записывающий результат в файл. Перед запуском создать файл isp-quality.txt и указать IP своего btest сервера в ipbandswtestserver&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;a href="https://github.com/devi1/RouterOS-scripts/tree/master/bandwidth%20test">https://github.com/devi1/RouterOS-scripts/tree/master/bandwidth%20test&lt;/a>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local txAvg 0&lt;!-- raw HTML omitted -->:local rxAvg 0&lt;!-- raw HTML omitted -->:local ipbandswtestserver your.btest.server.ip&lt;!-- raw HTML omitted -->:local btuser btest&lt;!-- raw HTML omitted -->:local btpwd btest&lt;!-- raw HTML omitted -->:local ts [/system clock get time]&lt;!-- raw HTML omitted -->:local ContentsFile [/file get isp-quality.txt contents]&lt;!-- raw HTML omitted -->:local ds [/system clock get date]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:set ts ([:pick $ts 0 2].[:pick $ts 3 5].[:pick $ts 6 8])&lt;!-- raw HTML omitted -->:set ds ([:pick $ds 7 11].[:pick $ds 0 3].[:pick $ds 4 6])&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->tool bandwidth-test protocol=tcp direction=transmit address=$ipbandswtestserver duration=5s do={&lt;!-- raw HTML omitted -->:set txAvg ($&amp;ldquo;tx-total-average&amp;rdquo; / 1048576 );&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->tool bandwidth-test protocol=tcp direction=receive address=$ipbandswtestserver duration=5s do={&lt;!-- raw HTML omitted -->:set rxAvg ($&amp;ldquo;rx-total-average&amp;rdquo; / 1048576 );&lt;!-- raw HTML omitted -->}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/file set isp-quality.txt contents=&amp;quot;$ContentsFile\n$ds-$ts tx: $txAvg Mbps - rx: $rxAvg Mbps&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Мikrotik RouterOS Configuration Management с помощью скриптов и какой-то там матери</title><link>https://bubnovd.net/blogger/%D0%BCikrotik-routeros-configuration-management-%D1%81-%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E-%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B2-%D0%B8-%D0%BA%D0%B0%D0%BA%D0%BE%D0%B9-%D1%82%D0%BE-%D1%82%D0%B0%D0%BC-%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D0%B8/</link><pubDate>Mon, 20 Nov 2017 09:56:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BCikrotik-routeros-configuration-management-%D1%81-%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E-%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B2-%D0%B8-%D0%BA%D0%B0%D0%BA%D0%BE%D0%B9-%D1%82%D0%BE-%D1%82%D0%B0%D0%BC-%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D0%B8/</guid><description>Жизненный цикл сети часто переживает закономерный рост. В это время начинают появляться десятки и сотни устройств, конфигурация которых однотипна. Например, это могут быть маршрутизаторы в филиалах, которые имеют одинаковые настройки и отличаются только IP адресами, паролями на VPN и Wi-Fi. Внесение даже незначительных изменений на десяток устройств потребует значительного времени и концентрации.Для управления сотнями и тысячами устройств весь цивилизованный мир уже давно использует специальные системы менеджмента конфигураций: Ansible, Chef, Puppet. Каждая из них имеет свои плюсы и минусы.</description><content>&lt;p>Жизненный цикл сети часто переживает закономерный рост. В это время начинают появляться десятки и сотни устройств, конфигурация которых однотипна. Например, это могут быть маршрутизаторы в филиалах, которые имеют одинаковые настройки и отличаются только IP адресами, паролями на VPN и Wi-Fi. Внесение даже незначительных изменений на десяток устройств потребует значительного времени и концентрации.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Для управления сотнями и тысячами устройств весь цивилизованный мир уже давно использует специальные системы менеджмента конфигураций: &lt;!-- raw HTML omitted -->Ansible&lt;!-- raw HTML omitted -->, &lt;!-- raw HTML omitted -->Chef&lt;!-- raw HTML omitted -->, &lt;!-- raw HTML omitted -->Puppet&lt;!-- raw HTML omitted -->. Каждая из них имеет свои плюсы и минусы.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Но для десяти-двадцати устройств не каждый захочет выделять отдельный сервер с такой системой. Поэтому в ход идут скрипты, SSH, FTP и куча матов, когда всё это поделие роняет сразу все филиалы.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Видео для привлечения внимания&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> Это визуализация запросов от роутеров к системе, о которой идет речь в этом посте. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Я тоже накостылил подобную систему в соответствии со своими потребностями и расскажу о ней.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Мои требования к системе централизованного управления:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Надежность.  Система должна работать независимо от скорости соединения или после месячного оффлайна&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Приемлемая скорость актуализации конфигурации. Если девайс месяц не включался, то свежий конфиг он должен применить за обозримое время&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Низкая нагрузка на каналы связи и ресурсы сервера. Обновление конфигурации не должно положить интернет в ЦОДе и процессор машины&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Масштабируемость. Систему можно увеличить в 5-10 раз&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Разделение устройств по группам. Применение разных настроек к разным группам&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Обратная связь о применении конфигурации &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Постараться не использовать Flash память микротика по причине её износа&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Из требований родились идеи к реализации:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Чтобы обеспечить применение всех изменений, роутер должен сам обращаться за конфигурацией&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Актуализация обеспечивается за счет опроса сервера раз в час&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Чтобы не нагружать ресурсы и каналы, роутеры должны обращаться за обновлениями в разное время&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Для оповещений использовать Telegram &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Следование принципу &lt;!-- raw HTML omitted -->KISS&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Для работы системы понадобится только web сервер. В моем случае apache. Как его &lt;!-- raw HTML omitted -->установить&lt;!-- raw HTML omitted --> и &lt;!-- raw HTML omitted -->настроить&lt;!-- raw HTML omitted --> я &lt;!-- raw HTML omitted -->рассказывать&lt;!-- raw HTML omitted --> не буду, к тому же необязательно это должен быть апач.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Логика такая: на веб сервере лежат RouterOS скрипты, с определенным именованием. Имя скрипта указывает на его версию и группу устройств, для которой должна примениться конфигурация. Маршрутизаторы с периодичностью раз в час обращаются к серверу за новым конфигом. Если новый конфиг есть, то он скачивается на роутер и выполняется. Если конфига нет - ничего не скачивается, что позволяет не дергать лишний раз быстроубиваемую память.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Чтобы начать применять подобную систему, надо привести конфиги всех роутеров к одному стандарту. К примеру, не так давно в RouterOS появилась новая фича: Interface List. Теперь можно одним правилом в фаерволе заменить несколько правил, если их надо применить к разным интерфейсам. Наш скрипт должен добавить в интерфейс-лист интерфейс, который &amp;ldquo;смотрит&amp;rdquo; к провайдеру. На одном роутере это может быть eth1, на другом PPPoE, на третьем - вообще wlan1.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как в таком случае поступить? Надо как-то выделить внешние интерфейсы. Например, добавить к ним комментарий &amp;ldquo;WAN&amp;rdquo;.&lt;!-- raw HTML omitted -->Также стОит привести к одному виду фаервол, Queues - вообще всё, что есть на роутерах. И создать отдельную учетную запись,  с правами которой будут выполняться скрипты. Как создать скрипт для быстрой настройки роутеров я расскажу в следующем посте.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Принцип именования скриптов: A000, где А - группа устройств, а номер - версия скрипта.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Каждому роутеру в планировщик добавляем такие строки:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/system scheduler&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/tool fetch url=&amp;ldquo;&lt;a href="http://rbconf.bubnovd.net/A001%22">http://rbconf.bubnovd.net/A001&amp;quot;&lt;/a> user=mikrotik-ninja password=mikrotik-ninja.ru&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/import A001&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Это задание скачивает с сервера скрипт и выполняет его. Для обеспечения хоть какой-то безопасности, доступ к серверу только по паролю, который указан в задании.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Сами скрипты лежат на сервере и выглядят примерно так:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/log info message=&amp;rdquo;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;Autoconfiguration started&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;quot;&lt;!-- raw HTML omitted -->#Версия внедряемой конфигурации&lt;!-- raw HTML omitted -->#Описание задачи, которую выполняет скрипт: Удаление пользователя&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#Первая часть скрипта нужна для только для определения  версии конфига, который нужно применить следующим&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local ver&lt;!-- raw HTML omitted -->:set $ver A001&lt;!-- raw HTML omitted -->#Версия следующей конфигурации&lt;!-- raw HTML omitted -->:local verNext&lt;!-- raw HTML omitted -->#Версия предыдущей конфигурации&lt;!-- raw HTML omitted -->:local verPrev&lt;!-- raw HTML omitted -->:set $verNext (&amp;ldquo;A&amp;rdquo; . [tostr ([tonum [pick $ver 1 4]] + 1)])&lt;!-- raw HTML omitted -->:set $verPrev (&amp;ldquo;A&amp;rdquo; . [tostr ([tonum [pick $ver 1 4]] - 1)])&lt;!-- raw HTML omitted -->#Добавляем нули, если надо&lt;!-- raw HTML omitted -->        if ([:len $verNext] =2) do={&lt;!-- raw HTML omitted -->                :set $verNext ([pick $verNext 0 1] . &amp;ldquo;00&amp;rdquo; . [pick $verNext ([len $verNext] -1) ([len $verNext])])} else={&lt;!-- raw HTML omitted -->                if ([:len $verNext] =3) do={&lt;!-- raw HTML omitted -->                        :set $verNext ([pick $verNext 0 1] . &amp;ldquo;0&amp;rdquo; . [pick $verNext ([len $verNext] -2) ([len $verNext])])} else={}}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        if ([:len $verPrev] =2) do={&lt;!-- raw HTML omitted -->                :set $verPrev ([pick $verPrev 0 1] . &amp;ldquo;00&amp;rdquo; . [pick $verPrev ([len $verPrev] -1) ([len $verPrev])])} else={&lt;!-- raw HTML omitted -->                if ([:len $verPrev] =3) do={&lt;!-- raw HTML omitted -->                        :set $verPrev ([pick $verPrev 0 1] . &amp;ldquo;0&amp;rdquo; . [pick $verPrev ([len $verPrev] -2) ([len $verPrev])])} else={}}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --># Вторая часть скрипта - наша рабочая конфигурация &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#####&lt;!-- raw HTML omitted -->#####Тут код конфигурации&lt;!-- raw HTML omitted -->#####&lt;!-- raw HTML omitted -->if ([len [/user find name=&amp;ldquo;prosvirnin&amp;rdquo;]]&amp;gt;0) do={/user remove [find name=&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->prosvirnin&lt;!-- raw HTML omitted -->&amp;quot;]} else={/log info message=&amp;ldquo;User not exist&amp;rdquo;}&lt;!-- raw HTML omitted -->#####&lt;!-- raw HTML omitted -->#/log info message=&amp;ldquo;Creating script $ver&amp;rdquo;&lt;!-- raw HTML omitted -->#/system script add name=$ver source=&amp;quot;/log info message=done&amp;quot;&lt;!-- raw HTML omitted -->#/log info message=&amp;ldquo;Script $ver created. Starting&amp;rdquo;&lt;!-- raw HTML omitted -->#/system script run $ver&lt;!-- raw HTML omitted -->#/log info message=&amp;ldquo;Removing script $ver&amp;rdquo;&lt;!-- raw HTML omitted -->#/system script remove $ver&lt;!-- raw HTML omitted -->##### Или в скрипте выше&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --># Третья часть - настройка планировщика для следующего изменения, оповещение и чистка файлов&lt;!-- raw HTML omitted -->/system scheduler set autoconf on-event=&amp;quot;/tool fetch url=&amp;quot;http://rbconf.bubnovd.net/$verNext&amp;quot; user=mikrotik-ninja password=mikrotik-ninja.ru\r\n&lt;!-- raw HTML omitted -->/import $verNext&amp;quot;&lt;!-- raw HTML omitted -->/log info message=&amp;quot;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;.Autoconfiguration complete&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;.&amp;quot;&lt;!-- raw HTML omitted -->/delay 3&lt;!-- raw HTML omitted -->#Удаляем остатки предыдущих скриптов, если не удалились&lt;!-- raw HTML omitted -->if ([:len [/file find name~&amp;ldquo;sendMessage&amp;rdquo;]] &amp;gt;0) do={/file remove [/file find name~&amp;ldquo;sendMessage&amp;rdquo;]} else={/log info message=&amp;ldquo;No item for delete&amp;rdquo;}&lt;!-- raw HTML omitted -->if ([:len [/file find name=&amp;quot;$verPrev&amp;quot;]] &amp;gt;0) do={/file remove [/file find name=&amp;quot;$verPrev&amp;quot;]} else={/log info message=&amp;ldquo;No item for delete&amp;rdquo;}&lt;!-- raw HTML omitted -->/delay 3&lt;!-- raw HTML omitted -->#Отправляем уведомление о выполнении&lt;!-- raw HTML omitted -->:local name [/system identity get name]&lt;!-- raw HTML omitted -->/tool fetch keep-result=no url=&amp;ldquo;&lt;a href="https://api.telegram.org/bot-nomer-bota:tut-vasha-ssylka/sendMessage">https://api.telegram.org/bot-nomer-bota:tut-vasha-ssylka/sendMessage&lt;/a>?chat_id=-12345678&amp;amp;text=$ver is complete on $name&amp;rdquo;&lt;!-- raw HTML omitted -->/delay 3&lt;!-- raw HTML omitted -->if ([:len [/file find name~&amp;ldquo;sendMessage&amp;rdquo;]] &amp;gt;0) do={/file remove [/file find name~&amp;ldquo;sendMessage&amp;rdquo;]} else={/log info message=&amp;ldquo;No item for delete&amp;rdquo;}&lt;!-- raw HTML omitted -->/delay 3&lt;!-- raw HTML omitted -->/file remove $ver&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Сначала описывается версия конфига и каким будет следующая версия. Затем после комментария &amp;ldquo;&lt;!-- raw HTML omitted -->#####Тут код конфигурации&lt;!-- raw HTML omitted -->&amp;rdquo; перечисляются команды, которые должен выполнить роутер. Иногда роутер должен выполнить сложный скрипт. На этот случай есть закомментированный блок кода со скриптом. Сам сложный скрипт нужно описать в поле source=&amp;ldquo;tut_sam_script&amp;rdquo;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->После выполнения команд меняется задание в планировщике - указываем следующую версию скрипта, который надо применить. С этого момента роутер будет пытаться скачать его с сервера. Дальше шлём уведомление и удаляем файлы, которые могли создастся в ходе выполнения задания. Как слать оповещения в Telegram описано на &lt;!-- raw HTML omitted -->бескрайних &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->просторах &lt;!-- raw HTML omitted -->интернета и повторяться я не буду.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Очень важно предусмотреть в скрипте всё возможное и невозможное и каждая команда должна начинаться с проверки &lt;!-- raw HTML omitted -->if (&amp;hellip;) do={ &lt;!-- raw HTML omitted -->, а заканчиваться &lt;!-- raw HTML omitted -->} else={/log info message=&amp;ldquo;User not exist&amp;rdquo;}&lt;!-- raw HTML omitted --> . У одного из моих роутеров был баг, из-за которого не отображался wireless интерфейс. И без проверки его существования, скрипт просто вываливался с ошибкой. А значит, не менялась запись в планировщике и следующий скрипт тоже не выполнялся.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Перед применением конфигурации на всю сеть нужно проверить правильность написания скрипта - даже опытный скриптописатель может чего-то не учесть и хорошо, если это какая-то мелочь и она не положит всю сеть. Поэтому перед созданием нового файла конфигурации, я проверяю  команды на работающем в продакшене роутере. А затем использую отдельную группу из 20 разнотипных роутеров (в основном это разный тип подключения к сети, остальные настройки везде идентичны) для тестирования скрипта. Эти роутеры опрашивают сервер чаще, чем остальные и после применения настроек я какое-то время наблюдаю за их поведением, а затем распространяю нововведения на остальную сеть.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Чего не хватает в моём подходе:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Безопасность&lt;!-- raw HTML omitted -->. Хоть доступ на сервер со скриптами ограничен паролем, но этот пароль в открытом виде хранится на роутерах. Вся конфигурация передается по сети в открытом виде. У меня всё это летает внутри шифрованного VPN и я &lt;!-- raw HTML omitted -->запрещаю вам использовать это на нешифрованных публичных каналах&lt;!-- raw HTML omitted -->! Внутреннего нарушителя тоже никто не отменял и внутри VPN это не очень безопасно. &lt;!-- raw HTML omitted -->Можно&lt;!-- raw HTML omitted --> Нужно! использовать https вместо http.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Информативные оповещения&lt;!-- raw HTML omitted -->. При возникновении ошибки, неплохо было бы сообщать о ней&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Возможны только изменения&lt;!-- raw HTML omitted -->. Хочется ещё и читать конфиги и выделять места, отличные от стандарта. Но это задача уже другого класса систем&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Через полгода после внедрения этой системы, на &lt;!-- raw HTML omitted -->встрече пользователей Mikrotik&lt;!-- raw HTML omitted --> Михаил Москалев   рассказал об аналогичном подходе. Михаил продвинулся дальше и применил модульный подход к конфигурации. Его презентацию можно посмотреть по &lt;!-- raw HTML omitted -->ссылке&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->Такой же подход использует система блокировки рекламы для Mikrotik &lt;!-- raw HTML omitted -->&lt;a href="https://stopad.cgood.ru/">https://stopad.cgood.ru/&lt;/a> &lt;!-- raw HTML omitted -->.  &lt;!-- raw HTML omitted -->Постоянный докладчик нашей &lt;!-- raw HTML omitted -->#Sysadminka&lt;!-- raw HTML omitted --> написал свою систему управления конфигурациями. Она доступна на &lt;!-- raw HTML omitted -->github&lt;!-- raw HTML omitted -->. Посмотреть можно на &lt;!-- raw HTML omitted -->YouTube&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В следующем посте я опишу ещё один свой скриптик с использованием Excel, который помогает младшим админам настраивать первичную конфигурацию роутеров без вникания в WinBox и настройки RouterOS.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->P.S.: Видео в посте создано с помощью &lt;!-- raw HTML omitted -->grep &lt;!-- raw HTML omitted -->и &lt;!-- raw HTML omitted -->logstalgia&lt;!-- raw HTML omitted -->.&lt;/p></content></item><item><title>Система управления конфигурациями Oxidized</title><link>https://bubnovd.net/blogger/%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F%D0%BC%D0%B8-oxidized/</link><pubDate>Thu, 12 Oct 2017 09:16:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F%D0%BC%D0%B8-oxidized/</guid><description>Резервное копирование - важная составляющая стабильной работы инфраструктуры. Каждый подходит к вопросу резервного копирования со своими взглядами. Сетевое оборудование также нуждается в постоянном бэкапе конфигураций. Но в силу того, что сети редко бывают моновендорными и найти один метод управления для всей сети часто невозможно, резервное копирование сетевых устройств часто вводит в замешательство администраторов.
Для автоматизации резервного копирования конфигураций сетевого оборудования инженеры часто применяют системы контроля версий. Такой подход позволяет не только всегда иметь актуальную копию конфигурации, но и оперативно находить изменения в настройках, которые могли привести к неправильной работе сети.</description><content>&lt;p>Резервное копирование  - важная составляющая стабильной работы инфраструктуры. Каждый подходит к вопросу резервного копирования со своими взглядами. Сетевое оборудование также нуждается в постоянном бэкапе конфигураций. Но в силу того, что сети редко бывают моновендорными и найти один метод управления для всей сети часто невозможно,  резервное копирование сетевых устройств часто вводит в замешательство администраторов.&lt;/p>
&lt;p>Для автоматизации резервного копирования конфигураций сетевого оборудования инженеры часто применяют системы контроля версий. Такой подход позволяет не только всегда иметь актуальную копию конфигурации, но и оперативно находить изменения в настройках, которые могли привести к неправильной работе сети.&lt;/p>
&lt;p>Во время подготовки к выступлению на &lt;a href="https://mum.mikrotik.com/presentations/RU17M/presentation_4655_1508211463.pdf">MUM&lt;/a> &lt;a href="https://www.youtube.com/watch?v=9Ceti-EQpU4">2017&lt;/a> я изучил несколько систем, позволяющих автоматизировать резервное копирование в git.  &lt;/p>
&lt;h2 id="unimus">Unimus&lt;/h2>
&lt;p>Разработана Tomas Kirnak - моим коллегой - тренером Mikrotik из США. Система писалась исходя из потребностей Томаса для его сети из 1500 RouterOS и других устройств. На тему управления этим парком Томас &lt;a href="https://mum.mikrotik.com/presentations/US17/presentation_4529_1496842532.pdf">докладывал на МУМе.&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://unimus.net/">Unimus&lt;/a> инсталлируется на Windows, *nix, имеется  portable версия для Windows. Устанавливать я не пробовал, но portable версию запустил. Все заработало без особых телодвижений, открылся приятный веб интерфейс. Поддерживается работа с 58 вендорами, бэкапит в git&lt;/p>
&lt;p>&lt;img src="https://unimus.net/images/features/2.gif" alt="Картинки по запросу unimus backup">&lt;/p>
&lt;p>Система простая, удобная и, главное, работающая. За что автор и просит денег.&lt;/p>
&lt;p>&lt;img src="https://lh6.googleusercontent.com/vz8EnqRnYlbPMLv2nNfHAG_W75lAlXyZQu7pFM8Fuw2XfIjdjE7LxUy1f65zJ17L07qw9pDfimm6xtbte03tLGVcdB9uiiE7LpRhBELWl25eOht-_iFcWBXE6H7CGLs3VXOeaMCR668" alt="">&lt;/p>
&lt;h2 id="oxidized">Oxidized&lt;/h2>
&lt;p>Аналогичная предыдущей система. Менее приятный интерфейс, что не мешает выполнять oxidized свою основную функцию. Поддерживается 91 вендор, среди которых Cisco, Juniper, Mikrotik, D-Link, Cumulus Linux, pfSense.&lt;/p>
&lt;p>На русском языке информацию об oxidized я не нашел. Поэтому постараюсь восполнить этот пробел.&lt;/p>
&lt;p>&lt;a href="https://github.com/ytti/oxidized">Oxidized&lt;/a>  создавался как альтернатива RANCID двумя разработчиками: &lt;a href="mailto:saku@ytti.fi">Saku Ytti&lt;/a> и &lt;a href="mailto:sam@arahant.net">Samer Abdel-Hafez&lt;/a>. Кстати, парням нужен разработчик на Ruby для помощи в разработке. Явное преимущество над RANCID - удобный веб-интерфейс, взглянуть на него можно по ссылке: &lt;a href="https://oxidized.arahant.net/nodes">https://oxidized.arahant.net/nodes&lt;/a>.&lt;/p>
&lt;p>&lt;img src="https://lh5.googleusercontent.com/i4WqEIrZdR5CCY2GXkF7pTAeA3eV2bx_bypxi05WaoQDxlv23UBHzZxRjf9X_SAT4hBdken7fUMJM2Z4dMDczRCKTLakIytFqVR9oaVzNTkMAjTcDWzS1X5FgAQYkASNnHksm1R2" alt="">&lt;/p>
&lt;p>В основном окне можно увидеть список устройств и сравнить их бэкапы. Хорошая фича системы - поиск по конфигурациям в верхнем правом углу. Например, можно найти конфиги всех точек доступа с SSID=bubnovd.net. Веб интерфейс очень быстрый! Работая с более, чем 300 девайсами, я не заметил сколь-нибудь заметных задержек.&lt;/p>
&lt;p>Провалившись в меню девайса, открывается список различных версий конфига этого устройства.&lt;/p>
&lt;p>&lt;img src="https://lh3.googleusercontent.com/TXmPlQCSYOYAmxOnAm4wXPyOInaaq9pHvNkHojzOkXItsebPm0x3kGgJ2vTVu-zI6QWst5A1mIy5uimpGWFvPXWE23p1dHn0s9iNprGg_W_UnpYr1g3Y1lU8u13-M36ygCJYcTZi" alt="">&lt;/p>
&lt;p>Каждую версию можно сравнить с другой и увидеть что именно происходило с устройством между этими версиями.&lt;/p>
&lt;p>&lt;img src="https://lh4.googleusercontent.com/8szHMyR4qd4AeCde6ump-XxqECBNRJx6-RWpIEa36czdIqNhd86cHLHIFXar6PvgqnllZaADdI95IMZ-kpFpeHlZiCfcWnIgInbIs8koBh31MP3HzkV_LO6DjXpGgqWogxHoLSlZ" alt="">&lt;/p>
&lt;p>На вкладке stats отображается результат резервного копирования.&lt;/p>
&lt;p>&lt;img src="https://lh5.googleusercontent.com/j0RKpoOYBBqFjRDsom5WakOsJb15ajrwrqgHUvKCOOTaYcVIE_-Mz-P3a2-Nonlng_OpHipdBcLSWvED5dtTy7SxRf0WFVhqDgCmK35bZ51LRvsZ79F9KKCgz5bEpZ-W_RIQI5mH" alt="">&lt;/p>
&lt;p>Можно увидеть сколько попыток бэкапа были неудачными, сколько времени занимает процесс бэкапа, время последнего удачного и неудачного бэкапов.&lt;/p>
&lt;h3 id="установка">Установка&lt;/h3>
&lt;p>Я опишу установку на Debian. Установку ОС и её первичную настройку описывать не буду, благо всё уже &lt;a href="http://www.bubnovd.net/2011/03/debian.html">много&lt;/a>  &lt;a href="http://www.bubnovd.net/2011/08/linux-server-2-iptables.html">раз&lt;/a>   &lt;a href="http://www.bubnovd.net/2013/02/lvm.html">сделано&lt;/a>. Всё делал по &lt;a href="https://github.com/ytti/oxidized#debian">инструкции&lt;/a>.&lt;/p>
&lt;pre tabindex="0">&lt;code>apt install ruby ruby-dev libsqlite3-dev libssl-dev pkg-config cmake libssh2-1-dev
gem install oxidized oxidized-script oxidized-web
&lt;/code>&lt;/pre>&lt;p>Установка не вызывает вопросов, всё проходит стандартно. В описании системы не очень понятно что и как делать дальше. Я постараюсь объяснить.&lt;/p>
&lt;h3 id="конфигурация">Конфигурация&lt;/h3>
&lt;p>Запускать oxidized с правами суперпользователя - не самая лучшая идея. Поэтому создадим пользователя oxidized, с правами которого будет запускаться система бэкапа:&lt;/p>
&lt;p>&lt;code>useradd oxidized&lt;/code>&lt;/p>
&lt;p>Создадим для нового пользователя домашний каталог, в котором будут лежать конфигурационные файлы, список устройств и база git:&lt;/p>
&lt;p>&lt;code>mkdir /home/oxidized&lt;/code>&lt;/p>
&lt;p>И дадим права на этот каталог юзеру oxidized:&lt;/p>
&lt;p>&lt;code>chown oxidized:oxidized /home/oxidized&lt;/code>&lt;/p>
&lt;p>Первый запуск создаст все необходимые файлы и каталоги. Не забыли, что запускать надо под специальным пользователем?&lt;/p>
&lt;p>su - oxidized&lt;/p>
&lt;p>oxidized&lt;/p>
&lt;p>Создался каталог &lt;code>/home/oxidized/.config/oxidized&lt;/code>, в котором находится всё, что нужно для дальнейшей настройки. Основные настройки системы хранятся в файле config в формате YAML. Он состоит из нескольких частей:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Input&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Output&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Source&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Основные настройки&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Привожу свой конфиг:&lt;/p>
&lt;pre tabindex="0">&lt;code>bubnov@oxidized:~$ cat /home/oxidized/.config/oxidized/config
\---
//пользователь и пароль, от которых система будет коннектиться к девайсам
username: oxidized
password: p@ssw0rd
//вендор. Я указывал вендора для каждого устройства в файле router.db. Но можно выставить и здесь
model: junos
//Периодичность снятия бэкапа в секундах
interval: 3600
use\_syslog: false
debug: false
threads: 30
//таймаут сессии. Многие устройства не успевают выгрузить конфигурацию в дефолтные 20 секунд. Приходится увеличивать
timeout: 140
//количество попыток снять бэкап с каждого устройства, после чего считается, что бэкап сделать не удалось
retries: 3
prompt: !ruby/regexp /^(\[\\w.@-\]+\[#&amp;gt;\]\\s?)$/
//IP адрес и порт, на котором будет работать REST API (веб интерфейс по простому)
rest: 127.0.0.1:8888
next\_adds\_job: false
Vars:
//позволяет исключить из бэкапа критичную информацию, такую как snmp-community, ключи шифрования и т.п.
 remove\_secret: true
groups: {}
models: {}
pid: &amp;#34;/home/oxidized/.config/oxidized/pid&amp;#34;
log: &amp;#34;/home/oxidized/.config/oxidized/log&amp;#34;
//тип подключения к управляемым устройствам
input:
 default: ssh
 debug: false
 ssh:
    secure: false
//где хранится конфигурации (git, text, ...) и настройки хранилища
output:
 default: git
 git:
    user: oxidized
    email: admin@bubnovd.net
    repo: &amp;#34;/home/oxidized/.config/oxidized/devices.git&amp;#34;
//откуда берется информация о бэкапящихся девайсах
source:
 default: csv
 csv:
    file: &amp;#34;/home/oxidized/.config/oxidized/router.db&amp;#34;
    delimiter: !ruby/regexp /:/
    map:
     name: 0
     model: 1
     ip: 2
model\_map:
 cisco: ios
 juniper: junos
&lt;/code>&lt;/pre>&lt;p>Из важного здесь:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Логин и пароль пользователя на устройствах, под именем которого будет делаться бэкап. Я рекомендую создать на всех девайсах специального пользователя с ограниченными правами, позволяющими бэкапить. К примеру, на RouterOS это группа read&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Разделы input, output, source. В них указывается как подключаться к устройствам, где взять их список и куда выгружать бэкап&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Адрес и порт REST API. Чуть позже я объясню, почему он должен быть 127.0.0.1:8888&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>В разделе source указано, что информацию о девайсах нужно брать из CSV файла, путь к нему и порядок полей в нем. В моем случае формат такой: &lt;code>имя\_устройства:модель:ip&lt;/code>&lt;/p>
&lt;p>Сам файл router.db:&lt;/p>
&lt;pre tabindex="0">&lt;code>RB128:routeros:192.168.3.128
RB121:routeros:192.168.3.1:oxidized:drugoi\_password
sw11:dlink:192.168.3.11:::2222
&lt;/code>&lt;/pre>&lt;p>В первой строке указан роутер Mikrotik, о чем говорит поле routeros, с адресом 192.168.3.128 и называться в oxidized он будет RB128. Логин и пароль для подключения будет браться из файла config. Второе устройство RB121 имеет другую учетную запись, параметры которой указаны после IP адреса - логин:пароль. А третий девайс производства D-Link, с логином/паролем из файла config, но SSH на порту 2222.&lt;/p>
&lt;p>Стоит сказать, что устройства можно группировать по вендору или учетным записям. Об этом можно почитать в &lt;a href="https://github.com/ytti/oxidized/blob/master/docs/Configuration.md">официальной документации&lt;/a>.&lt;/p>
&lt;p>&lt;strong>Авторизация&lt;/strong>&lt;/p>
&lt;p>На этом этапе уже можно запускать систему и набрав в браузере &lt;a href="http://localhost:8888/">http://localhost:8888&lt;/a> увидеть её интерфейс. Но у oxidized есть большой недостаток: нет аутентификации в системе. То есть любой может открыть в браузере веб-интерфейс и увидеть все конфиги ваших сетевых устройств. Разработчик занимается только системой бэкапа и смежные фичи внедрять пока не планирует.&lt;/p>
&lt;p>Обойдем этот недостаток с помощью Reverse-proxy.&lt;/p>
&lt;p>Ставим nginx:&lt;/p>
&lt;p>&lt;code>apt install nginx&lt;/code>&lt;/p>
&lt;p>И настраиваем его на работу как реверс прокси:&lt;/p>
&lt;pre tabindex="0">&lt;code>nano etc/nginx/sites-available/default
auth\_basic “Username and Password Required”;
auth\_basic\_user\_file /etc/nginx/.htpasswd;
location / {
  proxy\_set\_header Host $host;
  proxy\_set\_header X-Real-IP $remote\_addr;
  proxy\_set\_header X-Forwarded-For $proxy\_add\_x\_forwarded\_for;
  proxy\_pass http://127.0.0.1:8888;
}
&lt;/code>&lt;/pre>&lt;p>И создаем юзера и пароль:&lt;/p>
&lt;p>&lt;code>sudo htpasswd /etc/nginx/.htpasswd username&lt;/code>&lt;/p>
&lt;p>Теперь nginx будет работать на стандартном порту (или на том, который вы укажете в его настройках), при обращении к нему будет происходить авторизация и пользователь будет перенаправлен на адрес proxy_pass (127.0.0.1:8888 в нашем случае).&lt;/p>
&lt;p>Хочу обратить ваше внимание на опцию remove_secrets в конфиге. Она удаляет критичную информацию из бэкапа, такую как SNMP-community, ключи шифрования, ключи Wi-Fi. Например, Mikrotik RouterOS в дефолте умеет скрывать эти данные, если экспорт выполнять с опцией hide-sensitive. Oxidized же может исключать эти данные из конфигов любого вендора.&lt;/p>
&lt;p>Узнать что именно удаляется из конфига, можно посмотрев в описание вашего вендора в &lt;a href="https://github.com/ytti/oxidized/blob/master/lib/oxidized/model/">списке&lt;/a>. Например, для Cicso:&lt;/p>
&lt;p>&lt;img src="https://lh5.googleusercontent.com/-WEhbGXGjlGVfV9lp2Sn-BLIPNBUEe2n6npRplCIgHLW8uBAlV2mT7bpABaLhqYshhXin6veWhKWQbzt5cXbCPUwzXHb03JTYGTkguJPyYM4SRZeZBw0QdErHg5C2UZGLWmp9q3W" alt="">&lt;/p>
&lt;p>Для того, чтобы oxidized стартовал как служба, сделайте следующее:&lt;/p>
&lt;pre tabindex="0">&lt;code>sudo cp /usr/local/share/gems/gems/oxidized-0.19.0/extra/oxidized.service /lib/systemd/system/
sudo systemctl enable oxidized.service
sudo systemctl start oxidized
&lt;/code>&lt;/pre>&lt;p>Я же просто прописал в crontab запуск после ребута:&lt;/p>
&lt;pre tabindex="0">&lt;code>sudo -u oxidized crontab -l
@reboot /usr/local/bin/oxidized
&lt;/code>&lt;/pre>&lt;p>Для подготовки к посту использовались следующие материалы:&lt;/p>
&lt;p>&lt;a href="https://github.com/ytti/oxidized#installation">https://github.com/ytti/oxidized#installation&lt;/a>&lt;br>
&lt;a href="https://unimus.net/">https://unimus.net/&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://neckercube.com/index.php/2017/05/04/how-to-install-oxidized-for-network-configuration-backup/">https://neckercube.com/index.php/2017/05/04/how-to-install-oxidized-for-network-configuration-backup/&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://packetpushers.net/install-oxidized-network-configuration-backup/">http://packetpushers.net/install-oxidized-network-configuration-backup/&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://www.whoopis.com/core/oxidized-quickstart-tutoria.html">http://www.whoopis.com/core/oxidized-quickstart-tutoria.html&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://log.cyconet.org/2016/01/29/oxidized-silly-attempt-at-really-awesome-new-cisco-config-differ/">https://log.cyconet.org/2016/01/29/oxidized-silly-attempt-at-really-awesome-new-cisco-config-differ/&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://shairosenfeld.blogspot.ru/2011/03/authorization-header-in-nginx-for.html">http://shairosenfeld.blogspot.ru/2011/03/authorization-header-in-nginx-for.html&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://community.openhab.org/t/using-nginx-reverse-proxy-authentication-and-https/14542">https://community.openhab.org/t/using-nginx-reverse-proxy-authentication-and-https/14542&lt;/a>&lt;/p>
&lt;p>Надеюсь, эта статья поможет вам в настройке резервного копирования. Любые вопросы вы можете задать в комментариях к статье. Я постараюсь на них ответить.&lt;/p></content></item><item><title>Mikrotik User Meeting в Москве</title><link>https://bubnovd.net/blogger/mikrotik-user-meeting-%D0%B2-%D0%BC%D0%BE%D1%81%D0%BA%D0%B2%D0%B5/</link><pubDate>Tue, 10 Oct 2017 21:10:00 +0000</pubDate><guid>https://bubnovd.net/blogger/mikrotik-user-meeting-%D0%B2-%D0%BC%D0%BE%D1%81%D0%BA%D0%B2%D0%B5/</guid><description>Совсем скоро - 13-14 октября Mikrotik проводит User Meeting в Москве!Соберется около тысячи инженеров разных мастей, буду интересные технические доклады, воркшопы, выставка и, конечно же, афтепати с неформальным общением и пивом!Приходите, будет очень интересно! Именно здесь вы сможете найти решение давних проблем и поделиться своим опытом с другими.Доклады:Mikrotik в 3G/4G сетяхРабота с несколькими провайдерамиWi-Fi в разных условияхКак Mikrotik помогает аутсорсуБезопасностьА я расскажу про разные подходы к резервному копированию и его автоматизации.</description><content>&lt;p>&lt;!-- raw HTML omitted -->Совсем скоро - 13-14 октября Mikrotik проводит User Meeting в Москве!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Соберется около тысячи инженеров разных мастей, буду интересные технические доклады, воркшопы, выставка и, конечно же, афтепати с неформальным общением и пивом!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Приходите, будет очень интересно! Именно здесь вы сможете найти решение давних проблем и поделиться своим опытом с другими.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Доклады:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Mikrotik в 3G/4G сетях&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Работа с несколькими провайдерами&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Wi-Fi в разных условиях&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как Mikrotik помогает аутсорсу&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Безопасность&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->А я расскажу про разные подходы к резервному копированию и его автоматизации. Мой доклад будет в пятницу с 16-15 МСК. Буду рад вашим комментариям и дополнениям.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Регистрация тут: &lt;!-- raw HTML omitted -->&lt;a href="http://mum.mikrotik.com">http://mum.mikrotik.com&lt;/a>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Будет онлайн трансляция на &lt;!-- raw HTML omitted -->YouTube &lt;!-- raw HTML omitted -->. Возможно, она начнется не сразу, но обязательно будет. Подключайтесь!&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>DHCP Failover with RouterOS</title><link>https://bubnovd.net/blogger/dhcp-failover-with-routeros/</link><pubDate>Tue, 18 Jul 2017 04:02:00 +0000</pubDate><guid>https://bubnovd.net/blogger/dhcp-failover-with-routeros/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>The Dude – Network  management and monitoring  software</title><link>https://bubnovd.net/blogger/thedudenetwork-managementandmonitoring-software/</link><pubDate>Mon, 15 May 2017 23:03:00 +0000</pubDate><guid>https://bubnovd.net/blogger/thedudenetwork-managementandmonitoring-software/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>Резервирование каналов передачи данных с использованием различных типов L2 VPN</title><link>https://bubnovd.net/blogger/%D1%80%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB%D0%BE%D0%B2-%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B0%D1%87%D0%B8-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D1%81-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-%D1%80%D0%B0%D0%B7%D0%BB%D0%B8%D1%87%D0%BD%D1%8B%D1%85-%D1%82%D0%B8%D0%BF%D0%BE%D0%B2-l2-vpn/</link><pubDate>Sun, 19 Mar 2017 22:35:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%80%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB%D0%BE%D0%B2-%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B0%D1%87%D0%B8-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D1%81-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-%D1%80%D0%B0%D0%B7%D0%BB%D0%B8%D1%87%D0%BD%D1%8B%D1%85-%D1%82%D0%B8%D0%BF%D0%BE%D0%B2-l2-vpn/</guid><description>Презентация Ильи Князева с MUMа в Новосибирске. Много полезной информации о туннелях. Резервирование каналов передачи данных с использованием различных типов L2 VPN from Dmitry Bubnov</description><content>&lt;p>Презентация Ильи Князева с MUMа в Новосибирске. Много полезной информации о туннелях. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->Резервирование каналов передачи данных с использованием различных типов L2 VPN&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted --> from &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Dmitry Bubnov&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>DFS - Dynamic Frequency Selection</title><link>https://bubnovd.net/blogger/dfs---dynamic-frequency-selection/</link><pubDate>Wed, 01 Feb 2017 04:35:00 +0000</pubDate><guid>https://bubnovd.net/blogger/dfs---dynamic-frequency-selection/</guid><description>Всеобъемлющая презентация о DFS Radar Detection and DFS on MikroTik from Dmitry Bubnov</description><content>&lt;p>Всеобъемлющая презентация о DFS&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->Radar Detection and DFS on MikroTik &lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted --> from &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Dmitry Bubnov&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>PHP IPAM. Импорт из Excel</title><link>https://bubnovd.net/blogger/php-ipam.-%D0%B8%D0%BC%D0%BF%D0%BE%D1%80%D1%82-%D0%B8%D0%B7-excel/</link><pubDate>Wed, 16 Nov 2016 03:47:00 +0000</pubDate><guid>https://bubnovd.net/blogger/php-ipam.-%D0%B8%D0%BC%D0%BF%D0%BE%D1%80%D1%82-%D0%B8%D0%B7-excel/</guid><description>IP Address Management (сокращенно IPAM) – средство планирования, отслеживания и управления IP адресами в сети (via). В больших сетях отследить все используемые адреса и приготовиться к их изменению или внедрению новых – большая, трудновыполнимая задача. База данных IP адресов у многих ведется в различных табличка (Google Docs, Excel), у остальных не ведется совсем.При изменениях в сети оперировать информацией из этих мест становится все сложнее и документы быстро теряют свою актуальность.Именно поэтому было решено развернуть сервер управления IP адресами в нашей сети.</description><content>&lt;p>IP Address Management (сокращенно IPAM) – средство планирования, отслеживания и управления IP адресами в сети (&lt;!-- raw HTML omitted -->via&lt;!-- raw HTML omitted -->).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> В больших сетях отследить все используемые адреса и приготовиться к их изменению или внедрению новых – большая, трудновыполнимая задача. База данных IP адресов у многих ведется в различных табличка (Google Docs, Excel), у остальных не ведется совсем.&lt;!-- raw HTML omitted -->При изменениях в сети оперировать информацией из этих мест становится все сложнее и документы быстро теряют свою актуальность.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Именно поэтому было решено развернуть сервер управления IP адресами в нашей сети. После мук выбора я остановился на PHP IPAM - он показался мне наиболее дружелюбным и функциональным, к тому же имеет API для взаимодействия с внешними системами.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Посмотреть на демо это системы можно &lt;!-- raw HTML omitted -->тут&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как происходит установка этой замечательной системы я рассказывать не буду - всё и так хорошо описано в Интернете. Если будут вопросы - спрашивайте в комментариях&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->А так как сеть у меня уже большая и информация о ней мало где отражена, то актуальнейшая информация находится в таблицах маршрутизации роутеров. Эту информацию нужно внести в базу данных сервера IPAM. А как это сделать, я сейчас расскажу.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->С помощью системы мониторинга The Dude выгружаем таблицу маршрутизации в csv&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Экспорт из Dude в csv&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Открываем Excel и загружаем данные. Данные - из текста&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Импорт csv в Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Выбираем наш файл. В открывшемся окне указываем формат - с разделителям и жмем далее&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->С разделителями&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->The Dude экспортирует в файл с раделителями - запятыми, поэтому выбираем &amp;ldquo;запятые&amp;rdquo; и жмем далее&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Разделители - запятые&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->На следующем шаге жмем кнопку &amp;ldquo;Готово&amp;rdquo;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Готово!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Выбираем ячейку, начиная с которой нужно вставить данные - обычно это А1. И наслаждаемся результатом. Теперь можно подкорректировать табличку.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Теперь нам нужно сформировать csv, который принял бы наш IPAM сервер. А у него следующий формат файла для импорта:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Формат csv для импорта в IPAM&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->section name*(varchar(128)),    subnet*(varchar(255)),   mask(varchar(3)),  description(text),   vlan name(varchar(255)),   domain name(varchar(64)),   vrf name(varchar(32)). Обязательны только первые два параметра - имя секции и подсеть.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Оставим только нужную нам информацию&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Убрали ненужное&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как видим, остались только данные о подсети и связанного с ней филиала. Но имя интерфейса нам ни к чему, поэтому из строки вида &amp;lt;sstp-pub-740102&amp;gt; надо сделать RB740102. В этом нам поможет Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Найти и заменить&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Теперь нам нужно избавиться от закрывающего спецсимвола &amp;ldquo;&amp;gt;&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Финиш близко&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Приведем нашу табличку к такому виду&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Готовый Excel&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->И сохраним как csv. Excel ругнется на то, что мы потеряем данные, но мы готовы на такой риск =)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В итоге должны получить файл следующего вида&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->CSV&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Его уже можно импортировать в PHP IPAM. Заходим в Administration - Import/Export&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Import&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В PHP IPAM на данный момент в версии 1.2 rev1 доступен импорт только subnets. Поэтому выбираем subnets и жмем Import&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Import subnets&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Жмем Browse&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Browse&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Выбираем наш csv и жмем открыть.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->На этом этапе мы должны получить ошибку: &lt;!-- raw HTML omitted -->Error: Upload directory is not writable, or does not exist.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Error: Upload directory is not writable, or does not exist.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Это значит, что у веб-сервера нет прав на запись в папку upload. Добавим эти права. Выполним в консоли  sudo chmod -R g+w o+w /var/www/html/phpipam/app/admin/import-export/upload/ &lt;!-- raw HTML omitted -->Тут должен быть путь до вашего сервера IPAM!&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Import&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Повторяем пункты импорта. Система выдаст предупреждение о том, что не все пункты сопоставлены. Точно - в первом столбце пусто. Выбираем там section name и жмем Preview. Если все хорошо, то система покажет список импортируемых подсетей и их имена&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Uploaded data&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Жмем Import и проверяем указанную в поле section csv-файла секцию. Наши записи успешно импортированы!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Готово!&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Controlling network traffic using MikroTik RouterOS</title><link>https://bubnovd.net/blogger/controlling-network-traffic-using-mikrotik-routeros/</link><pubDate>Thu, 10 Nov 2016 03:42:00 +0000</pubDate><guid>https://bubnovd.net/blogger/controlling-network-traffic-using-mikrotik-routeros/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>Почитать о Mikrotik</title><link>https://bubnovd.net/blogger/%D0%BF%D0%BE%D1%87%D0%B8%D1%82%D0%B0%D1%82%D1%8C-%D0%BE-mikrotik/</link><pubDate>Thu, 10 Nov 2016 01:07:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BF%D0%BE%D1%87%D0%B8%D1%82%D0%B0%D1%82%D1%8C-%D0%BE-mikrotik/</guid><description>Блоги хороших админов, пишущих о Mikrotik RouterOSRick FreySteve DischerButch EvansManitoThe Brothers WISPJoshaven Potter</description><content>&lt;p>Блоги хороших админов, пишущих о Mikrotik RouterOS&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Rick Frey&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Steve Discher&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Butch Evans&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Manito&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->The Brothers WISP&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Joshaven Potter&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>ZTE MF710M и Mikrotik</title><link>https://bubnovd.net/blogger/zte-mf710m-%D0%B8-mikrotik/</link><pubDate>Tue, 18 Oct 2016 03:33:00 +0000</pubDate><guid>https://bubnovd.net/blogger/zte-mf710m-%D0%B8-mikrotik/</guid><description>Достоверно заявляю что девайс ZTE MF710M от Tele2 успешно работает с Mikrotik RB951Ui-2HnD. Определяется как LTE интерфейс</description><content>&lt;p>Достоверно заявляю что девайс ZTE MF710M от Tele2 успешно работает с Mikrotik  &lt;!-- raw HTML omitted -->RB951Ui-2HnD. Определяется как LTE интерфейс&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Mikrotik Training</title><link>https://bubnovd.net/blogger/mikrotik-training/</link><pubDate>Tue, 11 Oct 2016 21:10:00 +0000</pubDate><guid>https://bubnovd.net/blogger/mikrotik-training/</guid><description>Теперь я сертифицированный тренер Mikrotik.А это значит, что в скором времени на Урале, а в частности, в Челябинске будут проводиться курсы Mikrotik с выдачей официальных сертификатов. Сейчас нужно уладить некоторые организационные моменты. Планирую в конце ноября провести курс MTCNA.По всем вопросам пишите на почту dv[at]bubnovd.net или в комментариях к этому посту.</description><content>&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Теперь я сертифицированный тренер Mikrotik.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->А это значит, что в скором времени на Урале, а в частности, в Челябинске будут проводиться курсы Mikrotik с выдачей официальных сертификатов. Сейчас нужно уладить некоторые организационные моменты. Планирую в конце ноября провести курс  MTCNA.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->По всем вопросам пишите на почту  dv[at]bubnovd.net или в комментариях к этому посту.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>IPSec over L2TP между RouterOS и Apple iOS 10</title><link>https://bubnovd.net/blogger/ipsec-over-l2tp-%D0%BC%D0%B5%D0%B6%D0%B4%D1%83-routeros-%D0%B8-apple-ios-10/</link><pubDate>Mon, 10 Oct 2016 03:23:00 +0000</pubDate><guid>https://bubnovd.net/blogger/ipsec-over-l2tp-%D0%BC%D0%B5%D0%B6%D0%B4%D1%83-routeros-%D0%B8-apple-ios-10/</guid><description>В 10 версии iOS команда Apple наконец-то выпилила PPTP, чем сподвигла весь (не)цивилизованный ИТ-мир срочно учиться поднимать IPSec на своих бордерах. В том числе и меня.
&amp;ldquo;Поднять IPSec - что там сложного&amp;rdquo; - подумал я. Но не тут то было. По мануалам, хабрам и прочим ресурсам все отлично поднимается и работает между двумя микротиками, между микротиком и виндой, между микротиком и андроид. Но вот с iOS 10 ни в какую не хочет.</description><content>&lt;p>В 10 версии iOS команда Apple наконец-то выпилила PPTP, чем сподвигла весь (не)цивилизованный ИТ-мир срочно учиться поднимать IPSec на своих бордерах. В том числе и меня.&lt;/p>
&lt;p>&amp;ldquo;Поднять IPSec - что там сложного&amp;rdquo; - подумал я. Но не тут то было. По мануалам, хабрам и прочим ресурсам все отлично поднимается и работает между двумя микротиками, между микротиком и виндой, между микротиком и андроид. Но вот с iOS 10 ни в какую не хочет. Путем долгих ковыряний и трехэтажных словосочетаний, выяснил, что изменения для IPSec нужно применять в КОНСОЛИ! Не в графическом интерфейсе, а именно в консоли - ssh или встроенная в WinBox - без разницы. Но факт в том, что идентичные настройки в WinBox не позволяли поднять VPN между Mikrotik RouterOS и IPhone (по крайней мере в моем случае с RB751 на RouterOS 6.37.1 в связке с IPhone 6).&lt;/p>
&lt;p>Привожу настройки L2TP и IPSec текстом и скрины из WinBox что должно получиться:&lt;/p>
&lt;p>L2TP сервер&lt;/p>
&lt;pre tabindex="0">&lt;code>/interface l2tp-server server
set authentication=mschap2 default-profile=default enabled=yes
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://2.bp.blogspot.com/-_4MPqiOY7dM/V_tkhkfGTGI/AAAAAAAAAxc/iUs3UlAZQCMHEWNAoQqQbCrCU7hH586CQCLcB/s1600/1_l2tp.PNG">&lt;img src="https://2.bp.blogspot.com/-_4MPqiOY7dM/V_tkhkfGTGI/AAAAAAAAAxc/iUs3UlAZQCMHEWNAoQqQbCrCU7hH586CQCLcB/s320/1_l2tp.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>L2TP server&lt;/p>
&lt;p>PPP профили дефолтные&lt;/p>
&lt;pre tabindex="0">&lt;code>\&amp;gt; ppp profile print 
Flags: \* - default 
 0 \* name=&amp;#34;default&amp;#34; use-mpls=default use-compression=default 
     use-encryption=default only-one=default change-tcp-mss=yes 
     use-upnp=default address-list=&amp;#34;&amp;#34; on-up=&amp;#34;&amp;#34; on-down=&amp;#34;&amp;#34; 
 1 \* name=&amp;#34;default-encryption&amp;#34; use-mpls=default use-compression=default 
     use-encryption=yes only-one=default change-tcp-mss=yes use-upnp=default 
     address-list=&amp;#34;&amp;#34; on-up=&amp;#34;&amp;#34; on-down=&amp;#34;&amp;#34;
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://2.bp.blogspot.com/-4j6jmkS_1zM/V_tlNc9yazI/AAAAAAAAAxk/nnkmtuOYXDQtuOicW1Gb4wKXzSNpe_ohwCLcB/s1600/2_ppp-profile.PNG">&lt;img src="https://2.bp.blogspot.com/-4j6jmkS_1zM/V_tlNc9yazI/AAAAAAAAAxk/nnkmtuOYXDQtuOicW1Gb4wKXzSNpe_ohwCLcB/s320/2_ppp-profile.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>ppp profile&lt;/p>
&lt;p>Пользователь L2TP тоже ничем не отличается от простого L2TP/PPTP и иже с ними без айписека&lt;/p>
&lt;pre tabindex="0">&lt;code>/ppp secret
add local-address=192.168.222.16 name=user1 password=l2tppassword profile=default-encryption remote-address=192.168.222.18 service=l2tp
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://2.bp.blogspot.com/-ruLmJPDInsM/V_tl5BDgwQI/AAAAAAAAAxo/jYPxZzvOKTEO7ZPh7XGp7jQpwTOLlvrfwCLcB/s1600/3_user.PNG">&lt;img src="https://2.bp.blogspot.com/-ruLmJPDInsM/V_tl5BDgwQI/AAAAAAAAAxo/jYPxZzvOKTEO7ZPh7XGp7jQpwTOLlvrfwCLcB/s320/3_user.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>L2TP secret&lt;/p>
&lt;p>Приступаем к IPSec. Все, что я делал с IPSec - делал через консоль. Из винбокса не заработало. что именно сделалось не так - не проверял. Можете проверить методом исключения.&lt;/p>
&lt;p>Добавляем группу (дефолтная работает криво - особенность RouterOS):&lt;/p>
&lt;pre tabindex="0">&lt;code>/ip ipsec policy group
add name=l2tp
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://3.bp.blogspot.com/-J0qbeMyCGsE/V_tm3ZmyyGI/AAAAAAAAAx4/qkVDbLAHMnYiRGtyTh4gHMbAbRXwmClHgCLcB/s1600/4_group.PNG">&lt;img src="https://3.bp.blogspot.com/-J0qbeMyCGsE/V_tm3ZmyyGI/AAAAAAAAAx4/qkVDbLAHMnYiRGtyTh4gHMbAbRXwmClHgCLcB/s320/4_group.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>IPSec group&lt;/p>
&lt;p>Корректируем proposal и добавляем новый:&lt;/p>
&lt;pre tabindex="0">&lt;code>/ip ipsec proposal
set \[ find default=yes \] enc-algorithms=aes-256-cbc,aes-128-cbc
add enc-algorithms=aes-256-cbc,aes-128-cbc name=L2TP pfs-group=none
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://4.bp.blogspot.com/-V5leQjYiI90/V_tnS-HkCRI/AAAAAAAAAx8/Es4LO8wuR8cMHJoDJJz3JKpaR7JprFvzwCLcB/s1600/5_proposal.PNG">&lt;img src="https://4.bp.blogspot.com/-V5leQjYiI90/V_tnS-HkCRI/AAAAAAAAAx8/Es4LO8wuR8cMHJoDJJz3JKpaR7JprFvzwCLcB/s320/5_proposal.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>IPSec proposal&lt;/p>
&lt;p>Добавляем пира:&lt;/p>
&lt;pre tabindex="0">&lt;code>/ip ipsec peer
add enc-algorithm=aes-256,aes-192,aes-128,3des exchange-mode=main-l2tp generate-policy=port-strict passive=yes policy-template-group=l2tp secret=RouterOS
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://4.bp.blogspot.com/-g2hwHl6Dboc/V_toMc017GI/AAAAAAAAAyI/Ml-pWpj0oXQ5J-BZ99i7PI0TsvjKX1FWgCLcB/s1600/6_peer.PNG">&lt;img src="https://4.bp.blogspot.com/-g2hwHl6Dboc/V_toMc017GI/AAAAAAAAAyI/Ml-pWpj0oXQ5J-BZ99i7PI0TsvjKX1FWgCLcB/s320/6_peer.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>IPSec peer&lt;/p>
&lt;p>Добавляем шаблон политики:&lt;/p>
&lt;pre tabindex="0">&lt;code>/ip ipsec policy
add dst-address=0.0.0.0/0 group=l2tp proposal=L2TP src-address=0.0.0.0/0 template=yes
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://1.bp.blogspot.com/-BREipqX5fhY/V_toquFtKXI/AAAAAAAAAyQ/I5njzVpQlLcE8jdqW6IrYTJVAWT8zN6VwCLcB/s1600/7_policy.PNG">&lt;img src="https://1.bp.blogspot.com/-BREipqX5fhY/V_toquFtKXI/AAAAAAAAAyQ/I5njzVpQlLcE8jdqW6IrYTJVAWT8zN6VwCLcB/s320/7_policy.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>IPSec policy&lt;/p>
&lt;p>&lt;a href="https://2.bp.blogspot.com/-KrcYxMQcPgM/V_toqs6DMsI/AAAAAAAAAyM/-48BTpkfmbE4XnCjflmwOwE-7lAGOcVgQCLcB/s1600/8_policy.PNG">&lt;img src="https://2.bp.blogspot.com/-KrcYxMQcPgM/V_toqs6DMsI/AAAAAAAAAyM/-48BTpkfmbE4XnCjflmwOwE-7lAGOcVgQCLcB/s320/8_policy.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>IPSec policy action&lt;/p>
&lt;p>Ну и настройка IPhone:&lt;/p>
&lt;p>&lt;a href="https://2.bp.blogspot.com/-XZYGv6-IFL4/V_trrzjAp5I/AAAAAAAAAyg/0tyDmiUx3NEBF9J8E3ns3yLX6Se5hrlFwCLcB/s1600/0_iphone.PNG">&lt;img src="https://2.bp.blogspot.com/-XZYGv6-IFL4/V_trrzjAp5I/AAAAAAAAAyg/0tyDmiUx3NEBF9J8E3ns3yLX6Se5hrlFwCLcB/s320/0_iphone.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>IPhone&lt;/p>
&lt;p>Спасибо &lt;a href="https://www.vasilevkirill.com/">Кириллу Васильеву&lt;/a> за наводку&lt;/p>
&lt;p>UPD: если имеются проблемы с подключением, попробуйте в /ip ipsec peer generate-policy установить port-override вместо port-strict &lt;/p>
&lt;p>UPD: как советуют в комментариях&lt;/p>
&lt;p>&lt;a href="https://vk.com/eugene_fesko">Евгений&lt;/a>&lt;a href="http://www.bubnovd.net/2016/10/ipsec-over-l2tp-routeros-apple-ios-10.html?showComment=1508055431990#c7669898995946448842">15.10.2017, 1:17&lt;/a>&lt;/p>
&lt;p>В общем как ни странно вопрос решён, действительно помогло. А значит тем, кто кроме меня столкнулся с такой же проблемой, но не хочет прошиваться на релиз-кандидаты прошивок и ждёт официальную - им поможет отключение UPNP в роутере (в принципе его есть смысл юзать в домашнем варианте использования роутера, но и по работе в некоторых случаях он бывает полезен, в таком случае решение - только прошиваться на 6.41rc38)&lt;/p></content></item><item><title>Маршрутизация. OSPF в Mikrotik RouterOS</title><link>https://bubnovd.net/blogger/%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F.-ospf-%D0%B2-mikrotik-routeros/</link><pubDate>Wed, 16 Mar 2016 04:29:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F.-ospf-%D0%B2-mikrotik-routeros/</guid><description>По Вики: OSPF(англ. Open Shortest Path First) — протокол динамической маршрутизации, основанный на технологии отслеживания состояния канала (link-state technology) и использующий для нахождения кратчайшего пути алгоритм Дейкстры.
Для чего нужен OSPF и как применять его на сетях, построенных на Mikrotik RouterOS, мы и рассмотрим в этой статье.
Все, кто работал с сетями, имеющими более одной подсети (провайдеры, компании с филиалами, несколько vlan и т.д.) знают о необходимости существования маршрутов из одной сети в другую.</description><content>&lt;p>По Вики: OSPF(&lt;a href="https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA">англ.&lt;/a> Open Shortest Path First) — протокол динамической &lt;a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F">маршрутизации&lt;/a>, основанный на технологии отслеживания состояния канала (link-state technology) и использующий для нахождения кратчайшего пути &lt;a href="https://ru.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%94%D0%B5%D0%B9%D0%BA%D1%81%D1%82%D1%80%D1%8B">алгоритм Дейкстры&lt;/a>.&lt;/p>
&lt;p>Для чего нужен OSPF и как применять его на сетях, построенных на Mikrotik RouterOS, мы и рассмотрим в этой статье.&lt;/p>
&lt;p>Все, кто работал с сетями, имеющими более одной подсети (провайдеры, компании с филиалами, несколько vlan и т.д.) знают о необходимости существования маршрутов из одной сети в другую. Иначе пакеты в соединении будут просто улетать на шлюз по умолчанию и дропаться где-то в интернете.&lt;/p>
&lt;p>Для тех же, кто с этим не знаком, поясню. Представьте, что мы внезапно захотели попасть из Челябинска в Киев, не имя при этом ни карты, ни навигатора. Поедем по указателям - не зря же их ставили.&lt;/p>
&lt;p>&lt;img src="https://lh4.googleusercontent.com/F5Eh9eEahfyDkdhnwrhivSGam5jyPG5uYI0_9HVUff1ZztiYhvmSXKreMtl0jASab8rcarbXt7rohlQ6XlOELIObuzE2sgf3XJcz1dVjkEsdNhqFxQQlN03OgPrsQQ-q08A9EIDz" alt="def3152d41f310537ded5b5e85f98024.jpg">&lt;/p>
&lt;p>Таким образом посмотрев на 10-20-100 укзателей мы рано или поздно доберемся до Киева - пакет от отправителя ушел к адресату. Сделали там все свои дела и захотели обратно домой в Челябинск - приложение обработало пакет и отправило ответ инициатору соединения. Но дорогу то мы не помним (в пакете нет никаких данных о прохождении пути. На самом деле есть намеки на это, но с помощью них нельзя восстановить путь пакета). Не беда - поедем по указателям.&lt;/p>
&lt;p>&lt;img src="https://lh6.googleusercontent.com/tQFmGwLFRAopzx8624XROXrN7bhII7Hv5peK1S6MJg-zYyzVX8uCImXKNEeiMbEZq8PzP64BXjW318hior-rk-7AMCCyvhyvHfExVjzF8CaiBfyRcMn9XLRP3QLwY5YB1TEtJ02y" alt="d-3.jpg">&lt;/p>
&lt;p>Так же как и в первый раз мы каким-то образом вернемся в точку, из которой выехали. Причем, очень важно то, что вернуться мы можем по другим дорогам - на каких то начали укладывать асфальт за время нашего пребывания в Киеве и поставили знаки объезда, где-то просто затор и мы решили объехать по менее нагруженным трассам. Но мы все равно доберемся до места, пусть и затратив большее время.&lt;/p>
&lt;p>Итак, мы, инкапсулированные в автомобиль - это данные, инкапсулированные в IP-пакет. Перекрестки на дороге - маршрутизаторы, подключенные к разным сетям (дорогам). А указатели на перекрестках - таблицы маршрутизации отдельных маршрутизаторов, знающие куда повернуть, чтобы попасть в ту или иную точку. И если в одну сторону мы доедем по указателям, а в другую указателей не будет, то пиши пропало - до исходной точки не доберемся. Значит, маршруты до общающихся сетей должны быть прописаны на обеих сторонах. И очень важно понимать, что дорог-маршрутов может быть несколько. И если один перекресток-маршрутизатор в ремонте, то предыдущий может послать нас в объезд, но сначала он должен узнать, что его сосед сломался. И если мы ездим по разным дорогам, значит и время пинга у нас будет разное.&lt;/p>
&lt;p>Итак, с маршрутами разобрались. Теперь поговорим о дорожниках, ставящих указатели.&lt;/p>
&lt;p>Статические указатели на дорогах - хорошо. Но расстояние между Челябинском и Киевом 2400 км. А значит и указателей должно быть не меньше 24 - по одному на каждые 100 км. И если на одном из перекрестков идет ремонт, необходимо внести изменения на два смежных указателя. А вероятность одновременного ремонта на 24 перекрестах весьма высока. То есть нужна отдельная бригада дорожников, меняющих указатели.&lt;/p>
&lt;p>Было бы неплохо соединить все указатели в  сеть и позволить им самим оценивать ситуацию на своих участках и передевать эти данные между собой. К сожалению великие и ужасные службы обслуживания дорог об этом ещё не додумались, да и вряд ли это надо - деньги то пилить не получится. А вот айтишники придумали технологии, позволяющие динамически изменять таблицы маршрутизации и обмениваться этой информацией. Эти технологии называются Протоколы Динамической Маршрутизации. И один из них - OSPF, предназначенный для обмена информацией внутри одной автономной системы - AS.&lt;/p>
&lt;p>Термины и работа OSPF хорошо описаны в &lt;a href="http://wiki.mikrotik.com/wiki/Russian/OSPF">вики&lt;/a> микротика. Но я осмелюсь кое-что повторить и перефразировать.&lt;/p>
&lt;p>Допустим, есть следующая сеть. &lt;img src="https://lh6.googleusercontent.com/Q0CaTrRk9W1S6bXYtFGMLX-1KENf7wtZh1BBytzRgZ7TAPOMOeoVL1l5JflulsS-wd4Tn0TSyWJTnMU5CbMn6vNTm7WcjaT3UNcQ5qR81q1WWux93yFebG2_NEzY_xzP9pss9jSv" alt="">&lt;/p>
&lt;p>Как видим, к сети 172.16.1.0 можно попасть двумя путями: через R2  и через связку R3+R4. Cost’ы, написанные возле каждого линка задают стоимость линка, своеобразный аналог параметра distance в ip-route. Чем ниже значение cost’а, тем выше вероятность того, что трафик пойдет по этому пути. Но как видно на следующем рисунке суммарная стоимость обоих маршрутов к сети 172.16.1.0 составляет 20. Так по какому же пути пойдет трафик?&lt;/p>
&lt;p>&lt;img src="https://lh5.googleusercontent.com/bmVkOn8ug3_iwz5CxX4V4pG6rBUV1PWEuUribhRBcgrH74XIYw5EHkzpYJqACPQMg-KBcT64yNIWlEyZU5SYquXmkMeA-nHSeA0w_tyf979IeeesldHJMF9lzXa1-QlPp2X5zwSU" alt="500px-Sp-tree.png">&lt;/p>
&lt;p>В таком случае в таблице маршрутизации увидим примерно такую картину - к одной сети имеем два шлюза. И трафик должен пойти через оба шлюза. В этом случае мы можем управлять тем, куда пойдет трафик. Называется эта технология Policy Based Routing, но тема управления трафиком выходит за рамки этой статьи.&lt;img src="https://lh3.googleusercontent.com/cPf0vHU_4mm0j9dMGH-8CTmKI2qRy-GNCPey8D9iRfSxONlpmF22xGA7TAXM7mZKow9vvgxKjRqZAisabPYkuvxpVk1mOZBkj7u9_ClxXR3mbWAvz9KvToxnZvgAjNo3urv-u3u5" alt="">&lt;/p>
&lt;p>Сделать, чтобы OSPF “заработал” в Mikrotik RouterOS очень просто - нужно лишь добавить в backbone на каждом роутере в Routing - OSPF - Networks все ваши сети, между которыми вы хотите динамическую маршрутизацию и “оно заработает”.&lt;/p>
&lt;p>&lt;img src="https://lh5.googleusercontent.com/W5tJB4H6ueSTcer4mrd4rJHO8PN88T9yB7QAmCn964Ox3AA1TAvfdoJWC_2D95G9EyJiIB3xgU4yLIfaVxVJzB_BYiqS_wqiBj3RWsbJUvIjxCVuAQm8yioPpvVkcZd-xl83plBW" alt="">&lt;/p>
&lt;p>Но мы ведь хотим управлять процессом. Тот, кто не хочет управлять дальше может не читать. Остальным - добро пожаловать!&lt;/p>
&lt;p>Рассматривать будем сеть, типичную для организации с несколькими филиалами. Имеем центральный офис (Headquarter на схеме, для краткости будем звать его ЦО) с сетью 192.168.0.0/24 (что я, кстати, не рекомендую при дефолтных настройках OSPF. Почему - скажу ниже). В ЦО расположены все основные элементы инфраструктуры - контроллер домена, сервер удаленного доступа, почтовый сервер и т.д. Все филиалы должны иметь доступ ко всем этим сервисам.&lt;/p>
&lt;p>Несколько филиалов (Branche на схеме, для краткости - СП - Структурное Подразделение) с адресами 192.168.X.0/24. Между ЦО и каждым СП шифрованный туннель SSTP (или любой другой VPN)  - адреса в туннелях из подсети 192.168.255.0/24 (192.168.255.10 - ЦО, 192.168.255.1 - СП1, 192.168.255.2 - СП2, &amp;hellip;). Между филиалами связь не нужна, т.к. все службы в ЦО. Когда филиалов 3, нам легко добавить 3 маршрута на роутер в ЦО и по одному на каждый из роутеров СП. Итого 6 движений мышкой. А что если СП у нас не 3, а 33 и необходимы маршруты от каждого каждому, а ещё есть подрядчики с доступом к нескольким СП? Тут и приходит на помощь OSPF.&lt;/p>
&lt;p>&lt;img src="https://lh3.googleusercontent.com/A4EHiSGPUqDZ1beS7QFD_l8GnvOMSDr28Oab4DtlwqjYgAnJnul5ex94nxPd8Oo5VTfozCLRWL5rDpuoBqu-cGa96rbHFJ5rVWErypF0U47M0nosNtbR13u7fKObO6hDsM_zH9_Q" alt="">&lt;/p>
&lt;p>Кому надо “быстро и пофиг как оно работает”, могут пойти по схеме, предложенной выше - добавить в backbone все свои сети.&lt;/p>
&lt;p>Почему именно backbone? Backbone в переводе с английского - хребет, позвоночник. OSPF оперирует понятиями Area (область), Autonomous System (AS, автономная система). AS - все сети, которые принадлежат вам и между которыми может работать ваш протокол динамической маршрутизации. Area - часть этой сети. На картинке ниже показана одна AS с тремя Area, одна из которых - backbone (Area 0 с ID 0.0.0.0). Каждая Area имеет свой ID, похожий на IP адрес. Backbone всегда имеет ID 0.0.0.0. Все области в OSPF должны иметь линк с backbone. Иначе ничего работать не будет.&lt;/p>
&lt;p>&lt;img src="https://lh5.googleusercontent.com/noQfSLYZJlp7I4vlDy913kNgc-vs9hD_313y347vX9boBeYaguiXos_05VsWs5ZHV7dy_yobuAfGRXz5j0rmZRn6PtC7QXAQjeEYvCFegbTPsQsV53QdX7iZiVh6s16wfzy_kSAR" alt="slide1.jpg">&lt;/p>
&lt;p>В нашем примере мы решили долго не думать и загнать все в backbone. По большому счету это ничем не грозит и работать будет. Но если провайдер отдает одному из ваших филиалов частный адрес из 192.168.0.0/16 (192.168.18.27/29, например), то в вашей таблице маршрутизации появится сеть провайдера. И если кто-то с другой стороны провайдера использует такие же настройки (или просто указал маршрут к вашим сетям), то он сможет беспрепятственно попасть в вашу сеть. А уж случайно это сделали или намеренно - узнаете когда данные из вашей БД всплывут в интернете.&lt;/p>
&lt;p>В этом случае можно использовать авторизацию на каждом интерфейсе Routing - OSPF - Interfaces.&lt;/p>
&lt;p>&lt;img src="https://lh3.googleusercontent.com/0ZY3n6YzZay2C5Nq2zlFrSy2N5P2Ba1qVBITR-vhPNGXNFO9jGb8A_Fn-Gopw3kGGOJSjBJtOIeRQncruQsdVP5dS1DM7hAiI0C5Th_gVMj_vCbJwISiCYp9jk1rYpJOF7CR3_oT" alt="">&lt;/p>
&lt;p>Или указать, что интерфейс, смотрящий к провайдеру будет в пассивном режиме.&lt;/p>
&lt;p>&lt;img src="https://lh6.googleusercontent.com/bqn9Fg0NfnLC6J6NQJhxY2_2xeCexwJS6nI_sZQ6b9g52FPIPQLb_eUVTjPpjDdCR-u9dc_EAzvcXWycFryBGx0Z0TxeIdur9yqXKwHJ2fezwSXPC05T6x8rhqFcQ5zwrRjLzjuL" alt="">&lt;/p>
&lt;p>Теперь поговорим о том, как сделать “правильно” - не вещать свои сети куда попало и позволить грамотно траблшутить работу OSPF.&lt;/p>
&lt;p>Как мы говорили выше, каждая область имеет свой ID. Также и каждый участник OSPF имеет свой ID. По умолчаню он выставляется автоматически и выбирается из IP адресов, присвоенных интерфейсам роутера. Но нам надо проставить его в ручную, чтобы была какая-то логика в именовании и мы всегда знали откуда пришел запрос. Ставится это в Routing - OSPF - Instances - Router ID.&lt;/p>
&lt;p>**&lt;br>
&lt;img src="https://lh3.googleusercontent.com/3ug33SNyG9U33zD4xO45a-ls1VyNV2fWqUIYD9-5S-ct9hyhQY1sxfbyEpj6jMi6j3EZHluf2DFQZZ1KdKidP11l8yU0IpYDRAFenDdhm3YqsB6GvxQ9xCClTdOCCHwk0skL5jkE" alt="">**&lt;/p>
&lt;p>В нашей схеме имеется несколько областей. Как мы выяснили, основная область, соединяющая все остальные - backbone. Именно в этой области летают пакеты от одного роутера к другому, позволяющие обмениваться маршрутной информацией. Значит, этой областью должны быть туннели, соединяющие СП и ЦО, что видно на рисунке ниже.&lt;/p>
&lt;p>**&lt;br>
&lt;img src="https://lh6.googleusercontent.com/j13-MMPzbhY3dwDuC5rI7bqBm3Ez29U7L1FQvt_6EOe_ilDLeHRQZjCSdv_4V3gvuu1HI2Gp1nPJQXvwo1BdNfAyGY54UuPKVrrddn02edY4ujtxo6JP_62BFilwX_OxIek0aMvF" alt="">&lt;/p>
&lt;p>**Таким образом, нам необходимо выделить на каждом маршрутизаторе по две зоны - backbone и свою локальную сеть. На примере ЦО:&lt;/p>
&lt;p>routing ospf area add name=Area0 area-id=192.168.0.0&lt;/p>
&lt;p>routing ospf network add area=Area0 network=192.168.0.0/24&lt;/p>
&lt;p>routing ospf network add area=backbone network=192.168.255.0/24&lt;/p>
&lt;p>И точно так же на остальных маршрутизаторах, только заменив Area-ID, Area name и network на свои.&lt;/p>
&lt;p>Теперь на каждом маршрутизаторе можем увидеть маршруты ко всем остальным сетям с буквами D и o в описании, что означает, что эти маршруты D - динамические (прилетели в резудльтате работы протоколов динамической маршрутизации) и o - из протокола  OSPF.&lt;/p>
&lt;p>&lt;img src="https://lh3.googleusercontent.com/Xm1gPou5DGykhpHT6MdJ0us-DNZZ6t6IcJFQ9kHarSsHnTdxZwMZ2d08NH-88YVkkEPuHa9Phewkbnc_NtnRJkLme77h2QSFWpJ71ESJ0IGyDNQM1isavubZvUDR9Dy_6c_rNyR8" alt="SP2_2.PNG">&lt;/p>
&lt;p>Таким образом мы произвели простую и надежную настройку протокола динамической маршрутизации. У OSPF ещё имеется куча дополнительных настроек, таких как приоритет роутера, стоимость интерфейса, время определения состояний и многое, многое другое. Это позволяет очень гибко настроить маршрутизацию под свои нужды, но тема эта очень обширная и выходит за рамки этого и так очень растянувшегося поста. Если читатели проявят желание, то в будущем можно будет подробно расписать (почти) все нюансы применения OSPF.&lt;/p>
&lt;p>Картинки с wiki.mikrotik.com, blog.globalknowledge.com и других ресурсов, а также свои скриншоты и схемы, нарисованные с помощью сервиса &lt;a href="https://www.draw.io/">draw.io&lt;/a>&lt;/p>
&lt;p>Статья написана мной для &lt;a href="http://lanmarket.ua/stats/protokol-dinamicheskoy-marshrutizacii-OSPF">lanmarket.ua&lt;/a>&lt;/p></content></item><item><title>Routing Security in Mikrotik RoutrerOS</title><link>https://bubnovd.net/blogger/routing-security-in-mikrotik-routreros/</link><pubDate>Mon, 14 Mar 2016 23:42:00 +0000</pubDate><guid>https://bubnovd.net/blogger/routing-security-in-mikrotik-routreros/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>MTCTCE</title><link>https://bubnovd.net/blogger/mtctce/</link><pubDate>Sat, 20 Feb 2016 08:33:00 +0000</pubDate><guid>https://bubnovd.net/blogger/mtctce/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>Почему за EoIP over OpenVPN нужно отрубать руки. И почему обе.</title><link>https://bubnovd.net/blogger/%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D0%B7%D0%B0-eoip-over-openvpn-%D0%BD%D1%83%D0%B6%D0%BD%D0%BE-%D0%BE%D1%82%D1%80%D1%83%D0%B1%D0%B0%D1%82%D1%8C-%D1%80%D1%83%D0%BA%D0%B8.-%D0%B8-%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D0%BE%D0%B1%D0%B5./</link><pubDate>Sun, 17 Jan 2016 23:16:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D0%B7%D0%B0-eoip-over-openvpn-%D0%BD%D1%83%D0%B6%D0%BD%D0%BE-%D0%BE%D1%82%D1%80%D1%83%D0%B1%D0%B0%D1%82%D1%8C-%D1%80%D1%83%D0%BA%D0%B8.-%D0%B8-%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D0%BE%D0%B1%D0%B5./</guid><description>У роутерной ОС RouterOS (каламбур получился =)) есть уникальная возможность создавать Ethernet туннели между удаленными точками. Технология проприентарная и никем больше не реализованная (такой же результат можно получить с помощью VPLS, но это совсем другой уровень). Функция интересная и даже рабочая. С помощью неё мы можем соединить несколько удаленных точек в один широковещательный домен с одним DHCP сервером и связью на L2.
Технология эта применяется&amp;hellip; А вот тут тупик. Давайте подумаем, где же она может применяться и чем может не устроить старый добрый роутинг.</description><content>&lt;p>У роутерной ОС RouterOS (каламбур получился =)) есть уникальная возможность создавать Ethernet туннели между удаленными точками. Технология проприентарная и никем больше не реализованная (такой же результат можно получить с помощью VPLS, но это совсем другой уровень). Функция интересная и даже рабочая. С помощью неё мы можем соединить несколько удаленных точек в один широковещательный домен с одним DHCP сервером и связью на L2.&lt;/p>
&lt;p>Технология эта применяется&amp;hellip; А вот тут тупик. Давайте подумаем, где же она может применяться и чем может не устроить старый добрый роутинг. Связь между любым оборудованием, знакомым с IP (а такого оборудования с Ethernet интерфейсами сейчас чуть менее 100%) возможна с помощью маршрутизации - это основа протокола. На ум приходят лишь видеорегистраторы, способные видеть камеры лишь в пределах своего сегмента сети. &lt;/p>
&lt;p>Отсюда вывод: если вам понадобится туннель EoIP для проброса VLAN&amp;rsquo;a, Ethernet сегмента или каких-то других хотелок - задумайтесь. Скорее всего не нужно городить EoIP, а смотреть в сторону изменения структуры сети, перехода на другие технологии.&lt;/p>
&lt;p>К тому же туннель EoIP нешифрованный и все ваши данные, идущие по нему можно легко перехватить. К счастью, в последних версиях RouterOS добавили функцию шифрования IPSec прямо внутри EoIP без каких-то дополнительных телодвижений.&lt;/p>
&lt;p>В своем немалом опыте работы с Mikrotik (3 года плотной работы), я встречал EoIP 3 раза. Из них 2 раза эта технология была применена банально из-за незнания админами принципов маршрутизации. А третий раз для помещения серверов в один сегмент, будто они находятся в одном месте - просто чтобы запутать следы.&lt;/p>
&lt;p>Итак, за необдуманное применение ненужных вам технологий, в частности, EoIP нужно отрубать руку.&lt;/p>
&lt;p>Из нешифрованности EoIP, а так же в силу того, что поднять такой туннель можно только между двумя белыми IP адресами встает вопрос, а что же делать. И выход лежит на поверхности - поднять любой туннель (желательно шифрованный) и поверх него него пустить EoIP. После беглого гугления узнаем, что хорошая защита и конфигурируемость у OpenVPN. И решаем использовать его, тем более в сети полно мануалов.&lt;/p>
&lt;p>Да, OpenVPN хорош. Он позволяет использовать различные виды шифрования, в том числе &amp;ldquo;неломаемый&amp;rdquo; blowfish, использует сертификаты. Возможностей у него куча, включая пушинг маршрутов (в Linux). Но в тех материалах, что гуглятся на раз-два не указано, что работает OVPN на уровне User-Space, в то время, как все остальные (pptp, l2tp, sstp) на уровне ядра.&lt;/p>
&lt;p>Это значит, что приоритет у всех процессов, выполняющихся на уровне ядра выше, чем у сервера OpenVPN. То есть процессор маршрутизатора сначала выполнит все свои задачи, а потом возьмется за шифрование, инкапсуляцию трафика в туннель. По этой же причине OVPN сильно нагружает процессор.&lt;/p>
&lt;p>Что получаем в итоге. Весь трафик нашей сети (с обеих сторон) должен залезть в EoIP туннель. Включая широковещательный трафик, который так любит Microsoft - LLMNR, выборы мастер-браузера и т.д.(а это 10-15% трафика) Это трафик нужно фрагментировать и инкапсулировать в туннель. Сам EoIP туннель нужно зашифровать, фрагментировать и инкапсулировать в OVPN, процессы которого выполнятся в последнюю очередь и нагрузят процессор. Получаем жуткий оверхед на CPU, паразитный трафик на всех концах туннелей и отрубаем вторую руку.&lt;/p>
&lt;p>Ещё можно палец на ноге отрубить за то, что выбрали TCP туннель. RouterOS пока не умеет работать с OVPN over UDP. То есть туннель зависит от TCP, который очень придирчив к качеству соединения и при потере нескольких пакетов нужна будет новая инициализация соединения и, как следствие, потеря EoIP туннеля и связности сети.&lt;/p>
&lt;p>В качестве доказательства привожу картинку нагрузки на роутер. С одной стороны сервера, с другой - 10 компьютеров на винде с запущенными терминальными клиентами (mstsc) и несколько телефонов. Средний трафик - около 1 Mb/s, загрузка процессора 5% OVPN, 5% Ethernet. В пики видно то, что на картинке - 30% OVPN, 20% Ethernet. То есть половину CPU отдали за свою недальновидность.&lt;/p>
&lt;p>&lt;a href="http://1.bp.blogspot.com/-LBxCrqeMCvY/VpyF3JIq0TI/AAAAAAAAAqQ/q4HcxS8O4qQ/s1600/eoipoovpn1.PNG">&lt;img src="https://1.bp.blogspot.com/-LBxCrqeMCvY/VpyF3JIq0TI/AAAAAAAAAqQ/q4HcxS8O4qQ/s400/eoipoovpn1.PNG" alt="">&lt;/a>&lt;/p>
&lt;p>OVPN Server&lt;/p></content></item><item><title>Динамическая маршрутизация в Mikrotik RouterOS</title><link>https://bubnovd.net/blogger/%D0%B4%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%B2-mikrotik-routeros/</link><pubDate>Sun, 17 Jan 2016 02:05:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%B4%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%B2-mikrotik-routeros/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>Хорошая презентация о настройке фаервола в RouterOS</title><link>https://bubnovd.net/blogger/%D1%85%D0%BE%D1%80%D0%BE%D1%88%D0%B0%D1%8F-%D0%BF%D1%80%D0%B5%D0%B7%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F-%D0%BE-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B5-%D1%84%D0%B0%D0%B5%D1%80%D0%B2%D0%BE%D0%BB%D0%B0-%D0%B2-routeros/</link><pubDate>Sun, 17 Jan 2016 00:00:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%85%D0%BE%D1%80%D0%BE%D1%88%D0%B0%D1%8F-%D0%BF%D1%80%D0%B5%D0%B7%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F-%D0%BE-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B5-%D1%84%D0%B0%D0%B5%D1%80%D0%B2%D0%BE%D0%BB%D0%B0-%D0%B2-routeros/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>Сравнение туннелей в RouterOS</title><link>https://bubnovd.net/blogger/%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B5%D0%B9-%D0%B2-routeros/</link><pubDate>Wed, 13 Jan 2016 01:49:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B5%D0%B9-%D0%B2-routeros/</guid><description>http://rickfreyconsulting.com/mikrotik-vpns/</description><content>&lt;p>&lt;!-- raw HTML omitted -->&lt;a href="http://rickfreyconsulting.com/mikrotik-vpns/">http://rickfreyconsulting.com/mikrotik-vpns/&lt;/a>&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Сегментация сети с использованием оборудования Mikrotik и D-Link</title><link>https://bubnovd.net/blogger/%D1%81%D0%B5%D0%B3%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F-%D1%81%D0%B5%D1%82%D0%B8-%D1%81-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-%D0%BE%D0%B1%D0%BE%D1%80%D1%83%D0%B4%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-mikrotik-%D0%B8-d-link/</link><pubDate>Tue, 22 Dec 2015 06:14:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%B5%D0%B3%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F-%D1%81%D0%B5%D1%82%D0%B8-%D1%81-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC-%D0%BE%D0%B1%D0%BE%D1%80%D1%83%D0%B4%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-mikrotik-%D0%B8-d-link/</guid><description/><content>&lt;!-- raw HTML omitted --></content></item><item><title>Yet another RouterOS script</title><link>https://bubnovd.net/blogger/yet-another-routeros-script/</link><pubDate>Wed, 09 Dec 2015 22:41:00 +0000</pubDate><guid>https://bubnovd.net/blogger/yet-another-routeros-script/</guid><description>Скрипт ищет интерфейс sstp клиента, имя которого содержит в себе строку video, копирует имя интерфейса, имя пользователя и пароль для подключения, а так же адрес vpn сервера. Удаляет упоминание об этом интерфейсе в настройках OSPF (т.к. после удаления появится интерфейс unknown, а без удаления интерфейса новый не создастся - имена одинаковые), создает нешифрованное соединение pptp с аналогичными настройками и вписывает его в параметры OSPF.#!Ищет sstp-интерфейс с именем, содержащим video#! копирует его настройки, убирает номер порта и#!</description><content>&lt;p>Скрипт ищет интерфейс sstp клиента, имя которого содержит в себе строку video, копирует имя интерфейса, имя пользователя и пароль для подключения, а так же адрес vpn сервера. Удаляет упоминание об этом интерфейсе в настройках OSPF (т.к. после удаления появится интерфейс unknown, а без удаления интерфейса новый не создастся - имена одинаковые), создает нешифрованное соединение pptp с аналогичными настройками и вписывает его в параметры OSPF.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#!Ищет sstp-интерфейс с именем, содержащим video&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#! копирует его настройки, убирает номер порта и&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#! создает pptp интерфейс с подобными настройками&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#! Copyright Dmitry Bubnov &lt;a href="http://bubnovd.net">http://bubnovd.net&lt;/a>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/interface sstp-client&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local name [get [find name~&amp;ldquo;video&amp;rdquo;] name]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local srv [get [find name~&amp;ldquo;video&amp;rdquo;] connect-to]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local conto [:pick $srv 0 ([:len $srv]-4)]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local user [get [find name~&amp;ldquo;video&amp;rdquo;] user]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local pwd [get [find name~&amp;ldquo;video&amp;rdquo;] password]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/routing ospf interface remove [find interface=$name]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->remove $name&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/interface pptp-client add connect-to=$conto user=$user password=$pwd name=$name allow=mschap2 disabled=no profile=default&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/routing ospf interface add interface=$name cost=9 network-type=point-to-point &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Он же в Python для пакетного изменения:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#!/usr/bin/env python&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->from RosAPI import Core&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mas = []&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->with open(&amp;ldquo;list.txt&amp;rdquo;) as f:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->mas = f.read().splitlines()&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->for i in range(len(mas)):&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->try:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->a = Core(mas[i])&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->except:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->print &amp;ldquo;No Connection&amp;rdquo;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->else:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->a.login(&amp;ldquo;user&amp;rdquo;, &amp;ldquo;password&amp;rdquo;)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->print i&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->a.talk([&amp;quot;/system/script/add&amp;quot;, &amp;ldquo;=name=&amp;rdquo; + &amp;ldquo;temp&amp;rdquo;, &amp;ldquo;=source=&amp;rdquo; + &amp;lsquo;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->#! Copyright Dmitry Bubnov http://bubnovd.net\r\n&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/interface sstp-client\r\n:local name [get [find name~&amp;quot;video&amp;quot;] name]\r\n:local srv [get [find name~&amp;quot;video&amp;quot;] connect-to]\r\n:local conto [:pick $srv 0 ([:len $srv]-4)]\r\n:local user [get [find name~&amp;quot;video&amp;quot;] user]\r\n:local pwd [get [find name~&amp;quot;video&amp;quot;] password]\r\n/routing ospf interface remove [find interface=$name]\r\nremove $name\r\n/interface pptp-client add connect-to=$conto user=$user password=$pwd name=$name allow=mschap2 disabled=no profile=default\r\n/routing ospf interface add interface=$name cost=9 network-type=point-to-point&amp;rsquo;])&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->a.talk([&amp;quot;/system/script/run&amp;quot;, &amp;ldquo;=.id=&amp;rdquo; + &amp;ldquo;temp&amp;rdquo;])&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->a.talk([&amp;quot;/system/script/remove&amp;quot;, &amp;ldquo;=.id=&amp;rdquo; + &amp;ldquo;temp&amp;rdquo;])&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->print mas[i]  &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>DHCP, Option 82</title><link>https://bubnovd.net/blogger/dhcp-option-82/</link><pubDate>Mon, 09 Nov 2015 03:38:00 +0000</pubDate><guid>https://bubnovd.net/blogger/dhcp-option-82/</guid><description>Встала задача: определять на каком порту какого свитча находится конкретный IP-адрес. На самом деле задача глобальнее, но сейчас имеет смысл именно это. В ходе гугления вышел на DHCP Option 82. Инфы много, но кроме теории важно это.Суть в том, что коммутатор в запрос DHCP добавляет два поля: Agent Remote ID (идентификатор коммутатора) и Agent Circuit ID (идентификатор порта). Казалось бы, всё просто. Но я столкнулся с некоторыми трудностями.Дело в том, что сеть поделена на сегменты для улучшения безопасности, выделения потоков трафика и уменьшения широковещательного трафика.</description><content>&lt;p>Встала задача: определять на каком порту какого свитча находится конкретный IP-адрес. На самом деле задача глобальнее, но сейчас имеет смысл именно это. В ходе гугления вышел на DHCP Option 82. Инфы много, но кроме &lt;!-- raw HTML omitted -->теории&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->важно&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->это&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->Суть в том, что коммутатор в запрос DHCP добавляет два поля: Agent Remote ID (идентификатор коммутатора) и Agent Circuit ID (идентификатор порта). Казалось бы, всё просто. Но я столкнулся с некоторыми трудностями.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Дело в том, что сеть поделена на сегменты для улучшения безопасности, выделения потоков трафика и уменьшения широковещательного трафика. Каждый сегмент имеет свою адресацию и, соответственно, свой DHCP-сервер.&lt;!-- raw HTML omitted -->Чтобы настроить работу Option 82, коммутатор необходимо настроить как DHCP-relay. Это значит, что при получении DHCP request&amp;rsquo;a коммутатор просто отправит этот запрос DHCP серверу, указанному в настройках релея. Таким образом можно уменьшить количество широковещательного трафика в пределах сегмента и иметь один DHCP сервер на несколько подсетей. Но, DHCP-relay может работать только с одним DHCP-сервером (указанным в настройках релея), соответственно, все наши сегменты получат адреса из одной подсети, что&lt;!-- raw HTML omitted -->нас совсем не устраивает.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Умные инженеры придумали для этого т.н. DHCP Snooping или DHCP Local Relay в терминологии D-Link&amp;rsquo;a. Просто указываем VLAN&amp;rsquo;ы в которых будет работать Relay и правим параметры Option 82 если требуется.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->На DHCP-сервере (в моем случае Mikrotik RouterOS) в полях Agent Remote/Circuit ID получаем коммутатор и порт, на котором висит наш адрес. В более продвинутых DHCP серверах на основе этой информации можно очень тонко сконфигурировать работу DHCP.&lt;!-- raw HTML omitted -->Так это выглядит в DHCP Leases Mikrotik. В поле Agent Circuit ID последние 2 символа - шестнадцатеричный номер порта.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Спасибо Никита Писарев aka mastakid  и blackc за разжевывание&lt;/p></content></item><item><title>Моя сертифицированный консультант Mikrotik</title><link>https://bubnovd.net/blogger/%D0%BC%D0%BE%D1%8F-%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9-%D0%BA%D0%BE%D0%BD%D1%81%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D0%BD%D1%82-mikrotik/</link><pubDate>Thu, 01 Oct 2015 20:58:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BC%D0%BE%D1%8F-%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9-%D0%BA%D0%BE%D0%BD%D1%81%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D0%BD%D1%82-mikrotik/</guid><description>Теперь я сертифицированный консультант Mikrotik. Единственный на Урале, между прочим. Жду ваших вопросов.Страница с консультантами тут</description><content>&lt;p>Теперь я сертифицированный консультант &lt;!-- raw HTML omitted -->Mikrotik&lt;!-- raw HTML omitted -->. Единственный на Урале, между прочим. Жду ваших вопросов.&lt;!-- raw HTML omitted -->Страница с консультантами &lt;!-- raw HTML omitted -->тут&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Режимы бондинга в RouterOS. И не только в RouterOS</title><link>https://bubnovd.net/blogger/%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D1%8B-%D0%B1%D0%BE%D0%BD%D0%B4%D0%B8%D0%BD%D0%B3%D0%B0-%D0%B2-routeros.-%D0%B8-%D0%BD%D0%B5-%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE-%D0%B2-routeros/</link><pubDate>Tue, 25 Aug 2015 03:05:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D1%8B-%D0%B1%D0%BE%D0%BD%D0%B4%D0%B8%D0%BD%D0%B3%D0%B0-%D0%B2-routeros.-%D0%B8-%D0%BD%D0%B5-%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE-%D0%B2-routeros/</guid><description>В вики микротика не совсем понятно описано. На хабре об этом сказали лучше:mode=0 (balance-rr)Последовательно кидает пакеты, с первого по последний интерфейс. mode=1 (active-backup)Один из интерфейсов активен. Если активный интерфейс выходит из строя (link down и т.д.), другой интерфейс заменяет активный. Не требует дополнительной настройки коммутатораmode=2 (balance-xor)Передачи распределяются между интерфейсами на основе формулы ((MAC-адрес источника) XOR (MAC-адрес получателя)) % число интерфейсов. Один и тот же интерфейс работает с определённым получателем. Режим даёт балансировку нагрузки и отказоустойчивость.</description><content>&lt;p>В вики микротика не совсем понятно описано. На &lt;!-- raw HTML omitted -->хабре&lt;!-- raw HTML omitted --> об этом сказали лучше:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mode=0 (balance-rr)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Последовательно кидает пакеты, с первого по последний интерфейс. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mode=1 (active-backup)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Один из интерфейсов активен. Если активный интерфейс выходит из строя (link down и т.д.), другой интерфейс заменяет активный. Не требует дополнительной настройки коммутатора&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mode=2 (balance-xor)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Передачи распределяются между интерфейсами на основе формулы ((MAC-адрес источника) XOR (MAC-адрес получателя)) % число интерфейсов. Один и тот же интерфейс работает с определённым получателем. Режим даёт балансировку нагрузки и отказоустойчивость.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mode=3 (broadcast)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Все пакеты на все интерфейсы&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mode=4 (802.3ad)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Link Agregation — IEEE 802.3ad, требует от коммутатора настройки. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mode=5 (balance-tlb)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Входящие пакеты принимаются только активным сетевым интерфейсом, исходящий распределяется в зависимости от текущей загрузки каждого интерфейса. Не требует настройки коммутатора.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->mode=6 (balance-alb)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Тоже самое что 5, только входящий трафик тоже распределяется между интерфейсами. Не требует настройки коммутатора, но интерфейсы должны уметь изменять MAC.&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Mikrotik RouterOS. Winbox грузит CPU на 100%</title><link>https://bubnovd.net/blogger/mikrotik-routeros.-winbox-%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82-cpu-%D0%BD%D0%B0-100/</link><pubDate>Fri, 26 Jun 2015 04:23:00 +0000</pubDate><guid>https://bubnovd.net/blogger/mikrotik-routeros.-winbox-%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82-cpu-%D0%BD%D0%B0-100/</guid><description>Обнаружил баг в RouterOS, установленной на x86 под QEMU. Процессор нагружается на 100%, винбоксом что-то делать нереально. Подключаюсь по ssh, открываю /tool profile и вижу, что проц грузится на 90-100% винбоксом. Смотрю в /user active print detail и вижу себя, подключенного по ssh и сессию винбокса с севера мониторинга The Dude. Хотя все винбоксы я уже закрыл. Видимо, дудка не всегда корректно закрывает винбоксы, запущенные в её интерфейсе и процесс остается крутиться на сервере.</description><content>&lt;p>Обнаружил баг в RouterOS, установленной на x86 под QEMU. Процессор нагружается на 100%, винбоксом что-то делать нереально. Подключаюсь по ssh, открываю /tool profile и вижу, что проц грузится на 90-100% винбоксом. Смотрю в /user active print detail и вижу себя, подключенного по ssh и сессию винбокса с севера мониторинга The Dude. Хотя все винбоксы я уже закрыл. Видимо, дудка не всегда корректно закрывает винбоксы, запущенные в её интерфейсе и процесс остается крутиться на сервере. Захожу на сервер, перезапускаю службу The Dude и нагрузка падает.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Но это всего лишь снятие нагрузки с проца, в следующий раз при запуске винбокса ситуация повторяется. В её корнях ещё предстоит разобраться.&lt;/p></content></item><item><title>RouterOS DNS failure</title><link>https://bubnovd.net/blogger/routeros-dns-failure/</link><pubDate>Tue, 31 Mar 2015 23:32:00 +0000</pubDate><guid>https://bubnovd.net/blogger/routeros-dns-failure/</guid><description>В RouterOS 6.27 добавили несколько фич в DNS резолвер. В некоторых ситуациях адреса просто не резолвятся (DNS failure). Выход простой - в IP-DNS вместо нулей в строках Query Server Timeout и Query Total Timeout прописываем 2. И DNS снова в строю!</description><content>&lt;p>В RouterOS 6.27 добавили несколько фич в DNS резолвер. В некоторых ситуациях адреса просто не резолвятся (DNS failure). Выход простой - в IP-DNS вместо нулей в строках  Query Server Timeout и Query Total Timeout прописываем 2. И DNS снова в строю!&lt;/p></content></item><item><title>Объединение одинаковых подсетей в RouterOS</title><link>https://bubnovd.net/blogger/%D0%BE%D0%B1%D1%8A%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D0%B4%D0%B8%D0%BD%D0%B0%D0%BA%D0%BE%D0%B2%D1%8B%D1%85-%D0%BF%D0%BE%D0%B4%D1%81%D0%B5%D1%82%D0%B5%D0%B9-%D0%B2-routeros/</link><pubDate>Tue, 10 Mar 2015 23:59:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D0%BE%D0%B1%D1%8A%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D0%B4%D0%B8%D0%BD%D0%B0%D0%BA%D0%BE%D0%B2%D1%8B%D1%85-%D0%BF%D0%BE%D0%B4%D1%81%D0%B5%D1%82%D0%B5%D0%B9-%D0%B2-routeros/</guid><description>Имеем две сети с одинаковой адресацией и site-to-site VPN между ними. Необходимо обеспечить взаимодействие между сетями, не изменяя их внутренней адресации. Не спрашивайте почему нельзя сменить адресацию - просто нельзя. В обеих точках оборудование Mikrotik.Решение подсказала эта статья. Вся основная настройка будет проводиться только на роутере-клиенте. На втором роутере необходимо будет лишь прописать маршрут до фэйковой сети. Будем считать, что VPN уже функционирует. Я не буду расписывать детали прохождения пакетов, т.</description><content>&lt;p>Имеем две сети с одинаковой адресацией и site-to-site VPN между ними. Необходимо обеспечить взаимодействие между сетями, не изменяя их внутренней адресации. Не спрашивайте почему нельзя сменить адресацию - просто нельзя. В обеих точках оборудование Mikrotik.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Решение подсказала эта &lt;!-- raw HTML omitted -->статья&lt;!-- raw HTML omitted -->. Вся основная настройка будет проводиться только на роутере-клиенте. На втором роутере необходимо будет лишь прописать маршрут до фэйковой сети. Будем считать, что VPN уже функционирует. Я не буду расписывать детали прохождения пакетов, т.к. это описано в указанной статье. Просто &lt;!-- raw HTML omitted -->код с хабра&lt;!-- raw HTML omitted --> и как &lt;!-- raw HTML omitted -->это делается в RouterOS&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Итак, наша сеть - 192.168.0.0/16. Сеть, в которую нужно попасть - 192.168.15.0/24. Отличия моих адресов от хабра:&lt;!-- raw HTML omitted -->1. там с обеих сторон 192.168.0.0/24. У меня 192.168.0.0/16 и 192.168.15.0/24&lt;!-- raw HTML omitted -->2. там фэйковые адреса 10.8.1.0/24, 10.8.2.0/24. У меня 10.9.0.0/16 и 172.25.25.0/24&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->iptables -t mangle -A PREROUTING -i tun0 -d 10.8.1.0/24 -j MARK &amp;ndash;set-mark 8&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->chain=prerouting action=mark-connection new-connection-mark=in passthrough=yes dst-address=172.25.25.0/24 in-interface=vpn&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->chain=output action=mark-routing new-routing-mark=in passthrough=yes connection-mark=in &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->iptables -t nat -A PREROUTING -m mark &amp;ndash;mark 8 -j NETMAP &amp;ndash;to 192.168.0.0/24&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->chain=dstnat action=netmap to-addresses=192.168.15.0/24 connection-mark=in&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->iptables -t nat -A POSTROUTING -m mark &amp;ndash;mark 8 -j NETMAP &amp;ndash;to 10.8.2.0/24&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->chain=srcnat action=netmap to-addresses=10.9.0.0/16 connection-mark=in&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->ip route add 192.168.0.0/24 dev eth1 table netmap&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->dst-address=192.168.15.0/24 gateway=ether2-master-local routing-mark=in&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Ну и приведу всю конфигурацию Mangle, NAT и Route.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip firewall mangle&amp;gt; print&lt;!-- raw HTML omitted -->Flags: X - disabled, I - invalid, D - dynamic&lt;!-- raw HTML omitted --> 0   chain=prerouting action=mark-connection new-connection-mark=in passthrough=yes&lt;!-- raw HTML omitted -->     dst-address=172.25.25.0/24 in-interface=vpn&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 1   chain=output action=mark-routing new-routing-mark=in passthrough=yes&lt;!-- raw HTML omitted -->     connection-mark=in&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 2   chain=prerouting action=mark-connection new-connection-mark=out passthrough=yes&lt;!-- raw HTML omitted -->     dst-address=10.9.0.0/16 in-interface=ether2-master-local&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 3   chain=output action=mark-routing new-routing-mark=out passthrough=yes&lt;!-- raw HTML omitted -->     connection-mark=out&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip firewall nat&amp;gt; print &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Flags: X - disabled, I - invalid, D - dynamic &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 0   ;;; default configuration&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->     chain=srcnat action=masquerade out-interface=ether1-gateway &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 1   chain=dstnat action=netmap to-addresses=192.168.15.0/24 connection-mark=in &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 2   chain=srcnat action=netmap to-addresses=10.9.0.0/16 connection-mark=in &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 3   chain=dstnat action=netmap to-addresses=192.168.15.0/24 routing-mark=out &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 4   chain=srcnat action=netmap to-addresses=172.25.25.0/24 routing-mark=out &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> /ip&amp;gt; route print detail &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Flags: X - disabled, A - active, D - dynamic, &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->C - connect, S - static, r - rip, b - bgp, o - ospf, m - mme, &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->B - blackhole, U - unreachable, P - prohibit &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 0 A S  dst-address=192.168.15.0/24 gateway=ether2-master-local &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        gateway-status=ether2-master-local reachable distance=1 scope=30 &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        target-scope=10 routing-mark=in &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 1 A S  dst-address=192.168.0.0/16 gateway=vpn &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        gateway-status=vpn reachable distance=1 scope=30 target-scope=10 &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        routing-mark=out &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> 4 A S  dst-address=192.168.0.0/16 gateway=%vpn_serv_IP% &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        gateway-status=192.168.242.1 reachable via  vpn distance=1 scope=30 &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->        target-scope=10&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Самый полный мануал по резервированию интернета на Mikrotik RouterOS</title><link>https://bubnovd.net/blogger/%D1%81%D0%B0%D0%BC%D1%8B%D0%B9-%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B%D0%B9-%D0%BC%D0%B0%D0%BD%D1%83%D0%B0%D0%BB-%D0%BF%D0%BE-%D1%80%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%D0%B0-%D0%BD%D0%B0-mikrotik-routeros/</link><pubDate>Thu, 05 Mar 2015 22:06:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%B0%D0%BC%D1%8B%D0%B9-%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B%D0%B9-%D0%BC%D0%B0%D0%BD%D1%83%D0%B0%D0%BB-%D0%BF%D0%BE-%D1%80%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%D0%B0-%D0%BD%D0%B0-mikrotik-routeros/</guid><description>В сети много мануалов по фэйловеру на RouterOS и подобрать нужный под конкретные цели иногда проблематично. В ходе своих экспериментов я выяснил, что наиболее универсальным является этот способ. Но у меня возникло несколько вопросов, ответы на которые я пока не нашел./ip routeadd dst-address=Host1 gateway=GW1 scope=10add dst-address=Host2 gateway=GW2 scope=10/ip routeadd distance=1 gateway=Host1 routing-mark=ISP1 check-gateway=pingadd distance=2 gateway=Host2 routing-mark=ISP1 check-gateway=ping/ip routeadd distance=1 gateway=Host2 routing-mark=ISP2 check-gateway=pingadd distance=2 gateway=Host1 routing-mark=ISP2 check-gateway=pingЯ делаю немного по-другому: первые две строки точно такие же, а дальше:/ip routeadd distance=1 gateway=Host1 check-gateway=pingadd distance=2 gateway=Host2 check-gateway=ping/ip routeadd distance=1 gateway=GW1 routing-mark=ISP1add distance=1 gateway=GW2 routing-mark=ISP2В первом варианте мне непонятно зачем пускать трафик, маркированный ISP1 по второму каналу и аналогично с ISP2.</description><content>&lt;p>В сети много мануалов по фэйловеру на RouterOS и подобрать нужный под конкретные цели иногда проблематично. В ходе своих экспериментов я выяснил, что наиболее универсальным является &lt;!-- raw HTML omitted -->этот&lt;!-- raw HTML omitted --> способ. Но у меня возникло несколько вопросов, ответы на которые я пока не нашел.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip route&lt;!-- raw HTML omitted -->add dst-address=&lt;!-- raw HTML omitted -->Host1&lt;!-- raw HTML omitted --> gateway=GW1 scope=&lt;!-- raw HTML omitted -->10&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add dst-address=&lt;!-- raw HTML omitted -->Host2&lt;!-- raw HTML omitted --> gateway=GW2 scope=&lt;!-- raw HTML omitted -->10&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip route&lt;!-- raw HTML omitted -->add distance=1 gateway=&lt;!-- raw HTML omitted -->Host1&lt;!-- raw HTML omitted --> routing-mark=ISP1 check-gateway=ping&lt;!-- raw HTML omitted -->add distance=2 gateway=&lt;!-- raw HTML omitted -->Host2&lt;!-- raw HTML omitted --> routing-mark=ISP1 check-gateway=ping&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip route&lt;!-- raw HTML omitted -->add distance=1 gateway=&lt;!-- raw HTML omitted -->Host2&lt;!-- raw HTML omitted --> routing-mark=ISP2 check-gateway=ping&lt;!-- raw HTML omitted -->add distance=2 gateway=&lt;!-- raw HTML omitted -->Host1&lt;!-- raw HTML omitted --> routing-mark=ISP2 check-gateway=ping&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Я делаю немного по-другому: первые две строки точно такие же, а дальше:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip route&lt;!-- raw HTML omitted -->add distance=1 gateway=&lt;!-- raw HTML omitted -->Host1&lt;!-- raw HTML omitted --> check-gateway=ping&lt;!-- raw HTML omitted -->add distance=2 gateway=&lt;!-- raw HTML omitted -->Host2&lt;!-- raw HTML omitted --> check-gateway=ping&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip route&lt;!-- raw HTML omitted -->add distance=1 gateway=&lt;!-- raw HTML omitted -->GW1&lt;!-- raw HTML omitted --> routing-mark=ISP1&lt;!-- raw HTML omitted -->add distance=1 gateway=GW&lt;!-- raw HTML omitted -->2&lt;!-- raw HTML omitted --> routing-mark=ISP2&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В первом варианте мне непонятно зачем пускать трафик, маркированный ISP1 по второму каналу и аналогично с ISP2. Чтобы не рвалась сессия? Она все равно рвется. В общем, я делаю по своему варианту.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Как оно работает?&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add dst-address=&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Host1&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> gateway=GW1 scope=&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->10&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->указываем, что трафик до Host1 будет ходить через провайдера ISP1. Аналогично со вторым.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add distance=1 gateway=Host1 check-gateway=ping&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->указывает шлюзом по умолчанию Host1. Тем самым создается рекурсивный маршрут через GW1. Проверяется доступность Host1 пингом. Если Host1 доступен, то шлюз - GW1, если не доступен, но доступен Host2, трафик идет через GW2.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Маркировка маршрутов необходима для того, чтобы трафик, пришедший в один из интерфейсов не улетел во второй, если метрика второго ниже. Маркировка создается в таблице Mangle фаервола:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add chain=prerouting &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->in-interface=ISP1-int &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->action=mark-connection new-connection-mark=ISP1 passthrough=yes &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add chain=prerouting connection-mark=ISP1 action=mark-routing new-routing-mark=ISP1&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add chain=output connection-mark=ISP1 action=mark-routing new-routing-mark=ISP1&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Так же по второму провайдеру.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Эта схема прекрасно работает при статическом IP. Но как быть с DHCP, PPP и т.д. А всё просто - в настройках DHCP/PPP-клиента отключаем Add Default Route. И добавляем необходимый маршрут руками. Единственная проблема - адрес шлюза может смениться. В таком случае необходимо применение скриптов. Я написал небольшой скрипт для работы с USB-модемом, который проверяет правильный ли шлюз указан в строке 8.8.4.4 gw GW2. PPP-интерфейс в моем случае называется modem.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local testIP 8.8.4.4/32&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local modemGW [/ip address get [find interface=&amp;ldquo;modem&amp;rdquo;] network]&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->if ($modemGW!=([/ip route get [find dst-address=$testIP] gateway])) do={&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->[/ip route set [find dst-address=$testIP] gateway $modemGW]}&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->В Scheduler добавляем расписание для этого скрипта, чтобы выполнялся раз в минуту. На основе моего скрипта можно создать свой для любого другого типа подключения.&lt;!-- raw HTML omitted -->Для нетерпеливых привожу полный список команд, необходимый для настройки модема в качестве резервного канала. Всё, что вам нужно - просто скопировать текст и вставить его в терминал. Основной придется отмаркировать и прописать в маршрутизации руками:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip firewall mangle&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add chain=input in-interface=modem action=mark-connection new-connection-mark=modem&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add chain=output connection-mark=modem action=mark-routing new-routing-mark=modem&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/ip route&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add dst-address=8.8.4.4/32 gateway=[/ip address get [find interface=&amp;ldquo;modem&amp;rdquo;] network] distance=1 scope=10&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add distance=2 gateway=8.8.4.4 scope=10 check-gateway=ping&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add dst-address=0.0.0.0/0 gateway=[/ip address get [find interface=&amp;ldquo;modem&amp;rdquo;] network] distance=1 scope=10 routing-mark=modem&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/interface ppp-client set modem dial-on-demand=no add-default-route=no&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/system script&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=modemGW source=&amp;quot;:local testIP 8.8.4.4/32\r\n:local modemGW [/ip address get [find interface=&amp;quot;modem&amp;quot;] network]\r\nif ($modemGW!=([/ip route get [find dst-address=$testIP] gateway])) do={\r\n[/ip route set [find dst-address=$testIP] gateway $modemGW]}&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/system scheduler&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=checkGW interval=00:01:00 on-event=modemGW&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Есть ещё один способ фэйловера. Делается он только с помощью скриптов. Полное его описание &lt;!-- raw HTML omitted -->здесь&lt;!-- raw HTML omitted -->. Ниже скрипт для его мгновенного создания:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/system script&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=SetGlobalParameters source=&amp;quot;#Main interface name\r\n:global MainIf [/interface get [find comment~&amp;quot;MainINT&amp;quot;] name]\r\n#Reserve interface name\r\n:global RsrvIf [/interface get [find comment~&amp;quot;RsrvINT&amp;quot;] name]\r\n#Main interface ip address\r\n:global MainIfAddress &amp;quot;&amp;quot;\r\n#Reserve interface ip address\r\n:global RsrvIfAddress &amp;quot;&amp;quot;&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=DefineMainIfIp source=&amp;quot;:global MainIf\r\n:global MainIfAddress &amp;quot;&amp;quot;\r\n:set MainIfAddress [/ip address get [find interface=$MainIf] address]&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=DefineReservedIfIp source=&amp;quot;:global RsrvIf\r\n:global RsrvIfAddress &amp;quot;&amp;quot;\r\n:set RsrvIfAddress [/ip address get [find interface=$RsrvIf] address]&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=ConnectionCheck source=&amp;quot;:global MainIf\r\n:global RsrvIf\r\n:global MainIfAddress\r\n:global RsrvIfAddress\r\n\r\n:local PingCount 3\r\n\r\n#yandex DNS\r\n:local PingTarget1 77.88.8.8\r\n\r\n#OpenDNS\r\n:local PingTarget2 208.67.222.222\r\n\r\n#google dns\r\n:local PingTarget3 8.8.8.8\r\n\r\n#Check main internet connection\r\n\r\n:local MainIfInetOk false;\r\n\r\nif ($MainIfAddress=&amp;quot;&amp;quot;) do={delay 5}\r\n\r\nif ($MainIfAddress!=&amp;quot;&amp;quot;) do={\r\n\r\n:local PingResult1 [/ping $PingTarget1 count=$PingCount interface=$MainIf]\r\n:local PingResult2 [/ping $PingTarget2 count=$PingCount interface=$MainIf]\r\n:local PingResult3 [/ping $PingTarget3 count=$PingCount interface=$MainIf]\r\n:set MainIfInetOk (($PingResult1 + $PingResult2 + $PingResult3) &amp;gt;= (2 * $PingCount))\r\n}\r\n\r\n#Check reserved internet connection\r\n:local RsrvIfInetOk false;\r\n\r\nif ($RsrvIfAddress=&amp;quot;&amp;quot;) do={delay 5}\r\n\r\nif ($RsrvIfAddress!=&amp;quot;&amp;quot;) do={\r\n:local PingResult1 [/ping $PingTarget1 count=$PingCount interface=$RsrvIf]\r\n\r\n:local PingResult2 [/ping $PingTarget2 count=$PingCount interface=$RsrvIf]\r\n:local PingResult3 [/ping $PingTarget3 count=$PingCount interface=$RsrvIf]\r\n\r\n:set RsrvIfInetOk (($PingResult1 + $PingResult2 + $PingResult3) &amp;gt;=(2 * $PingCount))\r\n}\r\n\r\n:put &amp;quot;MainIfInetOk=$MainIfInetOk&amp;quot;\r\n:put &amp;quot;RsrvIfInetOk=$RsrvIfInetOk&amp;quot;\r\n\r\nif (!$MainIfInetOk) do={\r\n/log error &amp;quot;Main internet connection error&amp;quot;\r\n}\r\n\r\nif (!$RsrvIfInetOk) do={\r\n/log error &amp;quot;Reserve internet connection error&amp;quot;\r\n}\r\n\r\n:local MainGWDistance [/ip route get [find comment~&amp;quot;MainGW&amp;quot;] distance]\r\n:local RsrvGWDistance [/ip route get [find comment~&amp;quot;RsrvGW&amp;quot;] distance]\r\n:put &amp;quot;MainGWDistance=$MainGWDistance&amp;quot;\r\n:put &amp;quot;RsrvGWDistance=$RsrvGWDistance&amp;quot;\r\n\r\n#SetUp gateways\r\nif ($MainIfInetOk &amp;amp;&amp;amp; ($MainGWDistance &amp;gt;= $RsrvGWDistance)) do={\r\n/ip route set [find comment~&amp;quot;MainGW&amp;quot;] distance=1\r\n/ip route set [find comment~&amp;quot;RsrvGW&amp;quot;] distance=2\r\n/log info &amp;quot;Switch to main internet connection&amp;quot;\r\n}\r\n\r\nif (!$MainIfInetOk &amp;amp;&amp;amp; $RsrvIfInetOk &amp;amp;&amp;amp; ($MainGWDistance &amp;lt;= $RsrvGWDistance)) do={\r\n/ip route set [find comment~&amp;quot;MainGW&amp;quot;] distance=2\r\n/ip route set [find comment~&amp;quot;RsrvGW&amp;quot;] distance=1\r\n/log warning &amp;quot;Switch to reserve internet connection&amp;quot;\r\n}&amp;quot;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->run SetGlobalParameters&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/system scheduler&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=SetGlobalParameters start-time=startup on-event=SetGlobalParameters&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=DefineMainIfIp interval=00:00:27 on-event=DefineMainIfIp&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=DefineReservedIfIp interval=00:00:27 on-event=DefineReservedIfIp&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->add name=ConnectionCheck interval=00:01:00 on-event=ConnectionCheck&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>RouterOS failover links</title><link>https://bubnovd.net/blogger/routeros-failover-links/</link><pubDate>Wed, 04 Mar 2015 00:27:00 +0000</pubDate><guid>https://bubnovd.net/blogger/routeros-failover-links/</guid><description>Фэйловер разных типов подключенийAdvanced Routing Failover without Scripting2 dynamic ISPs enabling failoverFailover via Netwatch IIIMikrotik OS и автоматическое переключение на резервный канал</description><content>&lt;p>Фэйловер разных типов подключений&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Advanced Routing Failover without Scripting&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->2 dynamic ISPs enabling failover&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Failover via Netwatch III&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Mikrotik OS и автоматическое переключение на резервный канал&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Dude и SNMP</title><link>https://bubnovd.net/blogger/dude-%D0%B8-snmp/</link><pubDate>Tue, 03 Mar 2015 01:19:00 +0000</pubDate><guid>https://bubnovd.net/blogger/dude-%D0%B8-snmp/</guid><description>Про The Dude я уже писал. Отличная система мониторинга для сетей, построенных на базе оборудования Mikrotik. Столкнулся со следующей проблемой: хочу получить графики пропускной способности интерфейсов коммутаторов не строя при этом связи между портом коммутатора и конечным устройством на схеме (ну не надо мне перегружать карту клиентскими компами/телефонами). Что-то подобное Dude организовать может, но в ходе чтения различных материалов и обсуждений конкретного решения я не нашел и пришлось копать дальше в тему.</description><content>&lt;p>Про The Dude я уже писал. Отличная система мониторинга для сетей, построенных на базе оборудования Mikrotik. Столкнулся со следующей проблемой: хочу получить графики пропускной способности интерфейсов коммутаторов не строя при этом связи между портом коммутатора и конечным устройством на схеме (ну не надо мне перегружать карту клиентскими компами/телефонами). Что-то подобное Dude организовать может, но в ходе чтения различных материалов и обсуждений конкретного решения я не нашел и пришлось копать дальше в тему. Для нетерпеливых: ответа я пока не нашел.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Итак, мы можем опросить устройство по SNMP и произвести какие-либо манипуляции с полученными данными средствами самой дудки. Стандартный SNMP позволяет нам увидеть следующие параметры:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->ifSpeed&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1.3.6.1.2.1.2.2.1.5&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Текущая скорость интерфейса в битах за секунду.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->ifInOctets&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1.3.6.1.2.1.2.2.1.10&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Полное число полученных байтов, включая символы заголовков&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->ifOutOctets&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1.3.6.1.2.1.2.2.1.16&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Полное количество отправленных октетов с интерфейса, включая символы заголовков.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Сначала я думал, что первая строчка этой таблицы спасет меня. Но нет - она показывает скорость, в которую установлен интерфейс (10/100/1000 Мб/с). Соответственно, ковырять придется второй и третий параметры. Вычислить скорость, исходя из полученных данных можно так: &lt;!-- raw HTML omitted -->(ifInOctets(time1) - ifInOctets(time2)) / (time2 - time1)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Но вот проблема: куда записать текущее значение полученных байтов, чтобы потом вычесть одно из другого. Тут должны помочь функции, встроенные в Dude. Но использование переменных я в них не нашел. Поэтому откладываю эту задачку на неопределенное время. &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->На форуме предлагают решение для The Dude 3.6, но в 4 версии оно не работает. Ссылки, которые дали информацию для размышлений: &lt;!-- raw HTML omitted -->1&lt;!-- raw HTML omitted -->, &lt;!-- raw HTML omitted -->2&lt;!-- raw HTML omitted -->, &lt;!-- raw HTML omitted -->3&lt;!-- raw HTML omitted -->, &lt;!-- raw HTML omitted -->4&lt;!-- raw HTML omitted -->, &lt;!-- raw HTML omitted -->5&lt;!-- raw HTML omitted -->. &lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>RouterOS firewall links</title><link>https://bubnovd.net/blogger/routeros-firewall-links/</link><pubDate>Mon, 02 Mar 2015 01:00:00 +0000</pubDate><guid>https://bubnovd.net/blogger/routeros-firewall-links/</guid><description>http://wiki.mikrotik.com/wiki/Dmitry_on_firewallinghttp://wiki.mikrotik.com/images/f/f2/Firewall.pdf</description><content>&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;a href="http://wiki.mikrotik.com/wiki/Dmitry_on_firewalling">http://wiki.mikrotik.com/wiki/Dmitry_on_firewalling&lt;/a>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;a href="http://wiki.mikrotik.com/images/f/f2/Firewall.pdf">http://wiki.mikrotik.com/images/f/f2/Firewall.pdf&lt;/a>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Скрипт для проверки наличия USB-модема на RouterOS</title><link>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B8-%D0%BD%D0%B0%D0%BB%D0%B8%D1%87%D0%B8%D1%8F-usb-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BC%D0%B0-%D0%BD%D0%B0-routeros/</link><pubDate>Sun, 01 Mar 2015 20:42:00 +0000</pubDate><guid>https://bubnovd.net/blogger/%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B8-%D0%BD%D0%B0%D0%BB%D0%B8%D1%87%D0%B8%D1%8F-usb-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BC%D0%B0-%D0%BD%D0%B0-routeros/</guid><description>Понадобился скрипт, определяющий наличие USB-модема, подключенного к Mikrotik. Присылает на почту название модема и его серийник. Хорошо бы допилить скрипт до отправки уровня сигнала и количества денег на счете, но мои модемы не дают доступа к своему меню - надо шить.:log info &amp;ldquo;Starting Modem Info Script&amp;hellip;&amp;rdquo;;:local sysname [/system identity get name];:local sysver [/system package get system version];:local mname [/system resource usb get 1 value-name=name];:local mnumber [/system resource usb get 1 value-name=serial-number];:local smtpserv [:resolve &amp;ldquo;smtp.</description><content>&lt;p>Понадобился скрипт, определяющий наличие USB-модема, подключенного к Mikrotik. Присылает на почту название модема и его серийник. Хорошо бы допилить скрипт до отправки уровня сигнала и количества денег на счете, но мои модемы не дают доступа к своему меню - надо шить.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Starting Modem Info Script&amp;hellip;&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local sysname [/system identity get name];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local sysver [/system package get system version];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local mname [/system resource usb get 1 value-name=name];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local mnumber [/system resource usb get 1 value-name=serial-number];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local smtpserv [:resolve &amp;ldquo;smtp.mail.ru&amp;rdquo;];&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local Eaccount &amp;ldquo;&lt;a href="mailto:mail@mail.ru">mail@mail.ru&lt;/a>&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:local pass &amp;ldquo;your_password&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Collecting Information&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:delay 5;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Sending Information via E-mail&amp;hellip;&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->/tool e-mail send from=&amp;quot;&amp;lt;$Eaccount&amp;gt;&amp;quot; to=$Eaccount server=$smtpserv &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->port=587 user=$Eaccount password=$pass start-tls=yes &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->subject=(&amp;quot;$sysname Modem Information (&amp;quot; . [/system clock get date] . &amp;ldquo;)&amp;rdquo;) &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->body=(&amp;quot;$sysname Modem.\nTime and Date stamp: &amp;quot; . [/system clock get time] . &amp;quot; &amp;quot; . &amp;lt;/span&amp;gt;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->[/system clock get date] . &amp;ldquo;\nModem $mname, SN: $mnumber&amp;rdquo;);&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->:log info &amp;ldquo;Modem Info Complete!&amp;rdquo;;&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Mikrotik и DNS</title><link>https://bubnovd.net/blogger/mikrotik-%D0%B8-dns/</link><pubDate>Tue, 02 Sep 2014 01:33:00 +0000</pubDate><guid>https://bubnovd.net/blogger/mikrotik-%D0%B8-dns/</guid><description>В настройках RouterOS в разделе DNS есть галочка Allow Remote Requests. Судя по названию, она должна разрешать удаленные запросы. Но не тут то было. При снятой галке RouterOS вообще не обрабатывает входящие DNS запросы, а использует указанные сервера лишь для своих собственных нужд.В целях безопасности необходимо закрыть доступ к 53 порту снаружи - мало сколько пакетов вам захотят послать недруги.</description><content>&lt;p>В настройках RouterOS в разделе DNS есть галочка Allow Remote Requests. Судя по названию, она должна разрешать удаленные запросы. Но не тут то было. При снятой галке RouterOS вообще не обрабатывает входящие DNS запросы, а использует указанные сервера лишь для своих собственных нужд.&lt;!-- raw HTML omitted -->В целях безопасности необходимо закрыть доступ к 53 порту снаружи - мало сколько пакетов вам захотят послать недруги.&lt;/p></content></item><item><title>Cacti + Mikrotik = Full Monitoring</title><link>https://bubnovd.net/blogger/cacti--mikrotik--full-monitoring/</link><pubDate>Sat, 01 Mar 2014 02:21:00 +0000</pubDate><guid>https://bubnovd.net/blogger/cacti--mikrotik--full-monitoring/</guid><description>Захотелось мне собирать все логи с сетевого оборудования в одном месте. Решил поднять syslog-сервер. Так как с такими сервисами никогда не сталкивался, пришлось спросить у великого гугля. Он подсказал мне, что с этим неплохо справляется система мониторинга Cacti. А о ней то я уже наслышан, и в планах стояло внедрение сего чуда в сеть. Итак, теперь основная цель не сислог, а мониторинг - то, для чего и создан cacti. Настроим мониторинг, а потом примемся за сислог.</description><content>&lt;p>Захотелось мне собирать все логи с сетевого оборудования в одном месте. Решил поднять syslog-сервер. Так как с такими сервисами никогда не сталкивался, пришлось спросить у великого гугля. Он подсказал мне, что с этим неплохо справляется система мониторинга Cacti. А о ней то я уже наслышан, и в планах стояло внедрение сего чуда в сеть. Итак, теперь основная цель не сислог, а мониторинг - то, для чего и создан cacti. Настроим мониторинг, а потом примемся за сислог.&lt;/p>
&lt;p>Система мониторинга Cacti разрабатывалась с целью визуализации данных, поэтому сравнивать её с другими будет несколько неуместно. Я для мониторинга активности устройств использую The Dude. И советую её всем, у кого сеть построена на микротиках, т.к. разработана она этой компанией, и, соответственно, умеет полностью управлять Mikrotik&amp;rsquo;ом. Но об этом в следующей статье.&lt;/p>
&lt;p>Итак, cacti можно установить на Windows и UNIX-like системы. Для работы ей нужны:&lt;/p>
&lt;ol>
&lt;li>web-server (apache 2.2)&lt;/li>
&lt;li>database server (mySQL 5.6)&lt;/li>
&lt;li>php (php 5.4)&lt;/li>
&lt;li>RRDTool (1.4.8)&lt;/li>
&lt;li>net-snmp (5.7)&lt;/li>
&lt;/ol>
&lt;p>В скобках указаны версии, установленные мной на FreeBSD 10.0 (запущенной под Hyper-V в Windows 2012). Процесс установки подробно расписывать не буду. Я руководствовался этими ресурсами:&lt;/p>
&lt;ol>
&lt;li>&lt;a href="http://nix-sa.blogspot.ru/2011/08/cacti.html">Установка Cacti (краткая заметка)&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://habrahabr.ru/post/71087/">Кактус у монитора или ускоренная установка cacti&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://samag.ru/archive/article/1770">Cacti – простой и удобный инструмент для мониторинга и анализа сети&lt;/a> &lt;/li>
&lt;/ol>
&lt;p> Я давно не работал с UNIX-like системами, поэтому возникли некоторые проблемы (будьте осторожны выбирая пакеты, которые тянет php. Он может вытянуть иксы). Для тех, кто впервые ставит LAMP, советую почитать мануалы по установке и конфигурированию сервисов.&lt;/p>
&lt;p>Ставим &lt;a href="http://docs.cacti.net/plugin:mikrotik">плагин&lt;/a> для работы с Mikrotik (копируем папку в /usr/share/local/cacti/plugins и идем в веб-интерфейсе кактуса в Configuration - Plugin Management и нажимаем Install, Activate). При его установке выпадает ошибка. Лечится удалением строки &amp;lsquo;Invalid round robin archive&amp;rsquo; из /usr/local/share/cacti/plugins/mikrotik/templates/cacti_host_template_mikrotik_device.xml.&lt;/p>
&lt;p>Настраиваем SNMP на Mikrotik. IP -&amp;gt; SNMP -&amp;gt; Communities. Использовать стандартный public не рекомендую, т.к. он передаёт данные в открытом виде и без авторизации. Мы будем использовать SNMP v3, поддерживающий авторизацию и шифрование. Добавляем новую community:&lt;/p>
&lt;ul>
&lt;li>имя - любое (cacti)&lt;/li>
&lt;li>Addresses - адрес сервера SNMP (на котором стоит cacti)&lt;/li>
&lt;li>Security - authorized&lt;/li>
&lt;li>Read/write - выбираем по своему усмотрению, read нужен обязательно, а write только если планируем конфигурировать роутер по SNMP протоколу&lt;/li>
&lt;li>Протоколы авторизации и шифрования оставляем дефолтные&lt;/li>
&lt;li>Задаём пароль авторизации и парольную фразу для шифрования (могут быть разные значения)&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="http://3.bp.blogspot.com/-qeSZdaw9AGc/UxGx8cC4McI/AAAAAAAAAe0/Ck3khsntuKo/s1600/mt-snmp.png">&lt;img src="http://3.bp.blogspot.com/-qeSZdaw9AGc/UxGx8cC4McI/AAAAAAAAAe0/Ck3khsntuKo/s1600/mt-snmp.png" alt="">&lt;/a>&lt;/p>
&lt;p>В SNMP Settings пишем:&lt;/p>
&lt;ul>
&lt;li>Contact Info - почта админа&lt;/li>
&lt;li>Location - физическое расположение устройства&lt;/li>
&lt;li>Trap Target - адрес SNMP сервера&lt;/li>
&lt;li>Выбираем созданную нами Trap Community&lt;/li>
&lt;li>Trap Version - 3&lt;/li>
&lt;li>Trap Generation - кто будет генерировать сообщения для сервера - интерфейс или встроенный сервер&lt;/li>
&lt;li>Выбираем нужные интерфейсы&lt;/li>
&lt;/ul>
&lt;p>Добавляем в cacti наш микротик. Подробно распишу только про SNMP options:&lt;/p>
&lt;ul>
&lt;li>SNMP Version - 3&lt;/li>
&lt;li>SNMP Username (v3) -  имя нашего Community (cacti)&lt;/li>
&lt;li>SNMP Password (v3) - то, что ввели в Authentication Password в Mikrotik&lt;/li>
&lt;li>SNMP Privacy Passphrase (v3) - Encryption Password в Mikrotik&lt;/li>
&lt;/ul>
&lt;p>По дальнейшей работе с кактусом полно мануалов. Также есть отличная документация на оф. сайте, правда на английском. &lt;a href="http://mum.mikrotik.com/presentations/CZ09/schaub.pdf">Презентация&lt;/a> о настройке SNMP на Mikrotik.&lt;/p>
&lt;p>Первый час работы кактуса:&lt;/p>
&lt;p>&lt;a href="http://2.bp.blogspot.com/-Nmv5KEBWAUs/UxG0IYWDldI/AAAAAAAAAfA/rGKLw1ncLhA/s1600/Screenshot+from+2014-03-01+16:18:55.png">&lt;img src="http://2.bp.blogspot.com/-Nmv5KEBWAUs/UxG0IYWDldI/AAAAAAAAAfA/rGKLw1ncLhA/s1600/Screenshot+from+2014-03-01+16:18:55.png" alt="">&lt;/a>&lt;/p>
&lt;p>За сим откланяюсь. Постараюсь сочинить что-нибудь про The Dude. Да и про кактус, когда сам в нем разберусь.&lt;/p></content></item></channel></rss>