<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>MTU on Bubnovd</title><link>https://bubnovd.github.io/tags/mtu/</link><description>Recent content in MTU on Bubnovd</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 19 Jan 2016 19:39:00 +0000</lastBuildDate><atom:link href="https://bubnovd.github.io/tags/mtu/index.xml" rel="self" type="application/rss+xml"/><item><title>Ещё раз об MTU и MSS</title><link>https://bubnovd.github.io/blogger/%D0%B5%D1%89%D1%91-%D1%80%D0%B0%D0%B7-%D0%BE%D0%B1-mtu-%D0%B8-mss/</link><pubDate>Tue, 19 Jan 2016 19:39:00 +0000</pubDate><guid>https://bubnovd.github.io/blogger/%D0%B5%D1%89%D1%91-%D1%80%D0%B0%D0%B7-%D0%BE%D0%B1-mtu-%D0%B8-mss/</guid><description>Я уже писал о MTU и даже приводил прекрасный документ от Cisco. А сегодня случайно наткнулся на ixbt на ветку о MTU в разных типах туннелей. Решил скопипастить - лишним не будет.Чтобы систематизировать свое представление о работе различных реализаций VPN-ов и расставить для себя все точки над &amp;ldquo;i&amp;rdquo;, выполнил расчет значений MTU и MSS для payload (полезного передаваемого трафика) в разных типах VPN, используемых совместно с Ethernet. Прошу проверить мои расчеты и указать мне на ошибки, если таковые имеются.</description><content>&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Я уже писал о &lt;!-- raw HTML omitted -->MTU&lt;!-- raw HTML omitted --> и даже приводил прекрасный &lt;!-- raw HTML omitted -->документ&lt;!-- raw HTML omitted --> от Cisco. А сегодня случайно наткнулся на &lt;!-- raw HTML omitted -->ixbt&lt;!-- raw HTML omitted --> на ветку о MTU в разных типах туннелей. Решил скопипастить - лишним не будет.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Чтобы систематизировать свое представление о работе различных реализаций VPN-ов и расставить для себя все точки над &amp;ldquo;i&amp;rdquo;, выполнил расчет значений MTU и MSS для payload (полезного передаваемого трафика) в разных типах VPN, используемых совместно с Ethernet. Прошу проверить мои расчеты и указать мне на ошибки, если таковые имеются.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Итак.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1. PPTP&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->PPTP это полезный_TCP -&amp;gt; IP -&amp;gt; PPP -&amp;gt; GRE -&amp;gt; IP -&amp;gt; Ethernet&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Для Ethernet MTU=1500; заголовки IP -20 байт, заголовок GRE -4 байта, заголовок PPP -2 байта.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Итого, MTU=1500-20-4-2=&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1474&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->; MSS=MTU-40=1434&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->2. Незашифрованный L2TP поверх IP&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->L2TP это полезный_TCP -&amp;gt; IP -&amp;gt; PPP -&amp;gt; L2TP -&amp;gt; UDP -&amp;gt; IP -&amp;gt; Ethernet&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Для Ethernet MTU=1500; заголовки IP -20 байт, заголовки UDP -8 байт, заголовки L2TP -16 байт, заголовок PPP -2 байта.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Итого, MTU=1500-20-8-16-2=&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1454&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->; MSS=MTU-40=1414&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->3. L2TP поверх IPSEC&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->L2TP поверх IPSEC это полезный_TCP -&amp;gt; IP -&amp;gt; PPP -&amp;gt; L2TP -&amp;gt; UDP -&amp;gt; ESP -&amp;gt; IP -&amp;gt; Ethernet&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Получается то же самое, что и пункт 2, за вычетом размера заголовков ESP -20 байт.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Итого, MTU=1454-20=&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1434&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->; MSS=MTU-40=1394&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->4. L2TP поверх IPSEC с NAT-Traversal&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Это полезный_TCP -&amp;gt; IP -&amp;gt; PPP -&amp;gt; L2TP -&amp;gt; UDP -&amp;gt; ESP -&amp;gt; IP -&amp;gt; UDP -&amp;gt; IP -&amp;gt; Ethernet&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Получается то же самое, что и пункт 3, за вычетом размера заголовков UDP -8 байт и IP -20 байт.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Итого, MTU=1434-28=&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->1406&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->; MSS=MTU-40=1366.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>PDU. Количество полезной информации на рахных уровнях модели OSI</title><link>https://bubnovd.github.io/blogger/pdu.-%D0%BA%D0%BE%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE-%D0%BF%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D0%BE%D0%B9-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8-%D0%BD%D0%B0-%D1%80%D0%B0%D1%85%D0%BD%D1%8B%D1%85-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F%D1%85-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8-osi/</link><pubDate>Wed, 30 Sep 2015 22:12:00 +0000</pubDate><guid>https://bubnovd.github.io/blogger/pdu.-%D0%BA%D0%BE%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE-%D0%BF%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D0%BE%D0%B9-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8-%D0%BD%D0%B0-%D1%80%D0%B0%D1%85%D0%BD%D1%8B%D1%85-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F%D1%85-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8-osi/</guid><description>PDU (Protocol Data Unit) - общий блок данных протокола (полезные данные + заголовки) (wikipedia). Своими словами - часть блока данных, в которой содержится информация верхнего уровня (для IP - часть пакета, где лежит TCP/UDP, для TCP/UDP - часть сегмента/датаграммы, где лежит информация прикладного уровня).MTU (Maximum Transmission Unit) - максимальный размер полезного блока данных одного пакета (PDU)Например, IP-пакет. Wiki говорит так:IP-пакеты состоят из заголовка и полезной нагрузки. Заголовок пакета IPv4 состоит из:4 бита содержат версию пакета: IPv4 или IPv6.</description><content>&lt;p>PDU (Protocol Data Unit) - общий блок данных протокола (полезные данные + заголовки) (&lt;!-- raw HTML omitted -->wikipedia&lt;!-- raw HTML omitted -->).  Своими словами - часть блока данных, в которой содержится информация верхнего уровня (для IP - часть пакета, где лежит TCP/UDP, для TCP/UDP - часть сегмента/датаграммы, где лежит информация прикладного уровня).&lt;!-- raw HTML omitted -->MTU (Maximum Transmission Unit) - максимальный размер полезного блока данных одного пакета (PDU)&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Например, IP-пакет. &lt;!-- raw HTML omitted -->Wiki &lt;!-- raw HTML omitted -->говорит так:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->IP&lt;!-- raw HTML omitted -->-пакеты состоят из заголовка и полезной нагрузки. Заголовок пакета &lt;!-- raw HTML omitted -->IPv4&lt;!-- raw HTML omitted --> состоит из:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->4 бита содержат &lt;!-- raw HTML omitted -->версию&lt;!-- raw HTML omitted --> пакета: IPv4 или IPv6.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->4 бита содержат &lt;!-- raw HTML omitted -->длину интернет-заголовка&lt;!-- raw HTML omitted -->, которая измеряется отрезками по 4 байта (например, 5 означает 20 байт).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->8 бит содержат &lt;!-- raw HTML omitted -->тип обслуживания&lt;!-- raw HTML omitted -->, известный также как качество обслуживания (&lt;!-- raw HTML omitted -->QoS&lt;!-- raw HTML omitted -->), описывающее приоритеты пакета.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->16 бит содержат &lt;!-- raw HTML omitted -->длину&lt;!-- raw HTML omitted --> пакета в байтах.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->16 бит содержат &lt;!-- raw HTML omitted -->тег идентификации&lt;!-- raw HTML omitted -->, помогающие восстановить пакет из нескольких фрагментов.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->3 бита содержат нуль, флаг разрешения &lt;!-- raw HTML omitted -->фрагментации&lt;!-- raw HTML omitted --> пакета (DF: не фрагментировать), а также флаг разрешения дальнейшей фрагментации (MF: фрагментировать дальше).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->13 бит содержат &lt;!-- raw HTML omitted -->смещение фрагмента&lt;!-- raw HTML omitted -->, поле для идентификации положение фрагмента в исходном пакете.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->8 бит содержат &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->время жизни&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> (TTL), которое определяет количество переходов (через маршрутизаторы, компьютеры и сетевые устройства), разрешённых пройти пакету, прежде чем он исчезнет (например, пакету с TTL 16 разрешено пройти не более 16 маршрутизаторов, чтобы добраться до места назначения).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->8 бит содержат &lt;!-- raw HTML omitted -->протокол&lt;!-- raw HTML omitted --> (TCP, UDP, ICMP и т. д.).&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->16 бит содержат &lt;!-- raw HTML omitted -->контрольную сумму заголовка&lt;!-- raw HTML omitted -->, используемую при обнаружении ошибок.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->32 бит содержат &lt;!-- raw HTML omitted -->IP-адрес источника&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->32 бит содержат &lt;!-- raw HTML omitted -->адрес назначения&lt;!-- raw HTML omitted -->.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->После этих данных могут быть добавлены разное количество необязательных флагов, меняющиеся в зависимости от используемого протокола, затем идут данные, которые переносит пакет. IP-пакет не имеет хвостового прицепа. Однако, IP-пакеты часто переносятся как полезная нагрузка внутри фрейма Ethernet, который имеет свой собственный заголовок и хвост.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Те данные, которые переносятся пакетом и есть PDU. А его максимальный размер - MTU.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->На картинке видны PDU разных уровней. Блок данных, в которых есть data и есть PDU.&lt;!-- raw HTML omitted -->Для модели OSI выделяют следующие PDU:&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Уровень 1 (физический/physical) - бит/bit&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Уровень 2 (канальный/data link) - кадр/frame&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Уровень 3 (сетевой/network) - пакет/packet&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Уровень 4 (транспортный/transport) - сегмент/segment для TCP, датаграмма/datagram для UDP&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Уровни 5-7 (прикладной/application) - данные/data&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Рассмотрим каждый уровень подробнее.&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->2. Payload (полезная нагрузка) канального уровня содержит 46-1500 байт. В эту полезную нагрузку входит блок данных более высоко уровня, один из частных (и наиболее распространенный) PDU для L2 - IP. Соответственно, MTU - 1500&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->3. Заголовки сетевого уровня составляют 40 байт, соответственно максимальный размер PDU  (в терминологии этого уровня называется MSS - Maximum Segment Size) равен 1500 (MTU более низкого уровня) - 40 (заголовки) = 1460&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->4. На следующем уровне MTU определяется размером заголовков.&lt;!-- raw HTML omitted -->&lt;/p></content></item><item><title>Всеобъемлющая дока по MTU</title><link>https://bubnovd.github.io/blogger/%D0%B2%D1%81%D0%B5%D0%BE%D0%B1%D1%8A%D0%B5%D0%BC%D0%BB%D1%8E%D1%89%D0%B0%D1%8F-%D0%B4%D0%BE%D0%BA%D0%B0-%D0%BF%D0%BE-mtu/</link><pubDate>Tue, 18 Aug 2015 01:34:00 +0000</pubDate><guid>https://bubnovd.github.io/blogger/%D0%B2%D1%81%D0%B5%D0%BE%D0%B1%D1%8A%D0%B5%D0%BC%D0%BB%D1%8E%D1%89%D0%B0%D1%8F-%D0%B4%D0%BE%D0%BA%D0%B0-%D0%BF%D0%BE-mtu/</guid><description>http://www.cisco.com/image/gif/paws/25885/pmtud_ipfrag.pdfОно и по-русски есть</description><content>&lt;p>&lt;!-- raw HTML omitted -->&lt;a href="http://www.cisco.com/image/gif/paws/25885/pmtud_ipfrag.pdf">http://www.cisco.com/image/gif/paws/25885/pmtud_ipfrag.pdf&lt;/a>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->Оно и по-русски &lt;!-- raw HTML omitted -->есть&lt;!-- raw HTML omitted -->&lt;/p></content></item></channel></rss>