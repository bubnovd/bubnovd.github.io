<!doctype html><html lang=en><head><title>Управление списками баз 1С 8.2 :: Админская фамилия</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Одно из правил управления временем — Если есть человек, которому можно делегировать выполнение задачи — делегируй.ПредысторияКак я докатился до того, что — Я, системный администратор! — стал задаваться вопросами работы 1С?Тирада в моей оригинальной статье, которую вряд ли кто читал, касалась того, какие лентяи 1С разработчики, и сами производители 1С, что одни понаделали много функций, но другие недостаточно хорошо описали, третьи поленились разобраться, а свалили всю рутину на системных администраторов, которым делать-то нечего, кроме как за элитой IT подметать."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://bubnovd.net/blogger/%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%D0%BC%D0%B8-%D0%B1%D0%B0%D0%B7-1%D1%81-8.2/><link rel=stylesheet href=https://bubnovd.net/assets/style.css><link rel=stylesheet href=https://bubnovd.net/assets/blue.css><link rel=apple-touch-icon href=https://bubnovd.net/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://bubnovd.net/img/favicon/blue.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Управление списками баз 1С 8.2"><meta property="og:description" content="Одно из правил управления временем — Если есть человек, которому можно делегировать выполнение задачи — делегируй.ПредысторияКак я докатился до того, что — Я, системный администратор! — стал задаваться вопросами работы 1С?Тирада в моей оригинальной статье, которую вряд ли кто читал, касалась того, какие лентяи 1С разработчики, и сами производители 1С, что одни понаделали много функций, но другие недостаточно хорошо описали, третьи поленились разобраться, а свалили всю рутину на системных администраторов, которым делать-то нечего, кроме как за элитой IT подметать."><meta property="og:url" content="https://bubnovd.net/blogger/%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%D0%BC%D0%B8-%D0%B1%D0%B0%D0%B7-1%D1%81-8.2/"><meta property="og:site_name" content="Админская фамилия"><meta property="og:image" content="https://bubnovd.net/img/favicon/blue.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2013-08-23 20:48:00 +0000 UTC"></head><body class=blue><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=https://bubnovd.net/><div class=logo>Terminal</div></a></div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://bubnovd.net/blogger/%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%D0%BC%D0%B8-%D0%B1%D0%B0%D0%B7-1%D1%81-8.2/>Управление списками баз 1С 8.2</a></h1><div class=post-meta><span class=post-date>2013-08-23</span>
<span class=post-author>:: map[name:devi1 uri:https://www.blogger.com/profile/05777499482649623616]</span>
<span class=post-reading-time>:: 9 min read (1809 words)</span></div><span class=post-tags>#<a href=https://bubnovd.net/tags/1%D1%81/>1С</a>&nbsp;</span><div class=post-content><div><p>Одно из правил управления временем — Если есть человек, которому можно делегировать выполнение задачи — делегируй.ПредысторияКак я докатился до того, что — Я, системный администратор! — стал задаваться вопросами работы 1С?Тирада в моей оригинальной статье, которую вряд ли кто читал, касалась того, какие лентяи 1С разработчики, и сами производители 1С, что одни понаделали много функций, но другие недостаточно хорошо описали, третьи поленились разобраться, а свалили всю рутину на системных администраторов, которым делать-то нечего, кроме как за элитой IT подметать. Думаю, здесь никто меня не похвалит за такие рассуждения. Хотя и похвалы особо не ищу. Единственная цель — чтобы это пригодилось кому-то, кто правильный лентяй-админ, и не любит заниматься одним и тем же помногу раз. А теперь о том, как это было.Я столкнулся с таким положением дел, что всем сотрудникам наши 1С разработчики добавляют базы ручками, присутствуя на рабочем месте сотрудника, либо просят это сделать нас удалённо, подключившись к рабочему столу пользователя и мышкакликанием все повторить.Выглядит это так:— Миша, добавь Васи Пупкину базу: 1C-server:1551 «buh_prod»— А как её назвать?— БухгалтерияИ не думайте, что в следующий раз, этот 1С разработчик скажет мне, что эту базу можно назвать именно также. Как следствие, у нас одна и та же база у разных сотрудников называлась по разному. Красота, не так ли?!Ещё одна сторона этой проблемы в том, что Сотрудник должен быть на месте, компьютер включен, и у него должно быть время (5 мин), чтобы я мог всё это сделать. Если сотрудника нет на месте, то вы можете себе предположить, сколько от меня требуется трудозатрат, чтобы выловить этого сотрудника, согласовать с ним время и сделать это. А если этот сотрудник в удалённом офисе, на ноутбуке, и бывает в сети крайне редко, плюс разница поясов Владивосток — Москва, то это ещё добавляет остроты ощущений. Конечно, можно ещё ярлыком в почту бросить, но этим у нас 1С разработчики очень крайне редко пользуются — или не умеют, или не хотят, или за нас переживают, что без работы останемся, за что им отдельная благодарность и лучи поноса.Баз у нас порядка пятнадцати. У каждой группы отдельный набор баз. А есть и такие, у кого строго индивидуальный список.Следующая картина вам ещё больше понравится.Поступает распоряжение от главы 1С&rsquo;ников, что нужно трём отделам изменить базу, т.к. она переехала на другой сервер. Дальше не буду тратить буквы, т.к. всё что я описал выше множите на тридцать человек, двадцать из которых в другом офисе или даже другом городе. Классная задачка.Не помню, сколько раз, я, таких суматох вынес, но было их больше десяти. После чего мне стало интересно, какие способы оптимизации этого процесса есть по unix-way&rsquo;ю.И стал я читать… Читал долго… Читал упорно… Документация 1С в справке мне совершенно не понравилась — написано так, как будто бы я уже это делал, поэтому большую часть идеи они оставляют между строк. Лучи поноса в написателей встроенной справки 1С. Как обычно это бывает, более-менее понятную инструкцию нашел на личном блоге, не помню уже кого.Теория устройства конфигурационных файловВ 1С организовано всё, что касается списков баз, в обычных текстовых, читаемых файлах с расширениями .cfg и .v8i, в кодировке utf-8. Так что, как вы наверняка догадываетесь, можно всё делать то же самое без отрыва пользователя, открывая файл по сети обычным текстовым редактором и правкой на прямую.Расположение файлов на стороне пользователяУ пользователя на компьютере 1С 8.2 хранит фалы списков баз в каталогах:Для Windows XP:Профиль всех пользователей: С:\Documents and Settings\All Users\Application Data\1C\1CEstart&lt;/span>Профиль пользователя: С:\Documents and Settings%username%\Application Data\1C\1CEstart&lt;/span>Для Windows 7:Профиль всех пользователей: C:\ProgramData\1C\1CEStart&lt;/span>Профиль пользователя: C:\Users%username%\AppData\Roaming\1C\1CEStart&lt;/span>Содержимое профиля пользователя — два файла: 1CEStart.cfg, ibases.v8i.Содержимое директории профиля всех пользователей — один лишь, 1CEStart.cfg.При запуске 1С берёт список баз к представлению в файле пользователя C:\Users%username%\AppData\Roaming\1C\1CEStart\ibases.v8i, но предварительно читает настройки сначала из профиля всех пользователей C:\ProgramData\1C\1CEStart\1CEStart.cfg, а потом и из профиля пользователя C:\Users%username%\AppData\Roaming\1C\1CEStart\1CEStart.cfg, и если в них есть ссылки на конфигурационные базы в сети, то добавляет их в этот файл.Описание файла 1CEStart.cfgВ профиле всех пользователей конфигурационный файл C:\ProgramData\1C\1CEStart\1CEStart.cfg имеет следующее содержание:InstalledLocation=C:\Program Files (x86)&lt;span class=&ldquo;number&rdquo; style=&ldquo;border: 0px; color: #2f98ff; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">1cv82InstallComponents=DESIGNERALLCLIENTS=1 THINCLIENTFILE=1 THINCLIENT=0 WEBSERVEREXT=0 SERVER=0 CONFREPOSSERVER=0 CONVERTER77=0 SERVERCLIENT=0 LANGUAGES=RUГде:InstalledLocation — содержит указание на каталог, в который выполнена установка 1С: Предприятие. По умолчанию это значение C:\Program Files (x86)\1Cv82.CommonCfgLocation — указывает путь и имя общего конфигурационного файла. Допускается наличие нескольких строк с таким параметром.CommonInfoBases — указывает путь и имя файла (.v8i) со списком общих информационных баз.DistributiveLocation — содержит указание на каталог, в котором будет производится поиск новой версии для автоматической установки.InstallComponents — В локальном конфигурационном файле (1CEStart.cfg) содержит перечень установленных компонент с признаком нужно установить компонету — 1, или нет — 0.Возможны следующие компоненты параметра InstallComponents:DESIGNERALLCLIENTS — все клиенты и конфигуратор.THINCLIENT — тонкий клиент для клиент-серверного варианта работы.THINCLIENTFILE — тонкий клиент с возможностью работы с файловыми информационными базами.SERVER — сервер 1С: Предприятия. Если программа установки запускается из программы запуска, то сервер будет установлен как приложение.WEBSERVEREXT — компоненты расширения для веб-сервера.CONFREPOSSERVER — сервер хранилища конфигураций 1С: Предприятия.SERVERCLIENT — компоненты для администрирования кластера серверов 1С: Предприятия.CONVERTER77 — конвертер информационных баз из версии 1С: Предприятия 7.7.LANGUAGES — список языков интерфейса для установки. Если указано несколько языков, они перечисляются через ”,”. Пример: LANGUAGES=RU,UK,BGВ профиле пользователя конфигурационный файл C:\Users%username%\AppData\Roaming\1C\1CEStart\1CEStart.cfg первоначально пустой. Но, если какие-то настройки необходимо сделать индивидуально для конкретного пользователя, то писать именно в него, и тут уже его ключи настроек будут иметь больший приоритет, но не все. Это отдельный вопрос, им я не буду сейчас захламлять голову.Описание файла ibases.v8iВторой важный файл информационных баз, который находится в профиле самого пользователя — C:\Users%username%\AppData\Roaming\1C\1CEStart\ibases.v8i. В него и собирается конечный список баз. Пример его содержимого:[PhoneBook]Connect=Srvr=&ldquo;1C-server:1551&rdquo;;Ref=&ldquo;phonebook&rdquo;;ID=34891493-907f-4783-8a37-3cbc092a989aOrderInList=16640Folder=/OrderInTree=16640External=1ClientConnectionSpeed=NormalApp=ThinClientWA=1Version=8.2[ITIL]Connect=File=&rdquo;\Dvc-server\it\Equipment\Rarus\ITIL";ID=2829c91a-137f-457c-93fe-9e74c8ec5ee4OrderInList=16384Folder=/OrderInTree=256External=1ClientConnectionSpeed=NormalApp=AutoWA=1Version=8.2.14.540Где:[phonebook] – название базы 1С. Может быть как русскими буквами, так и английскими. Это то, что видит пользователь.Connect=Srvr=&ldquo;1C-server:1551&rdquo;;Ref=&ldquo;phonebook&rdquo;; - место хранения базы. | | | | | | | |- наименование базы на сервере 1С. | | |&mdash;&mdash;&mdash;&mdash;- порт подключения, если отличается от стандартного. | |&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash; адрес сервера. |&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; тип подключения может быть: Srvr, File, ws - вэб-сервер.ID=34891493-907f-4783-8a37-3cbc092a989a — автоматически генерируемый уникальный код базы. Если у двух записей один и тот же ID, значит это одна база.OrderInList=16640 — порядок в списке баз, когда базы представлены одним общим списком без подкаталогов; этот параметр из сетевого списка синхронизируется только в чистый ibases.v8i, если в ibases.v8i пользователя уже заполнен этой базой и этот параметр не будет перезаписываться, при его изменении в сети.Folder=/ — задаёт место в дереве каталогов, если вид представления списка баз выставлен деревом; этот параметр имеет приоритет пользователя, и не меняется при изменении в сетевом конфиге.OrderInTree=16640 — порядок в дереве, когда список баз представлен в виде иерархии подкаталогов; этот параметр имеет также приоритет пользователя, и синхронизируется только при первом добавлении базы, а далее подлежит изменению только локальным пользователем.External=1 — внешняя подключаемая запись конфигурации или нет. Когда 0 тогда база присутствует только в этом файле. В данной ситуации эта запись импортируется из файла списка баз .v8i из сети. Это идентификатор, если это список баз расположенный в сети (расшаренный), то этот параметр можно вообще убрать из конфигурационного файла.ClientConnectionSpeed=Normal — скорость соединения клиента. Опции могут быть “Nofmal” и “Low”. Логика ясна и без моих поиснений. Этот параметр интерактивный и при сетевом размещении синхронизируется при каждом запуске 1С.App=Auto — тип соединения клиента. Бывает три типа:— Auto — определяется сервером;— ThinClient — тонкий клиент;— ThickClient — толстый клиент.Этот параметр интерактивный и синхронизируется при каждом запуске 1С.WA=1 — этот параметр говорит о том, что система должна использовать windows авторизацию. Этот параметр интерактивный и синхронизируется при каждом запуске 1С.Version=8.2 — используемая версия для этой базы. Если указать полностью конкретизируя какую платформу использовать, то будет использовать именно ту платформу, которую укажешь, как, например, во второй записи — Version=8.2.14.540. Этот параметр интерактивный и синхронизируется с сетевым конфигом при каждом запуске 1С.Также есть ещё такой параметр как DefaultApp — тип соединения клиента по умолчанию, если в конфигурации для базы не задан, и DefaultVersion — используемая версия по умолчанию, если не задано в конфигурации для базы. Этот параметр пользовательский, и синхронизируется в чистый файл базы при первом запуске. Далее этим параметром управляет локальный пользователь.Ссылки на конфигурационные файлы в сетиПрелесть всей этой схемы работы в том, что производители 1С предусмотрели возможность глядеть в конфигурационные файлы, расположенные в сети. Реализуется это путём правки:либо в конфигурационном файле всех пользователей C:\ProgramData\1C\1CEStart\1CEStart.cfg, если мы хотим показать базы для всех пользователей компьютера;либо в конфигурационном файле конкретного пользователя C:\Users%username%\AppData\Roaming\1C\1CEStart\1CEStart.cfg, если мы хотим показать базы только определённому пользователю на компьютере.А добавить можно параметры:либо CommonCfgLocation=\server\1C\config\bases.cfg — указывает путь и имя общего конфигурационного файла. Допускается наличие нескольких строк с таким параметром. Название файла не играет принципиального значения, лишь бы расширение сохранялось;либо CommonInfoBases=\server\1C\config\buh_bases.v8i — указывает путь и имя файла (.v8i) со списком общих информационных баз. Название файла не играет принципиального значения, лишь бы расширение сохранялось;или в комбинации и тот и другой, и помногу строк.Следует оговориться, что в сети мы должны разместить файлы с расширением .cfg и .v8i, и соответствующим наполнением.Идея использования возможностейИдея заключается в том, чтобы делать правки с наименьшим количеством повторений. Если настройки базы или её расположение на сервере поменялось, то, исправив запись один раз в одном месте, мы получим актуальную информацию на всех компьютерах.Для этого необходимо сделать шару в сети: \server\1C&lt;/code>. В этой шаре сделать, как минимум два каталога:..\bases&lt;/span>Листинг каталога:\server\1C\bases....base1.v8ibase2.v8ibase3.v8ibase4.v8iВ этом каталоге будут хранится файлы с расширением .v8i. Эти файлы будут иметь внутри себя настройки всего лишь одной базы для каждого файла. Причём указать следует только те параметры, настройки, которые критичны именно для этой базы, всё остальное автоматом подставится по умолчанию. Пример файла:[Название базы]Connect=ClientConnectionSpeed=NormalApp=AutoWA=1Version=8.2Следует избегать использования параметра ID, т.к. 1С разработчики используют для создания новой базы копипаст из имеющейся базы. А базы с одним ID будут конфликтовать...\groups&lt;/span>Листинг каталога:\server\1C\bases....buh.cfgfin.cfgmanagers.cfgВ этом каталоге будут храниться файлы с расширением .cfg. Эти файлы будут иметь внутри себя ссылки на базы в каталоге ..\bases. Пример файла:CommonInfoBases=\server&lt;span class=&ldquo;number&rdquo; style=&ldquo;border: 0px; color: #2f98ff; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">1C\bases\base1.v8iCommonInfoBases=\server&lt;span class=&ldquo;number&rdquo; style=&ldquo;border: 0px; color: #2f98ff; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">1C\bases\base2.v8iВ это каталоге мы создаём индивидуальные для группы пользователей или же для конкретного пользователя списки баз. Именно на файлы из этой группы мы ссылаемся в конфигурационных файлах операционной системы пользователя.При такой схеме мы выносим управление списками баз 1С пользователей в сеть для не администраторов. На сетевой каталог с конфигурационными файлами дать доступ 1С разработчикам и пусть играются как хотят.А если необходимо изменить настройки какой-то базы, то мы правим её всего одни раз в файле \server\1C\bases\base.v8i, и это отразится у всех пользователей, т.к. все пользователи смотрят информацию о базе именно в этом файле.РезультатРезультат такого построения конфигурационных файлов:Исправить название базы, место расположение, параметры запуска — всё можно сделать в одном месте и единожды.Унификация названия баз — все пользователи о базе знают по одному общему названию.Пользователь сам не сможет поломать конфигурационные настройки, т.к. они хранятся не на его компьютере.Процесс управления списком баз на компьютере пользователя можно вернуть обратно 1С специалистам.Возможность поправить конфигурационные файлы, даже если пользователь спит далеко за часовыми поясами, а компьютер на текущий момент выключен.P. S.Если вы думаете, что это было самой сложной частью работы, то вы глубоко ошибаетесь.Инструкция на корпоративной wiki, как это работает.Всяческое содействие при размещении конфигурационного файла, или базы, а также добавление пользователям нужных ссылок.Полгода на плавное приобщение к новой схеме работы.Эти факторы не помогли мне пересадить наших 1С&rsquo;ников на удобную для них схему работы.Зато, я трачу на это значительно меньше времени.Репост с хабра</p></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bubnovd-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://bubnovd.net/assets/main.js></script>
<script src=https://bubnovd.net/assets/prism.js></script></div></body></html>