<!doctype html><html lang=en><head><title>[Мониторинг] Prometheus + Grafana. Часть 1. Общая информация :: Админская фамилия</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Система мониторинга - неотъемлемая часть ИТ инфраструктуры. Сеть не исключение. Для мониторинга сети уже написано много различных систем на разные вкусы:
The Dude. Простая и быстрая в настройке и освоении система мониторинга от Mikrotik. Идеально подходит для небольших сетей или в случае, когда мониторинг нужен &amp;ldquo;вчера&amp;rdquo;
Zabbix. Монструозный гигант. Долгое время стандарт де факто в мониторинге (да и сейчас, пожалуй). Умеет, не побоюсь этого слова, всё. Cacti. Легковесная мониторилка на основе RRDTool"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://bubnovd.net/blogger/%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-prometheus--grafana.-%D1%87%D0%B0%D1%81%D1%82%D1%8C-1.-%D0%BE%D0%B1%D1%89%D0%B0%D1%8F-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F/><link rel=stylesheet href=https://bubnovd.net/assets/style.css><link rel=stylesheet href=https://bubnovd.net/assets/blue.css><link rel=apple-touch-icon href=https://bubnovd.net/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://bubnovd.net/img/favicon/blue.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="[Мониторинг] Prometheus + Grafana. Часть 1. Общая информация"><meta property="og:description" content="Система мониторинга - неотъемлемая часть ИТ инфраструктуры. Сеть не исключение. Для мониторинга сети уже написано много различных систем на разные вкусы:
The Dude. Простая и быстрая в настройке и освоении система мониторинга от Mikrotik. Идеально подходит для небольших сетей или в случае, когда мониторинг нужен &amp;ldquo;вчера&amp;rdquo;
Zabbix. Монструозный гигант. Долгое время стандарт де факто в мониторинге (да и сейчас, пожалуй). Умеет, не побоюсь этого слова, всё. Cacti. Легковесная мониторилка на основе RRDTool"><meta property="og:url" content="https://bubnovd.net/blogger/%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-prometheus--grafana.-%D1%87%D0%B0%D1%81%D1%82%D1%8C-1.-%D0%BE%D0%B1%D1%89%D0%B0%D1%8F-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F/"><meta property="og:site_name" content="Админская фамилия"><meta property="og:image" content="https://bubnovd.net/img/favicon/blue.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-05-27 11:06:00 +0000 UTC"></head><body class=blue><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=https://bubnovd.net/><div class=logo>Terminal</div></a></div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://bubnovd.net/blogger/%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-prometheus--grafana.-%D1%87%D0%B0%D1%81%D1%82%D1%8C-1.-%D0%BE%D0%B1%D1%89%D0%B0%D1%8F-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F/>[Мониторинг] Prometheus + Grafana. Часть 1. Общая информация</a></h1><div class=post-meta><span class=post-date>2018-05-27</span>
<span class=post-author>:: map[name:devi1 uri:https://www.blogger.com/profile/05777499482649623616]</span>
<span class=post-reading-time>:: 3 min read (483 words)</span></div><span class=post-tags>#<a href=https://bubnovd.net/tags/prometheus/>prometheus</a>&nbsp;
#<a href=https://bubnovd.net/tags/grafana/>grafana</a>&nbsp;
#<a href=https://bubnovd.net/tags/monitoring/>monitoring</a>&nbsp;
#<a href=https://bubnovd.net/tags/snmp_exporter/>snmp_exporter</a>&nbsp;</span><div class=post-content><div><p>Система мониторинга - неотъемлемая часть ИТ инфраструктуры. Сеть не исключение. Для мониторинга сети уже написано много различных систем на разные вкусы:</p><ul><li><p><a href=http://www.bubnovd.net/2017/05/thedudenetwork-managementandmonitoring.html>The Dude</a>. Простая и быстрая в настройке и освоении система мониторинга от Mikrotik. Идеально подходит для небольших сетей или в случае, когда мониторинг нужен &ldquo;вчера&rdquo;</p></li><li><p><a href=https://www.zabbix.com/ru/>Zabbix</a>. Монструозный гигант. Долгое время стандарт де факто в мониторинге (да и сейчас, пожалуй). Умеет, не побоюсь этого слова, всё. </p></li><li><p><a href=http://www.bubnovd.net/2014/03/cacti-mikrotik-full-monitoring.html>Cacti</a>. Легковесная мониторилка на основе RRDTool</p></li><li><p><a href=https://oss.oetiker.ch/mrtg/>MRTG</a>, <a href=https://www.ru.paessler.com/prtg>PRTG</a> и <a href=https://www.nagios.org/>куча</a> других <a href=https://www.icinga.com/>систем</a></p></li></ul><p>С распространением микросервисов функциональности и производительности существующих систем мониторинга стало не хватать и, что ожидаемо, начали разрабатываться и внедряться новые системы. В очередном моём проекте как раз понадобилась система мониторинга. И чтобы не отставать от цивилизованного мира, я решил попробовать что-то новое. Выбор пал на стек Prometheus + Grafana. Чтобы как-то увлечь Вас, предлагаю посмотреть на демо интерфейс по <a href="https://play.grafana.org/d/000000003/big-dashboard?orgId=1">ссылке</a>.</p><p><a href=https://3.bp.blogspot.com/-LyDAjmqZx7g/Wwrve4VCaXI/AAAAAAAAFP0/eicg99-DMPs07f5vrO_BbVTVzWEFRp_ZwCLcBGAs/s1600/grafana.PNG><img src=https://3.bp.blogspot.com/-LyDAjmqZx7g/Wwrve4VCaXI/AAAAAAAAFP0/eicg99-DMPs07f5vrO_BbVTVzWEFRp_ZwCLcBGAs/s640/grafana.PNG alt></a></p><p>Grafana</p><p>Давайте рассмотрим что же из себя представляет этот стек.</p><p>В современной разработке принято разделять продукт на несколько разных по назначению частей. Так система получается более масштабируемой и универсальной. Вот и здесь система мониторинга состоит из нескольких частей:</p><p><img src="https://avatars1.githubusercontent.com/u/3380462?s=200&v=4" alt=@prometheus><strong><a href=https://github.com/prometheus/prometheus>Prometheus</a></strong></p><p>Как написано по ссылке, это система мониторинга и time-series database. Prometheus принимает метрики из разных источников (exporters), записывает их в базу и предоставляет интерфейс для построения графиков и различных выборок.</p><p><img src="data:image/svg+xml,%3Csvg%20id=%22Layer_1%22%20xmlns=%22http://www.w3.org/2000/svg%22%20xmlns:xlink=%22http://www.w3.org/1999/xlink%22%20width=%22351%22%20height=%22365%22%20viewBox=%220%200%20351%20365%22%20enable-background=%22new%200%200%20351%20365%22%3E%3Cg%20id=%22Layer_1_1_%22/%3E%3ClinearGradient%20id=%22SVGID_1_%22%20gradientUnits=%22userSpaceOnUse%22%20x1=%22170.9181%22%20y1=%22439.481%22%20x2=%22170.9181%22%20y2=%22106.6749%22%3E%3Cstop%20offset=%220%22%20style=%22stop-color:%23FFF100%22/%3E%3Cstop%20offset=%221%22%20style=%22stop-color:%23F05A28%22/%3E%3C/linearGradient%3E%3Cpath%20fill=%22url(%23SVGID_1_)%22%20d=%22M337.5%20161.1c-.6-6.1-1.6-13.1-3.6-20.9-2-7.7-5-16.2-9.4-25S314.4%2097.3%20307%2088.4c-2.9-3.5-6.1-6.9-9.5-10.2%205.1-20.3-6.2-37.9-6.2-37.9-19.5-1.2-31.9%206.1-36.5%209.4-.8-.3-1.5-.7-2.3-1-3.3-1.3-6.7-2.6-10.3-3.7-3.5-1.1-7.1-2.1-10.8-3-3.7-.9-7.4-1.6-11.2-2.2-.7-.1-1.3-.2-2-.3C209.6%2012.4%20185.1%201%20185.1%201c-27.3%2017.3-32.4%2041.5-32.4%2041.5s-.1.5-.3%201.4c-1.5.4-3%20.9-4.5%201.3-2.1.6-4.2%201.4-6.2%202.2-2.1.8-4.1%201.6-6.2%202.5-4.1%201.8-8.2%203.8-12.2%206-3.9%202.2-7.7%204.6-11.4%207.1-.5-.2-1-.4-1-.4-37.8-14.4-71.3%202.9-71.3%202.9-3.1%2040.2%2015.1%2065.5%2018.7%2070.1-.9%202.5-1.7%205-2.5%207.5-2.8%209.1-4.9%2018.4-6.2%2028.1-.2%201.4-.4%202.8-.5%204.2-34.9%2017.2-45.2%2052.5-45.2%2052.5C33%20261.4%2067%20263.5%2067%20263.5s.1-.1.1-.1c4.3%207.7%209.3%2015%2014.9%2021.9%202.4%202.9%204.8%205.6%207.4%208.3-10.6%2030.4%201.5%2055.6%201.5%2055.6%2032.4%201.2%2053.7-14.2%2058.2-17.7%203.2%201.1%206.5%202.1%209.8%202.9%2010%202.6%2020.2%204.1%2030.4%204.5%202.5.1%205.1.2%207.6.1h1.2.8%201.6l1.6-.1s0%20.1.0.1c15.3%2021.8%2042.1%2024.9%2042.1%2024.9%2021.6-22.8%2020.2-45.3%2020.2-45.3-.2-.2-.4-.3-.6-.5%204.2-2.9%208.2-6.1%2012-9.5%207.6-6.9%2014.3-14.8%2019.9-23.3.5-.8%201-1.6%201.5-2.4%2021.6%201.2%2036.9-13.4%2036.9-13.4-4-25.2-19.6-36-19.6-36-.2.0-.3.1-.5.1.2-1.5.3-3%20.4-4.5.2-2.4.2-4.9.2-7.3V220v-.9-.5c0-.6.0-.4.0-.6l-.1-1.5-.1-2c0-.7-.1-1.3-.2-1.9-.1-.6-.1-1.3-.2-1.9l-.2-1.9-.3-1.9c-.4-2.5-.8-4.9-1.4-7.4-2.3-9.7-6.1-18.9-11-27.2-5-8.3-11.2-15.6-18.3-21.8-7-6.2-14.9-11.2-23.1-14.9-8.3-3.7-16.9-6.1-25.5-7.2-4.3-.6-8.6-.8-12.9-.7h-1.6-.4c-.1.0-.6.0-.5.0h-.7l-1.6.1c-.6.0-1.2.1-1.7.1-2.2.2-4.4.5-6.5.9-8.6%201.6-16.7%204.7-23.8%209-7.1%204.3-13.3%209.6-18.3%2015.6s-8.9%2012.7-11.6%2019.6-4.2%2014.1-4.6%2021c-.1%201.7-.1%203.5-.1%205.2.0.4.0.9.0%201.3l.1%201.4c.1.8.1%201.7.2%202.5.3%203.5%201%206.9%201.9%2010.1%201.9%206.5%204.9%2012.4%208.6%2017.4s8.2%209.1%2012.9%2012.4c4.7%203.2%209.8%205.5%2014.8%207s10%202.1%2014.7%202.1c.6.0%201.2.0%201.7.0.3.0.6.0.9.0s.6.0.9-.1c.5.0%201-.1%201.5-.1.1.0.3.0.4-.1l.5-.1c.3.0.6-.1.9-.1.6-.1%201.1-.2%201.7-.3.6-.1%201.1-.2%201.6-.4%201.1-.2%202.1-.6%203.1-.9%202-.7%204-1.5%205.7-2.4%201.8-.9%203.4-2%205-3%20.4-.3.9-.6%201.3-1%201.6-1.3%201.9-3.7.6-5.3-1.1-1.4-3.1-1.8-4.7-.9-.4.2-.8.4-1.2.6-1.4.7-2.8%201.3-4.3%201.8s-3.1.9-4.7%201.2c-.8.1-1.6.2-2.5.3-.4.0-.8.1-1.3.1-.4.0-.9.0-1.2.0-.4.0-.8.0-1.2.0-.5.0-1%200-1.5-.1.0.0-.3.0-.1.0h-.2-.3c-.2.0-.5.0-.7-.1-.5-.1-.9-.1-1.4-.2-3.7-.5-7.4-1.6-10.9-3.2-3.6-1.6-7-3.8-10.1-6.6-3.1-2.8-5.8-6.1-7.9-9.9s-3.6-8-4.3-12.4c-.3-2.2-.5-4.5-.4-6.7.0-.6.1-1.2.1-1.8.0.2.0-.1.0-.1v-.2-.5c0-.3.1-.6.1-.9.1-1.2.3-2.4.5-3.6%201.7-9.6%206.5-19%2013.9-26.1%201.9-1.8%203.9-3.4%206-4.9s4.4-2.8%206.8-3.9%204.8-2%207.4-2.7c2.5-.7%205.1-1.1%207.8-1.4%201.3-.1%202.6-.2%204-.2.4.0.6.0.9.0h1.1.7c.3.0.0.0.1.0h.3l1.1.1c2.9.2%205.7.6%208.5%201.3%205.6%201.2%2011.1%203.3%2016.2%206.1%2010.2%205.7%2018.9%2014.5%2024.2%2025.1%202.7%205.3%204.6%2011%205.5%2016.9.2%201.5.4%203%20.5%204.5l.1%201.1.1%201.1c0%20.4.0.8.0%201.1.0.4.0.8.0%201.1v1%201.1c0%20.7-.1%201.9-.1%202.6-.1%201.6-.3%203.3-.5%204.9s-.5%203.2-.8%204.8c-.3%201.6-.7%203.2-1.1%204.7-.8%203.1-1.8%206.2-3%209.3-2.4%206-5.6%2011.8-9.4%2017.1-7.7%2010.6-18.2%2019.2-30.2%2024.7-6%202.7-12.3%204.7-18.8%205.7-3.2.6-6.5.9-9.8%201h-.6-.5-1.1-1.6-.8c.4.0-.1.0-.1.0h-.3c-1.8.0-3.5-.1-5.3-.3-7-.5-13.9-1.8-20.7-3.7-6.7-1.9-13.2-4.6-19.4-7.8-12.3-6.6-23.4-15.6-32-26.5-4.3-5.4-8.1-11.3-11.2-17.4-3.1-6.1-5.6-12.6-7.4-19.1-1.8-6.6-2.9-13.3-3.4-20.1l-.1-1.3v-.3-.3-.6-1.1-.3-.4-.8-1.6-.3s0%20.1.0-.1v-.6c0-.8.0-1.7.0-2.5.1-3.3.4-6.8.8-10.2.4-3.4%201-6.9%201.7-10.3s1.5-6.8%202.5-10.2c1.9-6.7%204.3-13.2%207.1-19.3%205.7-12.2%2013.1-23.1%2022-31.8%202.2-2.2%204.5-4.2%206.9-6.2%202.4-1.9%204.9-3.7%207.5-5.4%202.5-1.7%205.2-3.2%207.9-4.6%201.3-.7%202.7-1.4%204.1-2%20.7-.3%201.4-.6%202.1-.9.7-.3%201.4-.6%202.1-.9%202.8-1.2%205.7-2.2%208.7-3.1.7-.2%201.5-.4%202.2-.7.7-.2%201.5-.4%202.2-.6%201.5-.4%203-.8%204.5-1.1.7-.2%201.5-.3%202.3-.5s1.5-.3%202.3-.5c.8-.1%201.5-.3%202.3-.4l1.1-.2%201.2-.2c.8-.1%201.5-.2%202.3-.3.9-.1%201.7-.2%202.6-.3.7-.1%201.9-.2%202.6-.3.5-.1%201.1-.1%201.6-.2l1.1-.1.5-.1h.6c.9-.1%201.7-.1%202.6-.2l1.3-.1s.5.0.1.0h.3.6c.7.0%201.5-.1%202.2-.1%202.9-.1%205.9-.1%208.8.0%205.8.2%2011.5.9%2017%201.9%2011.1%202.1%2021.5%205.6%2031%2010.3%209.5%204.6%2017.9%2010.3%2025.3%2016.5.5.4.9.8%201.4%201.2.4.4.9.8%201.3%201.2.9.8%201.7%201.6%202.6%202.4.9.8%201.7%201.6%202.5%202.4.8.8%201.6%201.6%202.4%202.5%203.1%203.3%206%206.6%208.6%2010%205.2%206.7%209.4%2013.5%2012.7%2019.9.2.4.4.8.6%201.2.2.4.4.8.6%201.2.4.8.8%201.6%201.1%202.4.4.8.7%201.5%201.1%202.3.3.8.7%201.5%201%202.3%201.2%203%202.4%205.9%203.3%208.6%201.5%204.4%202.6%208.3%203.5%2011.7.3%201.4%201.6%202.3%203%202.1%201.5-.1%202.6-1.3%202.6-2.8C338%20170.3%20337.9%20166%20337.5%20161.1z%22/%3E%3C/svg%3E" alt="Grafana Icon"> <strong><a href=https://grafana.com/>Grafana</a></strong></p><p>Если предыдущая часть собирает и хранит данные, то эта - отображает их в удобной для пользователя форме. Посмотрите ещё раз <a href="https://play.grafana.org/d/000000012/grafana-play-home?orgId=1">на интерфейс</a> - ну разве не волшебство?</p><p>Prometheus получает данные от экспортеров в виде простого текста. Вроде этого:</p><blockquote><p># HELP go_gc_duration_seconds A summary of the GC invocation durations.<br># TYPE go_gc_duration_seconds summary<br>go_gc_duration_seconds{quantile=&ldquo;0&rdquo;} 6.5914e-05<br>go_gc_duration_seconds{quantile=&ldquo;0.25&rdquo;} 0.000120385<br>go_gc_duration_seconds{quantile=&ldquo;0.5&rdquo;} 0.000150536<br>go_gc_duration_seconds{quantile=&ldquo;0.75&rdquo;} 0.000208313<br>go_gc_duration_seconds{quantile=&ldquo;1&rdquo;} 0.001072873<br>go_gc_duration_seconds_sum 0.333397658<br>go_gc_duration_seconds_count 1648<br># HELP go_goroutines Number of goroutines that currently exist.<br># TYPE go_goroutines gauge<br>go_goroutines 58</p></blockquote><p>Но эти данные ему ещё нужно доставить. Сами ведь они к нему не придут. Для этого существуют специальные модули, называемые exporters, которые позволяют отсылать данные Prometheus&rsquo;у. Со списком можно ознакомиться <a href=https://prometheus.io/docs/instrumenting/exporters/>по ссылке</a>. Это что-то вроде Zabbix agent&rsquo;ов. Есть экспортеры для Linux и Windows, MS SQL, MySQL, Nginx и других систем.</p><p>Так как нас в первую очередь интересует сеть, то и экспортировать нам надо SNMP. В этом нам поможет <a href=https://github.com/prometheus/snmp_exporter>SNMP_exporter</a>.</p><p>Таким образом, мы определились, что наш стек мониторинга будет работать на Prometheus, Grafana и snmp_exporter для Prometheus. Все эти модули можно менять на любые другие такого же назначения. Интерфейс Grafana можно заменить на Kibana (но не стоит этого делать - kibana совсем для других целей), а БД в виде Prometheus можно заменить на InfluxDB, Graphite или что-то ещё. Я выбрал именно Grafana + Prometheus + snmp_exporter за гибкий язык запросов prometheus  и гибкость и красоту grafana.</p><p>Чтобы ещё больше погрузиться в модные технологии, весь стек было решено поднимать в docker контейнерах. Вам совсем необязательно повторять этот трюк, но познакомиться с контейнерезацией в XXI веке тоже было бы неплохо.</p><p>На этом пока всё. В следующей части установим и настроим сборку метрик с помощью prometheus и snmp_exporter.</p></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bubnovd-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://bubnovd.net/assets/main.js></script>
<script src=https://bubnovd.net/assets/prism.js></script></div></body></html>